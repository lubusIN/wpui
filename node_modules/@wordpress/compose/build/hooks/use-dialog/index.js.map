{"version":3,"names":["_element","require","_keycodes","_useConstrainedTabbing","_interopRequireDefault","_useFocusOnMount","_useFocusReturn","_useFocusOutside","_useMergeRefs","useDialog","options","currentOptions","useRef","useEffect","current","Object","values","constrainedTabbingRef","useConstrainedTabbing","focusOnMountRef","useFocusOnMount","focusOnMount","focusReturnRef","useFocusReturn","focusOutsideProps","useFocusOutside","event","__unstableOnClose","onClose","closeOnEscapeRef","useCallback","node","addEventListener","keyCode","ESCAPE","defaultPrevented","preventDefault","useMergeRefs","tabIndex","_default","exports","default"],"sources":["@wordpress/compose/src/hooks/use-dialog/index.ts"],"sourcesContent":["/**\n * External dependencies\n */\nimport type { RefCallback, SyntheticEvent } from 'react';\n\n/**\n * WordPress dependencies\n */\nimport { useRef, useEffect, useCallback } from '@wordpress/element';\nimport { ESCAPE } from '@wordpress/keycodes';\n\n/**\n * Internal dependencies\n */\nimport useConstrainedTabbing from '../use-constrained-tabbing';\nimport useFocusOnMount from '../use-focus-on-mount';\nimport useFocusReturn from '../use-focus-return';\nimport useFocusOutside from '../use-focus-outside';\nimport useMergeRefs from '../use-merge-refs';\n\ntype DialogOptions = {\n\tfocusOnMount?: Parameters< typeof useFocusOnMount >[ 0 ];\n\tonClose?: () => void;\n\t/**\n\t * Use the `onClose` prop instead.\n\t *\n\t * @deprecated\n\t */\n\t__unstableOnClose?: (\n\t\ttype: string | undefined,\n\t\tevent: SyntheticEvent\n\t) => void;\n};\n\ntype useDialogReturn = [\n\tRefCallback< HTMLElement >,\n\tReturnType< typeof useFocusOutside > & Pick< HTMLElement, 'tabIndex' >,\n];\n\n/**\n * Returns a ref and props to apply to a dialog wrapper to enable the following behaviors:\n *  - constrained tabbing.\n *  - focus on mount.\n *  - return focus on unmount.\n *  - focus outside.\n *\n * @param options Dialog Options.\n */\nfunction useDialog( options: DialogOptions ): useDialogReturn {\n\tconst currentOptions = useRef< DialogOptions | undefined >();\n\tuseEffect( () => {\n\t\tcurrentOptions.current = options;\n\t}, Object.values( options ) );\n\tconst constrainedTabbingRef = useConstrainedTabbing();\n\tconst focusOnMountRef = useFocusOnMount( options.focusOnMount );\n\tconst focusReturnRef = useFocusReturn();\n\tconst focusOutsideProps = useFocusOutside( ( event ) => {\n\t\t// This unstable prop  is here only to manage backward compatibility\n\t\t// for the Popover component otherwise, the onClose should be enough.\n\t\tif ( currentOptions.current?.__unstableOnClose ) {\n\t\t\tcurrentOptions.current.__unstableOnClose( 'focus-outside', event );\n\t\t} else if ( currentOptions.current?.onClose ) {\n\t\t\tcurrentOptions.current.onClose();\n\t\t}\n\t} );\n\tconst closeOnEscapeRef = useCallback( ( node: HTMLElement ) => {\n\t\tif ( ! node ) {\n\t\t\treturn;\n\t\t}\n\n\t\tnode.addEventListener( 'keydown', ( event: KeyboardEvent ) => {\n\t\t\t// Close on escape.\n\t\t\tif (\n\t\t\t\tevent.keyCode === ESCAPE &&\n\t\t\t\t! event.defaultPrevented &&\n\t\t\t\tcurrentOptions.current?.onClose\n\t\t\t) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcurrentOptions.current.onClose();\n\t\t\t}\n\t\t} );\n\t}, [] );\n\n\treturn [\n\t\tuseMergeRefs( [\n\t\t\toptions.focusOnMount !== false ? constrainedTabbingRef : null,\n\t\t\toptions.focusOnMount !== false ? focusReturnRef : null,\n\t\t\toptions.focusOnMount !== false ? focusOnMountRef : null,\n\t\t\tcloseOnEscapeRef,\n\t\t] ),\n\t\t{\n\t\t\t...focusOutsideProps,\n\t\t\ttabIndex: -1,\n\t\t},\n\t];\n}\n\nexport default useDialog;\n"],"mappings":";;;;;;;AAQA,IAAAA,QAAA,GAAAC,OAAA;AACA,IAAAC,SAAA,GAAAD,OAAA;AAKA,IAAAE,sBAAA,GAAAC,sBAAA,CAAAH,OAAA;AACA,IAAAI,gBAAA,GAAAD,sBAAA,CAAAH,OAAA;AACA,IAAAK,eAAA,GAAAF,sBAAA,CAAAH,OAAA;AACA,IAAAM,gBAAA,GAAAH,sBAAA,CAAAH,OAAA;AACA,IAAAO,aAAA,GAAAJ,sBAAA,CAAAH,OAAA;AAlBA;AACA;AACA;;AAGA;AACA;AACA;;AAIA;AACA;AACA;;AA0BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASQ,SAASA,CAAEC,OAAsB,EAAoB;EAC7D,MAAMC,cAAc,GAAG,IAAAC,eAAM,EAA8B,CAAC;EAC5D,IAAAC,kBAAS,EAAE,MAAM;IAChBF,cAAc,CAACG,OAAO,GAAGJ,OAAO;EACjC,CAAC,EAAEK,MAAM,CAACC,MAAM,CAAEN,OAAQ,CAAE,CAAC;EAC7B,MAAMO,qBAAqB,GAAG,IAAAC,8BAAqB,EAAC,CAAC;EACrD,MAAMC,eAAe,GAAG,IAAAC,wBAAe,EAAEV,OAAO,CAACW,YAAa,CAAC;EAC/D,MAAMC,cAAc,GAAG,IAAAC,uBAAc,EAAC,CAAC;EACvC,MAAMC,iBAAiB,GAAG,IAAAC,wBAAe,EAAIC,KAAK,IAAM;IACvD;IACA;IACA,IAAKf,cAAc,CAACG,OAAO,EAAEa,iBAAiB,EAAG;MAChDhB,cAAc,CAACG,OAAO,CAACa,iBAAiB,CAAE,eAAe,EAAED,KAAM,CAAC;IACnE,CAAC,MAAM,IAAKf,cAAc,CAACG,OAAO,EAAEc,OAAO,EAAG;MAC7CjB,cAAc,CAACG,OAAO,CAACc,OAAO,CAAC,CAAC;IACjC;EACD,CAAE,CAAC;EACH,MAAMC,gBAAgB,GAAG,IAAAC,oBAAW,EAAIC,IAAiB,IAAM;IAC9D,IAAK,CAAEA,IAAI,EAAG;MACb;IACD;IAEAA,IAAI,CAACC,gBAAgB,CAAE,SAAS,EAAIN,KAAoB,IAAM;MAC7D;MACA,IACCA,KAAK,CAACO,OAAO,KAAKC,gBAAM,IACxB,CAAER,KAAK,CAACS,gBAAgB,IACxBxB,cAAc,CAACG,OAAO,EAAEc,OAAO,EAC9B;QACDF,KAAK,CAACU,cAAc,CAAC,CAAC;QACtBzB,cAAc,CAACG,OAAO,CAACc,OAAO,CAAC,CAAC;MACjC;IACD,CAAE,CAAC;EACJ,CAAC,EAAE,EAAG,CAAC;EAEP,OAAO,CACN,IAAAS,qBAAY,EAAE,CACb3B,OAAO,CAACW,YAAY,KAAK,KAAK,GAAGJ,qBAAqB,GAAG,IAAI,EAC7DP,OAAO,CAACW,YAAY,KAAK,KAAK,GAAGC,cAAc,GAAG,IAAI,EACtDZ,OAAO,CAACW,YAAY,KAAK,KAAK,GAAGF,eAAe,GAAG,IAAI,EACvDU,gBAAgB,CACf,CAAC,EACH;IACC,GAAGL,iBAAiB;IACpBc,QAAQ,EAAE,CAAC;EACZ,CAAC,CACD;AACF;AAAC,IAAAC,QAAA,GAEc9B,SAAS;AAAA+B,OAAA,CAAAC,OAAA,GAAAF,QAAA"}