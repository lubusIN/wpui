{"version":3,"names":["_element","require","_valtio","_utils","_isShallowEqual","_interopRequireDefault","_slotFillContext","createSlotRegistry","slots","proxyMap","fills","registerSlot","name","ref","fillProps","slot","get","set","valRef","unregisterSlot","delete","updateSlot","isShallowEqual","slotFills","map","fill","current","rerender","registerFill","unregisterFill","fillsForName","filter","fillRef","SlotFillProvider","children","registry","useState","createElement","default","Provider","value"],"sources":["@wordpress/components/src/slot-fill/bubbles-virtually/slot-fill-provider.js"],"sourcesContent":["// @ts-nocheck\n/**\n * External dependencies\n */\nimport { ref as valRef } from 'valtio';\nimport { proxyMap } from 'valtio/utils';\n\n/**\n * WordPress dependencies\n */\nimport { useState } from '@wordpress/element';\nimport isShallowEqual from '@wordpress/is-shallow-equal';\n\n/**\n * Internal dependencies\n */\nimport SlotFillContext from './slot-fill-context';\n\nfunction createSlotRegistry() {\n\tconst slots = proxyMap();\n\tconst fills = proxyMap();\n\n\tfunction registerSlot( name, ref, fillProps ) {\n\t\tconst slot = slots.get( name ) || {};\n\t\tslots.set(\n\t\t\tname,\n\t\t\tvalRef( {\n\t\t\t\t...slot,\n\t\t\t\tref: ref || slot.ref,\n\t\t\t\tfillProps: fillProps || slot.fillProps || {},\n\t\t\t} )\n\t\t);\n\t}\n\n\tfunction unregisterSlot( name, ref ) {\n\t\t// Make sure we're not unregistering a slot registered by another element\n\t\t// See https://github.com/WordPress/gutenberg/pull/19242#issuecomment-590295412\n\t\tif ( slots.get( name )?.ref === ref ) {\n\t\t\tslots.delete( name );\n\t\t}\n\t}\n\n\tfunction updateSlot( name, fillProps ) {\n\t\tconst slot = slots.get( name );\n\t\tif ( ! slot ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( isShallowEqual( slot.fillProps, fillProps ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tslot.fillProps = fillProps;\n\t\tconst slotFills = fills.get( name );\n\t\tif ( slotFills ) {\n\t\t\t// Force update fills.\n\t\t\tslotFills.map( ( fill ) => fill.current.rerender() );\n\t\t}\n\t}\n\n\tfunction registerFill( name, ref ) {\n\t\tfills.set( name, valRef( [ ...( fills.get( name ) || [] ), ref ] ) );\n\t}\n\n\tfunction unregisterFill( name, ref ) {\n\t\tconst fillsForName = fills.get( name );\n\t\tif ( ! fillsForName ) {\n\t\t\treturn;\n\t\t}\n\n\t\tfills.set(\n\t\t\tname,\n\t\t\tvalRef( fillsForName.filter( ( fillRef ) => fillRef !== ref ) )\n\t\t);\n\t}\n\n\treturn {\n\t\tslots,\n\t\tfills,\n\t\tregisterSlot,\n\t\tupdateSlot,\n\t\tunregisterSlot,\n\t\tregisterFill,\n\t\tunregisterFill,\n\t};\n}\n\nexport default function SlotFillProvider( { children } ) {\n\tconst [ registry ] = useState( createSlotRegistry );\n\treturn (\n\t\t<SlotFillContext.Provider value={ registry }>\n\t\t\t{ children }\n\t\t</SlotFillContext.Provider>\n\t);\n}\n"],"mappings":"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"}