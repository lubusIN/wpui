{"version":3,"names":["EquivalentKeyMap","selectorArgsToStateKey","onSubKey","subKeysIsResolved","state","action","type","nextState","set","args","status","error","resolutionArgs","forEach","idx","resolutionState","undefined","errors","delete","isResolved","selectorName","removedSelector","restState"],"sources":["@wordpress/data/src/redux-store/metadata/reducer.ts"],"sourcesContent":["/**\n * External dependencies\n */\nimport EquivalentKeyMap from 'equivalent-key-map';\nimport type { Reducer } from 'redux';\n\n/**\n * Internal dependencies\n */\nimport { selectorArgsToStateKey, onSubKey } from './utils';\n\ntype Action =\n\t| ReturnType< typeof import('./actions').startResolution >\n\t| ReturnType< typeof import('./actions').finishResolution >\n\t| ReturnType< typeof import('./actions').failResolution >\n\t| ReturnType< typeof import('./actions').startResolutions >\n\t| ReturnType< typeof import('./actions').finishResolutions >\n\t| ReturnType< typeof import('./actions').failResolutions >\n\t| ReturnType< typeof import('./actions').invalidateResolution >\n\t| ReturnType< typeof import('./actions').invalidateResolutionForStore >\n\t| ReturnType<\n\t\t\ttypeof import('./actions').invalidateResolutionForStoreSelector\n\t  >;\n\ntype StateKey = unknown[] | unknown;\nexport type StateValue =\n\t| { status: 'resolving' | 'finished' }\n\t| { status: 'error'; error: Error | unknown };\n\nexport type Status = StateValue[ 'status' ];\nexport type State = EquivalentKeyMap< StateKey, StateValue >;\n\n/**\n * Reducer function returning next state for selector resolution of\n * subkeys, object form:\n *\n *  selectorName -> EquivalentKeyMap<Array,boolean>\n */\nconst subKeysIsResolved: Reducer< Record< string, State >, Action > = onSubKey<\n\tState,\n\tAction\n>( 'selectorName' )( ( state = new EquivalentKeyMap(), action: Action ) => {\n\tswitch ( action.type ) {\n\t\tcase 'START_RESOLUTION': {\n\t\t\tconst nextState = new EquivalentKeyMap( state );\n\t\t\tnextState.set( selectorArgsToStateKey( action.args ), {\n\t\t\t\tstatus: 'resolving',\n\t\t\t} );\n\t\t\treturn nextState;\n\t\t}\n\t\tcase 'FINISH_RESOLUTION': {\n\t\t\tconst nextState = new EquivalentKeyMap( state );\n\t\t\tnextState.set( selectorArgsToStateKey( action.args ), {\n\t\t\t\tstatus: 'finished',\n\t\t\t} );\n\t\t\treturn nextState;\n\t\t}\n\t\tcase 'FAIL_RESOLUTION': {\n\t\t\tconst nextState = new EquivalentKeyMap( state );\n\t\t\tnextState.set( selectorArgsToStateKey( action.args ), {\n\t\t\t\tstatus: 'error',\n\t\t\t\terror: action.error,\n\t\t\t} );\n\t\t\treturn nextState;\n\t\t}\n\t\tcase 'START_RESOLUTIONS': {\n\t\t\tconst nextState = new EquivalentKeyMap( state );\n\t\t\tfor ( const resolutionArgs of action.args ) {\n\t\t\t\tnextState.set( selectorArgsToStateKey( resolutionArgs ), {\n\t\t\t\t\tstatus: 'resolving',\n\t\t\t\t} );\n\t\t\t}\n\t\t\treturn nextState;\n\t\t}\n\t\tcase 'FINISH_RESOLUTIONS': {\n\t\t\tconst nextState = new EquivalentKeyMap( state );\n\t\t\tfor ( const resolutionArgs of action.args ) {\n\t\t\t\tnextState.set( selectorArgsToStateKey( resolutionArgs ), {\n\t\t\t\t\tstatus: 'finished',\n\t\t\t\t} );\n\t\t\t}\n\t\t\treturn nextState;\n\t\t}\n\t\tcase 'FAIL_RESOLUTIONS': {\n\t\t\tconst nextState = new EquivalentKeyMap( state );\n\t\t\taction.args.forEach( ( resolutionArgs, idx ) => {\n\t\t\t\tconst resolutionState: StateValue = {\n\t\t\t\t\tstatus: 'error',\n\t\t\t\t\terror: undefined,\n\t\t\t\t};\n\n\t\t\t\tconst error = action.errors[ idx ];\n\t\t\t\tif ( error ) {\n\t\t\t\t\tresolutionState.error = error;\n\t\t\t\t}\n\n\t\t\t\tnextState.set(\n\t\t\t\t\tselectorArgsToStateKey( resolutionArgs as unknown[] ),\n\t\t\t\t\tresolutionState\n\t\t\t\t);\n\t\t\t} );\n\t\t\treturn nextState;\n\t\t}\n\t\tcase 'INVALIDATE_RESOLUTION': {\n\t\t\tconst nextState = new EquivalentKeyMap( state );\n\t\t\tnextState.delete( selectorArgsToStateKey( action.args ) );\n\t\t\treturn nextState;\n\t\t}\n\t}\n\treturn state;\n} );\n\n/**\n * Reducer function returning next state for selector resolution, object form:\n *\n *   selectorName -> EquivalentKeyMap<Array, boolean>\n *\n * @param state  Current state.\n * @param action Dispatched action.\n *\n * @return Next state.\n */\nconst isResolved = ( state: Record< string, State > = {}, action: Action ) => {\n\tswitch ( action.type ) {\n\t\tcase 'INVALIDATE_RESOLUTION_FOR_STORE':\n\t\t\treturn {};\n\t\tcase 'INVALIDATE_RESOLUTION_FOR_STORE_SELECTOR': {\n\t\t\tif ( action.selectorName in state ) {\n\t\t\t\tconst {\n\t\t\t\t\t[ action.selectorName ]: removedSelector,\n\t\t\t\t\t...restState\n\t\t\t\t} = state;\n\t\t\t\treturn restState;\n\t\t\t}\n\t\t\treturn state;\n\t\t}\n\t\tcase 'START_RESOLUTION':\n\t\tcase 'FINISH_RESOLUTION':\n\t\tcase 'FAIL_RESOLUTION':\n\t\tcase 'START_RESOLUTIONS':\n\t\tcase 'FINISH_RESOLUTIONS':\n\t\tcase 'FAIL_RESOLUTIONS':\n\t\tcase 'INVALIDATE_RESOLUTION':\n\t\t\treturn subKeysIsResolved( state, action );\n\t}\n\treturn state;\n};\n\nexport default isResolved;\n"],"mappings":"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"}