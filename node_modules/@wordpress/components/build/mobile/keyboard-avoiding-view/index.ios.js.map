{"version":3,"names":["_element","require","_reactNative","_reactNativeSafeArea","_interopRequireDefault","_compose","_useIsFloatingKeyboard","_styles","AnimatedKeyboardAvoidingView","Animated","createAnimatedComponent","IOSKeyboardAvoidingView","MIN_HEIGHT","KeyboardAvoidingView","parentHeight","style","withAnimatedHeight","otherProps","resizeObserver","sizes","useResizeObserver","isKeyboardOpen","setIsKeyboardOpen","useState","safeAreaBottomInset","setSafeAreaBottomInset","height","floatingKeyboard","useIsFloatingKeyboard","animatedHeight","useRef","Value","current","fullHeight","Dimensions","get","keyboardVerticalOffset","useEffect","SafeArea","getSafeAreaInsetsForRootView","then","safeAreaInsets","bottom","safeAreaSubscription","addEventListener","onSafeAreaInsetsUpdate","keyboardShowSubscription","Keyboard","addListener","onKeyboardWillShow","keyboardHideSubscription","onKeyboardWillHide","remove","endCoordinates","setValue","duration","startCoordinates","keyboardIsOpenBreakpoint","animatedListenerId","value","timing","toValue","useNativeDriver","start","removeListener","createElement","enabled","behavior","marginBottom","View","top","styles","animatedChildStyle","defaultChildStyle","children","exports","_default","default"],"sources":["@wordpress/components/src/mobile/keyboard-avoiding-view/index.ios.js"],"sourcesContent":["/**\n * External dependencies\n */\nimport {\n\tKeyboardAvoidingView as IOSKeyboardAvoidingView,\n\tAnimated,\n\tKeyboard,\n\tDimensions,\n\tView,\n} from 'react-native';\nimport SafeArea from 'react-native-safe-area';\n\n/**\n * WordPress dependencies\n */\nimport { useEffect, useRef, useState } from '@wordpress/element';\nimport { useResizeObserver } from '@wordpress/compose';\n\n/**\n * Internal dependencies\n */\nimport useIsFloatingKeyboard from '../utils/use-is-floating-keyboard';\nimport styles from './styles.scss';\n\nconst AnimatedKeyboardAvoidingView = Animated.createAnimatedComponent(\n\tIOSKeyboardAvoidingView\n);\n\nconst MIN_HEIGHT = 44;\n\nexport const KeyboardAvoidingView = ( {\n\tparentHeight,\n\tstyle,\n\twithAnimatedHeight = false,\n\t...otherProps\n} ) => {\n\tconst [ resizeObserver, sizes ] = useResizeObserver();\n\tconst [ isKeyboardOpen, setIsKeyboardOpen ] = useState( false );\n\tconst [ safeAreaBottomInset, setSafeAreaBottomInset ] = useState( 0 );\n\tconst { height = 0 } = sizes || {};\n\tconst floatingKeyboard = useIsFloatingKeyboard();\n\n\tconst animatedHeight = useRef( new Animated.Value( MIN_HEIGHT ) ).current;\n\n\tconst { height: fullHeight } = Dimensions.get( 'screen' );\n\tconst keyboardVerticalOffset = fullHeight - parentHeight;\n\n\tuseEffect( () => {\n\t\tSafeArea.getSafeAreaInsetsForRootView().then(\n\t\t\t( { safeAreaInsets } ) => {\n\t\t\t\tsetSafeAreaBottomInset( safeAreaInsets.bottom );\n\t\t\t}\n\t\t);\n\t\tconst safeAreaSubscription = SafeArea.addEventListener(\n\t\t\t'safeAreaInsetsForRootViewDidChange',\n\t\t\tonSafeAreaInsetsUpdate\n\t\t);\n\t\tconst keyboardShowSubscription = Keyboard.addListener(\n\t\t\t'keyboardWillShow',\n\t\t\tonKeyboardWillShow\n\t\t);\n\t\tconst keyboardHideSubscription = Keyboard.addListener(\n\t\t\t'keyboardWillHide',\n\t\t\tonKeyboardWillHide\n\t\t);\n\n\t\treturn () => {\n\t\t\tsafeAreaSubscription.remove();\n\t\t\tkeyboardShowSubscription.remove();\n\t\t\tkeyboardHideSubscription.remove();\n\t\t};\n\t\t// Disable reason: deferring this refactor to the native team.\n\t\t// see https://github.com/WordPress/gutenberg/pull/41166\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [] );\n\n\tfunction onSafeAreaInsetsUpdate( { safeAreaInsets } ) {\n\t\tsetSafeAreaBottomInset( safeAreaInsets.bottom );\n\t}\n\n\tfunction onKeyboardWillShow( { endCoordinates } ) {\n\t\tsetIsKeyboardOpen( true );\n\t\tanimatedHeight.setValue( endCoordinates.height + MIN_HEIGHT );\n\t}\n\n\tfunction onKeyboardWillHide( { duration, startCoordinates } ) {\n\t\t// The startCoordinates.height is set to wrong value when we use cmd + k for hide the keyboard (Have no idea why).\n\t\t// Because of that the `setIsKeyboardOpened` is not invoked and the state of keyboard is wrong.\n\t\t// The keyboardIsOpenBreakpoint use 100 as a fallback if the startCoordinates.height is too small (cmd + k case)\n\t\tconst keyboardIsOpenBreakpoint =\n\t\t\tstartCoordinates.height > 100 ? startCoordinates.height / 3 : 100;\n\t\tconst animatedListenerId = animatedHeight.addListener(\n\t\t\t( { value } ) => {\n\t\t\t\tif ( value < keyboardIsOpenBreakpoint ) {\n\t\t\t\t\tsetIsKeyboardOpen( false );\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\tAnimated.timing( animatedHeight, {\n\t\t\ttoValue: MIN_HEIGHT,\n\t\t\tduration,\n\t\t\tuseNativeDriver: false,\n\t\t} ).start( () => {\n\t\t\tanimatedHeight.removeListener( animatedListenerId );\n\t\t} );\n\t}\n\n\treturn (\n\t\t<AnimatedKeyboardAvoidingView\n\t\t\t{ ...otherProps }\n\t\t\tenabled={ ! floatingKeyboard }\n\t\t\tbehavior=\"padding\"\n\t\t\tkeyboardVerticalOffset={ keyboardVerticalOffset }\n\t\t\tstyle={\n\t\t\t\twithAnimatedHeight\n\t\t\t\t\t? [\n\t\t\t\t\t\t\tstyle,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\theight: animatedHeight,\n\t\t\t\t\t\t\t\tmarginBottom: isKeyboardOpen\n\t\t\t\t\t\t\t\t\t? -safeAreaBottomInset\n\t\t\t\t\t\t\t\t\t: 0,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t  ]\n\t\t\t\t\t: style\n\t\t\t}\n\t\t>\n\t\t\t<View\n\t\t\t\tstyle={ [\n\t\t\t\t\t{\n\t\t\t\t\t\ttop: -height + MIN_HEIGHT,\n\t\t\t\t\t},\n\t\t\t\t\tstyles.animatedChildStyle,\n\t\t\t\t\t! withAnimatedHeight && styles.defaultChildStyle,\n\t\t\t\t] }\n\t\t\t>\n\t\t\t\t{ resizeObserver }\n\t\t\t\t{ otherProps.children }\n\t\t\t</View>\n\t\t</AnimatedKeyboardAvoidingView>\n\t);\n};\n\nexport default KeyboardAvoidingView;\n"],"mappings":"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"}