{"version":3,"names":["useRef","useReducer","useRefEffect","LEFT","RIGHT","isCollapsed","EMPTY_ACTIVE_FORMATS","useFormatBoundaries","props","forceRender","propsRef","current","element","onKeyDown","event","keyCode","shiftKey","altKey","metaKey","ctrlKey","record","applyRecord","text","formats","start","end","activeFormats","currentActiveFormats","collapsed","ownerDocument","defaultView","direction","getComputedStyle","reverseKey","isReverse","length","formatsBefore","formatsAfter","destination","isIncreasing","every","format","index","newActiveFormatsLength","_newActiveFormats","preventDefault","origin","source","newActiveFormats","slice","newValue","addEventListener","removeEventListener"],"sources":["@wordpress/rich-text/src/component/use-format-boundaries.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useRef, useReducer } from '@wordpress/element';\nimport { useRefEffect } from '@wordpress/compose';\nimport { LEFT, RIGHT } from '@wordpress/keycodes';\n\n/**\n * Internal dependencies\n */\nimport { isCollapsed } from '../is-collapsed';\n\nconst EMPTY_ACTIVE_FORMATS = [];\n\nexport function useFormatBoundaries( props ) {\n\tconst [ , forceRender ] = useReducer( () => ( {} ) );\n\tconst propsRef = useRef( props );\n\tpropsRef.current = props;\n\treturn useRefEffect( ( element ) => {\n\t\tfunction onKeyDown( event ) {\n\t\t\tconst { keyCode, shiftKey, altKey, metaKey, ctrlKey } = event;\n\n\t\t\tif (\n\t\t\t\t// Only override left and right keys without modifiers pressed.\n\t\t\t\tshiftKey ||\n\t\t\t\taltKey ||\n\t\t\t\tmetaKey ||\n\t\t\t\tctrlKey ||\n\t\t\t\t( keyCode !== LEFT && keyCode !== RIGHT )\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { record, applyRecord } = propsRef.current;\n\t\t\tconst {\n\t\t\t\ttext,\n\t\t\t\tformats,\n\t\t\t\tstart,\n\t\t\t\tend,\n\t\t\t\tactiveFormats: currentActiveFormats = [],\n\t\t\t} = record.current;\n\t\t\tconst collapsed = isCollapsed( record.current );\n\t\t\tconst { ownerDocument } = element;\n\t\t\tconst { defaultView } = ownerDocument;\n\t\t\t// To do: ideally, we should look at visual position instead.\n\t\t\tconst { direction } = defaultView.getComputedStyle( element );\n\t\t\tconst reverseKey = direction === 'rtl' ? RIGHT : LEFT;\n\t\t\tconst isReverse = event.keyCode === reverseKey;\n\n\t\t\t// If the selection is collapsed and at the very start, do nothing if\n\t\t\t// navigating backward.\n\t\t\t// If the selection is collapsed and at the very end, do nothing if\n\t\t\t// navigating forward.\n\t\t\tif ( collapsed && currentActiveFormats.length === 0 ) {\n\t\t\t\tif ( start === 0 && isReverse ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif ( end === text.length && ! isReverse ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// If the selection is not collapsed, let the browser handle collapsing\n\t\t\t// the selection for now. Later we could expand this logic to set\n\t\t\t// boundary positions if needed.\n\t\t\tif ( ! collapsed ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst formatsBefore = formats[ start - 1 ] || EMPTY_ACTIVE_FORMATS;\n\t\t\tconst formatsAfter = formats[ start ] || EMPTY_ACTIVE_FORMATS;\n\t\t\tconst destination = isReverse ? formatsBefore : formatsAfter;\n\t\t\tconst isIncreasing = currentActiveFormats.every(\n\t\t\t\t( format, index ) => format === destination[ index ]\n\t\t\t);\n\n\t\t\tlet newActiveFormatsLength = currentActiveFormats.length;\n\n\t\t\tif ( ! isIncreasing ) {\n\t\t\t\tnewActiveFormatsLength--;\n\t\t\t} else if ( newActiveFormatsLength < destination.length ) {\n\t\t\t\tnewActiveFormatsLength++;\n\t\t\t}\n\n\t\t\tif ( newActiveFormatsLength === currentActiveFormats.length ) {\n\t\t\t\trecord.current._newActiveFormats = destination;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tevent.preventDefault();\n\n\t\t\tconst origin = isReverse ? formatsAfter : formatsBefore;\n\t\t\tconst source = isIncreasing ? destination : origin;\n\t\t\tconst newActiveFormats = source.slice( 0, newActiveFormatsLength );\n\t\t\tconst newValue = {\n\t\t\t\t...record.current,\n\t\t\t\tactiveFormats: newActiveFormats,\n\t\t\t};\n\t\t\trecord.current = newValue;\n\t\t\tapplyRecord( newValue );\n\t\t\tforceRender();\n\t\t}\n\n\t\telement.addEventListener( 'keydown', onKeyDown );\n\t\treturn () => {\n\t\t\telement.removeEventListener( 'keydown', onKeyDown );\n\t\t};\n\t}, [] );\n}\n"],"mappings":"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"}