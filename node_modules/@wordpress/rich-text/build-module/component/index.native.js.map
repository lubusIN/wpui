{"version":3,"names":["View","Platform","Dimensions","memize","colord","RCTAztecView","showUserSuggestions","showXpostSuggestions","BlockFormatControls","getPxFromCssUnit","Component","compose","debounce","withPreferredColorScheme","withSelect","childrenBlock","decodeEntities","BACKSPACE","DELETE","ENTER","isURL","atSymbol","plus","__","useFormatTypes","FormatEdit","applyFormat","getActiveFormat","getActiveFormats","insert","getTextContent","isEmpty","create","toHTMLString","isCollapsed","remove","getFormatColors","styles","ToolbarButtonWithOptions","unescapeSpaces","text","replace","flatColorPalettes","colorsPalettes","theme","custom","default","getSelectionColor","currentSelectionColor","defaultSelectionColor","baseGlobalStyles","isBlockBasedTheme","selectionColor","colordTextColor","colordBackgroundColor","color","background","isColordTextReadable","isReadable","gutenbergFormatNamesToAztec","EMPTY_PARAGRAPH_TAGS","DEFAULT_FONT_SIZE","MIN_LINE_HEIGHT","RichText","constructor","value","selectionStart","selectionEnd","__unstableMultilineTag","multiline","arguments","isMultiline","multilineTag","multilineWrapperTags","isIOS","OS","createRecord","bind","restoreParagraphTags","onChangeFromAztec","onKeyDown","handleEnter","handleDelete","onPaste","onFocus","onBlur","onTextUpdate","onContentSizeChange","onFormatChange","formatToValue","maxSize","debounceCreateUndoLevel","onCreateUndoLevel","onSelectionChange","onSelectionChangeFromAztec","valueToFormat","getHtmlToRender","handleSuggestionFunc","handleUserSuggestion","handleXpostSuggestion","suggestionOptions","insertString","manipulateEventCounterToForceNativeToRefresh","shouldDropEventFromAztec","state","activeFormats","selectedFormat","height","currentFontSize","getFontSize","needsSelectionUpdate","savedContent","isTouched","lastAztecEventType","lastHistoryValue","getRecord","start","end","colorPalette","props","currentValue","formats","replacements","newFormats","preserveWhiteSpace","html","range","Math","min","length","removeRootTagsProducedByAztec","getActiveFormatNames","record","formatTypes","map","name","filter","undefined","Boolean","changeHandlers","Object","fromEntries","entries","key","startsWith","values","forEach","changeHandler","onChange","setState","string","toInsert","__unstableOnCreateUndoLevel","result","removeRootTag","tagName","tagsToEliminate","element","removeTag","tag","openingTagRegexp","RegExp","closingTagRegexp","event","contentWithoutRootTag","nativeEvent","lastEventCount","eventCount","comesFromAztec","firedAfterTextChanged","formattedContent","refresh","contentSize","defaultPrevented","customEditableOnKeyDown","preventDefault","KeyCodes","keyCode","handleTriggerKeyCodes","onEnter","shiftKey","isReverse","onDelete","newValue","triggeredOption","find","option","triggeredKeyCode","triggerChar","charCodeAt","useTrigger","charAt","onClick","areMentionsSupported","areXPostsSupported","allOptions","supported","title","label","icon","op","suggestionFunction","prefix","then","suggestion","catch","pastedText","pastedHtml","files","currentRecord","trimmedText","trim","linkedRecord","type","attributes","href","window","console","log","plainText","unstableOnFocus","hasChanged","isManual","logText","shouldDrop","realStart","realEnd","max","__unstableIsSelected","Array","isArray","toHTML","format","shouldComponentUpdate","nextProps","nextState","reversed","fontSize","style","lineHeight","componentDidMount","blockIsSelected","__unstableMobileNoFocusOnMount","_editor","focus","componentWillUnmount","isFocused","blur","componentDidUpdate","prevProps","isSelected","prevIsSelected","currentFontSizeStyle","getParsedFontSize","prevFontSizeStyle","isDifferentTag","extraAttributes","getEditableProps","className","_getPxFromCssUnit","width","get","cssUnitOptions","selectedPxValue","parseFloat","tagNameFontSize","elements","typography","newFontSize","getLineHeight","tagNameLineHeight","newLineHeight","getIsBlockBasedTheme","isNaN","getBlockUseDefaultFont","tagsToMatch","test","getLinkTextColor","defaultColor","customColor","linkColor","isValid","toHex","getPlaceholderTextColor","_ref","_ref2","getStylesFromColorScheme","placeholderTextColor","placeholderStyle","richTextPlaceholder","richTextPlaceholderDark","defaultPlaceholderTextColor","placeholderOpacity","inheritPlaceholderColor","placeholderColor","globalStylesPlaceholderColor","render","children","minWidth","maxWidth","parentBlockStyles","accessibilityLabel","disableEditingMenu","disableSuggestions","containerWidth","editableProps","blockUseDefaultFont","textDecorationColor","defaultTextDecorationColor","fontFamily","defaultFontFamily","richText","richTextDark","linkTextColor","currentSelectionStart","currentSelectionEnd","selection","brBeforeParaMatches","match","warn","count","newSelectionStart","newSelectionEnd","containerStyles","padding","backgroundColor","EditableView","createElement","Fragment","editableTagName","ref","setRef","minHeight","placeholder","deleteEnter","triggerKeyCodes","blockType","maxImagesWidth","fontWeight","fontStyle","textAlign","id","disableAutocorrection","forwardedRef","options","defaultProps","withFormatTypes","WrappedComponent","clientId","identifier","withoutInteractiveFormatting","allowedFormats","select","getBlockParents","getBlock","getSettings","parents","parentBlock","childrenStyles","settings","__experimentalGlobalStylesBaseStyles","colorPalettes","__experimentalFeatures","palette","colors","capabilities","mentions","xposts"],"sources":["@wordpress/rich-text/src/component/index.native.js"],"sourcesContent":["/* eslint no-console: [\"error\", { allow: [\"warn\"] }] */\n\n/**\n * External dependencies\n */\nimport { View, Platform, Dimensions } from 'react-native';\nimport memize from 'memize';\nimport { colord } from 'colord';\n\n/**\n * WordPress dependencies\n */\nimport RCTAztecView from '@wordpress/react-native-aztec';\nimport {\n\tshowUserSuggestions,\n\tshowXpostSuggestions,\n} from '@wordpress/react-native-bridge';\nimport { BlockFormatControls, getPxFromCssUnit } from '@wordpress/block-editor';\nimport { Component } from '@wordpress/element';\nimport {\n\tcompose,\n\tdebounce,\n\twithPreferredColorScheme,\n} from '@wordpress/compose';\nimport { withSelect } from '@wordpress/data';\nimport { childrenBlock } from '@wordpress/blocks';\nimport { decodeEntities } from '@wordpress/html-entities';\nimport { BACKSPACE, DELETE, ENTER } from '@wordpress/keycodes';\nimport { isURL } from '@wordpress/url';\nimport { atSymbol, plus } from '@wordpress/icons';\nimport { __ } from '@wordpress/i18n';\n\n/**\n * Internal dependencies\n */\nimport { useFormatTypes } from './use-format-types';\nimport FormatEdit from './format-edit';\nimport { applyFormat } from '../apply-format';\nimport { getActiveFormat } from '../get-active-format';\nimport { getActiveFormats } from '../get-active-formats';\nimport { insert } from '../insert';\nimport { getTextContent } from '../get-text-content';\nimport { isEmpty } from '../is-empty';\nimport { create } from '../create';\nimport { toHTMLString } from '../to-html-string';\nimport { isCollapsed } from '../is-collapsed';\nimport { remove } from '../remove';\nimport { getFormatColors } from '../get-format-colors';\nimport styles from './style.scss';\nimport ToolbarButtonWithOptions from './toolbar-button-with-options';\n\nconst unescapeSpaces = ( text ) => {\n\treturn text.replace( /&nbsp;|&#160;/gi, ' ' );\n};\n\n// The flattened color palettes array is memoized to ensure that the same array instance is\n// returned for the colors palettes. This value might be used as a prop, so having the same\n// instance will prevent unnecessary re-renders of the RichText component.\nconst flatColorPalettes = memize( ( colorsPalettes ) => [\n\t...( colorsPalettes?.theme || [] ),\n\t...( colorsPalettes?.custom || [] ),\n\t...( colorsPalettes?.default || [] ),\n] );\n\nconst getSelectionColor = memize(\n\t(\n\t\tcurrentSelectionColor,\n\t\tdefaultSelectionColor,\n\t\tbaseGlobalStyles,\n\t\tisBlockBasedTheme\n\t) => {\n\t\tlet selectionColor = defaultSelectionColor;\n\t\tif ( currentSelectionColor ) {\n\t\t\tselectionColor = currentSelectionColor;\n\t\t}\n\n\t\tif ( isBlockBasedTheme ) {\n\t\t\tconst colordTextColor = colord( selectionColor );\n\t\t\tconst colordBackgroundColor = colord(\n\t\t\t\tbaseGlobalStyles?.color?.background\n\t\t\t);\n\t\t\tconst isColordTextReadable = colordTextColor.isReadable(\n\t\t\t\tcolordBackgroundColor\n\t\t\t);\n\t\t\tif ( ! isColordTextReadable ) {\n\t\t\t\tselectionColor = baseGlobalStyles?.color?.text;\n\t\t\t}\n\t\t}\n\n\t\treturn selectionColor;\n\t}\n);\n\nconst gutenbergFormatNamesToAztec = {\n\t'core/bold': 'bold',\n\t'core/italic': 'italic',\n\t'core/strikethrough': 'strikethrough',\n\t'core/text-color': 'mark',\n};\n\nconst EMPTY_PARAGRAPH_TAGS = '<p></p>';\nconst DEFAULT_FONT_SIZE = 16;\nconst MIN_LINE_HEIGHT = 1;\n\nexport class RichText extends Component {\n\tconstructor( {\n\t\tvalue,\n\t\tselectionStart,\n\t\tselectionEnd,\n\t\t__unstableMultilineTag: multiline,\n\t} ) {\n\t\tsuper( ...arguments );\n\n\t\tthis.isMultiline = false;\n\t\tif ( multiline === true || multiline === 'p' || multiline === 'li' ) {\n\t\t\tthis.multilineTag = multiline === true ? 'p' : multiline;\n\t\t\tthis.isMultiline = true;\n\t\t}\n\n\t\tif ( this.multilineTag === 'li' ) {\n\t\t\tthis.multilineWrapperTags = [ 'ul', 'ol' ];\n\t\t}\n\n\t\tthis.isIOS = Platform.OS === 'ios';\n\t\tthis.createRecord = this.createRecord.bind( this );\n\t\tthis.restoreParagraphTags = this.restoreParagraphTags.bind( this );\n\t\tthis.onChangeFromAztec = this.onChangeFromAztec.bind( this );\n\t\tthis.onKeyDown = this.onKeyDown.bind( this );\n\t\tthis.handleEnter = this.handleEnter.bind( this );\n\t\tthis.handleDelete = this.handleDelete.bind( this );\n\t\tthis.onPaste = this.onPaste.bind( this );\n\t\tthis.onFocus = this.onFocus.bind( this );\n\t\tthis.onBlur = this.onBlur.bind( this );\n\t\tthis.onTextUpdate = this.onTextUpdate.bind( this );\n\t\tthis.onContentSizeChange = this.onContentSizeChange.bind( this );\n\t\tthis.onFormatChange = this.onFormatChange.bind( this );\n\t\tthis.formatToValue = memize( this.formatToValue.bind( this ), {\n\t\t\tmaxSize: 1,\n\t\t} );\n\t\tthis.debounceCreateUndoLevel = debounce( this.onCreateUndoLevel, 1000 );\n\t\t// This prevents a bug in Aztec which triggers onSelectionChange twice on format change.\n\t\tthis.onSelectionChange = this.onSelectionChange.bind( this );\n\t\tthis.onSelectionChangeFromAztec =\n\t\t\tthis.onSelectionChangeFromAztec.bind( this );\n\t\tthis.valueToFormat = this.valueToFormat.bind( this );\n\t\tthis.getHtmlToRender = this.getHtmlToRender.bind( this );\n\t\tthis.handleSuggestionFunc = this.handleSuggestionFunc.bind( this );\n\t\tthis.handleUserSuggestion = this.handleSuggestionFunc(\n\t\t\tshowUserSuggestions,\n\t\t\t'@'\n\t\t).bind( this );\n\t\tthis.handleXpostSuggestion = this.handleSuggestionFunc(\n\t\t\tshowXpostSuggestions,\n\t\t\t'+'\n\t\t).bind( this );\n\t\tthis.suggestionOptions = this.suggestionOptions.bind( this );\n\t\tthis.insertString = this.insertString.bind( this );\n\t\tthis.manipulateEventCounterToForceNativeToRefresh =\n\t\t\tthis.manipulateEventCounterToForceNativeToRefresh.bind( this );\n\t\tthis.shouldDropEventFromAztec =\n\t\t\tthis.shouldDropEventFromAztec.bind( this );\n\t\tthis.state = {\n\t\t\tactiveFormats: [],\n\t\t\tselectedFormat: null,\n\t\t\theight: 0,\n\t\t\tcurrentFontSize: this.getFontSize( arguments[ 0 ] ),\n\t\t};\n\t\tthis.needsSelectionUpdate = false;\n\t\tthis.savedContent = '';\n\t\tthis.isTouched = false;\n\t\tthis.lastAztecEventType = null;\n\n\t\tthis.lastHistoryValue = value;\n\n\t\t// Internal values that are update synchronously, unlike props.\n\t\tthis.value = value;\n\t\tthis.selectionStart = selectionStart;\n\t\tthis.selectionEnd = selectionEnd;\n\t}\n\n\t/**\n\t * Get the current record (value and selection) from props and state.\n\t *\n\t * @return {Object} The current record (value and selection).\n\t */\n\tgetRecord() {\n\t\tconst {\n\t\t\tselectionStart: start,\n\t\t\tselectionEnd: end,\n\t\t\tcolorPalette,\n\t\t} = this.props;\n\t\tconst { value } = this.props;\n\t\tconst currentValue = this.formatToValue( value );\n\n\t\tconst { formats, replacements, text } = currentValue;\n\t\tconst { activeFormats } = this.state;\n\t\tconst newFormats = getFormatColors( value, formats, colorPalette );\n\n\t\treturn {\n\t\t\tformats: newFormats,\n\t\t\treplacements,\n\t\t\ttext,\n\t\t\tstart,\n\t\t\tend,\n\t\t\tactiveFormats,\n\t\t};\n\t}\n\n\t/**\n\t * Creates a RichText value \"record\" from the current content and selection\n\t * information\n\t *\n\t *\n\t * @return {Object} A RichText value with formats and selection.\n\t */\n\tcreateRecord() {\n\t\tconst { preserveWhiteSpace } = this.props;\n\t\tconst value = {\n\t\t\tstart: this.selectionStart,\n\t\t\tend: this.selectionEnd,\n\t\t\t...create( {\n\t\t\t\thtml: this.value,\n\t\t\t\trange: null,\n\t\t\t\tmultilineTag: this.multilineTag,\n\t\t\t\tmultilineWrapperTags: this.multilineWrapperTags,\n\t\t\t\tpreserveWhiteSpace,\n\t\t\t} ),\n\t\t};\n\t\tconst start = Math.min( this.selectionStart, value.text.length );\n\t\tconst end = Math.min( this.selectionEnd, value.text.length );\n\t\treturn { ...value, start, end };\n\t}\n\n\tvalueToFormat( value ) {\n\t\t// Remove the outer root tags.\n\t\treturn this.removeRootTagsProducedByAztec(\n\t\t\ttoHTMLString( {\n\t\t\t\tvalue,\n\t\t\t\tmultilineTag: this.multilineTag,\n\t\t\t} )\n\t\t);\n\t}\n\n\tgetActiveFormatNames( record ) {\n\t\tconst { formatTypes } = this.props;\n\n\t\treturn formatTypes\n\t\t\t.map( ( { name } ) => name )\n\t\t\t.filter( ( name ) => {\n\t\t\t\treturn getActiveFormat( record, name ) !== undefined;\n\t\t\t} )\n\t\t\t.map( ( name ) => gutenbergFormatNamesToAztec[ name ] )\n\t\t\t.filter( Boolean );\n\t}\n\n\tonFormatChange( record ) {\n\t\tconst { start = 0, end = 0, activeFormats = [] } = record;\n\t\tconst changeHandlers = Object.fromEntries(\n\t\t\tObject.entries( this.props ).filter( ( [ key ] ) =>\n\t\t\t\tkey.startsWith( 'format_on_change_functions_' )\n\t\t\t)\n\t\t);\n\n\t\tObject.values( changeHandlers ).forEach( ( changeHandler ) => {\n\t\t\tchangeHandler( record.formats, record.text );\n\t\t} );\n\n\t\tthis.value = this.valueToFormat( record );\n\t\tthis.props.onChange( this.value );\n\t\tthis.setState( { activeFormats } );\n\t\tthis.props.onSelectionChange( start, end );\n\t\tthis.selectionStart = start;\n\t\tthis.selectionEnd = end;\n\n\t\tthis.onCreateUndoLevel();\n\n\t\tthis.lastAztecEventType = 'format change';\n\t}\n\n\tinsertString( record, string ) {\n\t\tif ( record && string ) {\n\t\t\tthis.manipulateEventCounterToForceNativeToRefresh(); // force a refresh on the native side\n\t\t\tconst toInsert = insert( record, string );\n\t\t\tthis.onFormatChange( toInsert );\n\t\t}\n\t}\n\n\tonCreateUndoLevel() {\n\t\tconst { __unstableOnCreateUndoLevel: onCreateUndoLevel } = this.props;\n\t\t// If the content is the same, no level needs to be created.\n\t\tif ( this.lastHistoryValue === this.value ) {\n\t\t\treturn;\n\t\t}\n\n\t\tonCreateUndoLevel();\n\t\tthis.lastHistoryValue = this.value;\n\t}\n\n\t/*\n\t * Cleans up any root tags produced by aztec.\n\t * TODO: This should be removed on a later version when aztec doesn't return the top tag of the text being edited\n\t */\n\tremoveRootTagsProducedByAztec( html ) {\n\t\tlet result = this.removeRootTag( this.props.tagName, html );\n\n\t\tif ( this.props.tagsToEliminate ) {\n\t\t\tthis.props.tagsToEliminate.forEach( ( element ) => {\n\t\t\t\tresult = this.removeTag( element, result );\n\t\t\t} );\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tremoveRootTag( tag, html ) {\n\t\tconst openingTagRegexp = RegExp( '^<' + tag + '[^>]*>', 'gim' );\n\t\tconst closingTagRegexp = RegExp( '</' + tag + '>$', 'gim' );\n\n\t\treturn html\n\t\t\t.replace( openingTagRegexp, '' )\n\t\t\t.replace( closingTagRegexp, '' );\n\t}\n\n\tremoveTag( tag, html ) {\n\t\tconst openingTagRegexp = RegExp( '<' + tag + '>', 'gim' );\n\t\tconst closingTagRegexp = RegExp( '</' + tag + '>', 'gim' );\n\t\treturn html\n\t\t\t.replace( openingTagRegexp, '' )\n\t\t\t.replace( closingTagRegexp, '' );\n\t}\n\n\t/*\n\t * Handles any case where the content of the AztecRN instance has changed\n\t */\n\tonChangeFromAztec( event ) {\n\t\tif ( this.shouldDropEventFromAztec( event, 'onChange' ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst contentWithoutRootTag = this.removeRootTagsProducedByAztec(\n\t\t\tunescapeSpaces( event.nativeEvent.text )\n\t\t);\n\t\t// On iOS, onChange can be triggered after selection changes, even though there are no content changes.\n\t\tif ( contentWithoutRootTag === this.value ) {\n\t\t\treturn;\n\t\t}\n\t\tthis.lastEventCount = event.nativeEvent.eventCount;\n\t\tthis.comesFromAztec = true;\n\t\tthis.firedAfterTextChanged = true; // The onChange event always fires after the fact.\n\t\tthis.onTextUpdate( event );\n\t\tthis.lastAztecEventType = 'input';\n\t}\n\n\tonTextUpdate( event ) {\n\t\tconst contentWithoutRootTag = this.removeRootTagsProducedByAztec(\n\t\t\tunescapeSpaces( event.nativeEvent.text )\n\t\t);\n\t\tlet formattedContent = contentWithoutRootTag;\n\t\tif ( ! this.isIOS ) {\n\t\t\tformattedContent = this.restoreParagraphTags(\n\t\t\t\tcontentWithoutRootTag,\n\t\t\t\tthis.multilineTag\n\t\t\t);\n\t\t}\n\n\t\tthis.debounceCreateUndoLevel();\n\t\tconst refresh = this.value !== formattedContent;\n\t\tthis.value = formattedContent;\n\n\t\t// We don't want to refresh if our goal is just to create a record.\n\t\tif ( refresh ) {\n\t\t\tthis.props.onChange( formattedContent );\n\t\t}\n\t}\n\n\trestoreParagraphTags( value, tag ) {\n\t\tif ( tag === 'p' && ( ! value || ! value.startsWith( '<p>' ) ) ) {\n\t\t\treturn '<p>' + value + '</p>';\n\t\t}\n\t\treturn value;\n\t}\n\n\t/*\n\t * Handles any case where the content of the AztecRN instance has changed in size\n\t */\n\tonContentSizeChange( contentSize ) {\n\t\tthis.setState( contentSize );\n\t\tthis.lastAztecEventType = 'content size change';\n\t}\n\n\tonKeyDown( event ) {\n\t\tif ( event.defaultPrevented ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Add stubs for conformance in downstream autocompleters logic.\n\t\tthis.customEditableOnKeyDown?.( {\n\t\t\tpreventDefault: () => undefined,\n\t\t\t...event,\n\t\t\tkey: RCTAztecView.KeyCodes[ event?.keyCode ],\n\t\t} );\n\n\t\tthis.handleDelete( event );\n\t\tthis.handleEnter( event );\n\t\tthis.handleTriggerKeyCodes( event );\n\t}\n\n\thandleEnter( event ) {\n\t\tif ( event.keyCode !== ENTER ) {\n\t\t\treturn;\n\t\t}\n\t\tconst { onEnter } = this.props;\n\n\t\tif ( ! onEnter ) {\n\t\t\treturn;\n\t\t}\n\n\t\tonEnter( {\n\t\t\tvalue: this.createRecord(),\n\t\t\tonChange: this.onFormatChange,\n\t\t\tshiftKey: event.shiftKey,\n\t\t} );\n\t\tthis.lastAztecEventType = 'input';\n\t}\n\n\thandleDelete( event ) {\n\t\tif ( this.shouldDropEventFromAztec( event, 'handleDelete' ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { keyCode } = event;\n\n\t\tif ( keyCode !== DELETE && keyCode !== BACKSPACE ) {\n\t\t\treturn;\n\t\t}\n\t\tconst isReverse = keyCode === BACKSPACE;\n\n\t\tconst { onDelete } = this.props;\n\t\tthis.lastEventCount = event.nativeEvent.eventCount;\n\t\tthis.comesFromAztec = true;\n\t\tthis.firedAfterTextChanged = event.nativeEvent.firedAfterTextChanged;\n\t\tconst value = this.createRecord();\n\t\tconst { start, end, text } = value;\n\t\tlet newValue;\n\n\t\t// Always handle full content deletion ourselves.\n\t\tif ( start === 0 && end !== 0 && end >= text.length ) {\n\t\t\tnewValue = remove( value );\n\t\t\tthis.onFormatChange( newValue );\n\t\t\tevent.preventDefault();\n\t\t\treturn;\n\t\t}\n\n\t\t// Only process delete if the key press occurs at an uncollapsed edge.\n\t\tif (\n\t\t\t! onDelete ||\n\t\t\t! isCollapsed( value ) ||\n\t\t\t( isReverse && start !== 0 ) ||\n\t\t\t( ! isReverse && end !== text.length )\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tonDelete( { isReverse, value } );\n\n\t\tevent.preventDefault();\n\t\tthis.lastAztecEventType = 'input';\n\t}\n\n\thandleTriggerKeyCodes( event ) {\n\t\tconst { keyCode } = event;\n\t\tconst triggeredOption = this.suggestionOptions().find( ( option ) => {\n\t\t\tconst triggeredKeyCode = option.triggerChar.charCodeAt( 0 );\n\t\t\treturn triggeredKeyCode === keyCode;\n\t\t} );\n\n\t\tif ( triggeredOption ) {\n\t\t\tconst record = this.getRecord();\n\t\t\tconst text = getTextContent( record );\n\t\t\t// Only respond to the trigger if the selection is on the start of text or line\n\t\t\t// or if the character before is a space.\n\t\t\tconst useTrigger =\n\t\t\t\ttext.length === 0 ||\n\t\t\t\trecord.start === 0 ||\n\t\t\t\ttext.charAt( record.start - 1 ) === '\\n' ||\n\t\t\t\ttext.charAt( record.start - 1 ) === ' ';\n\n\t\t\tif ( useTrigger && triggeredOption.onClick ) {\n\t\t\t\ttriggeredOption.onClick();\n\t\t\t} else {\n\t\t\t\tthis.insertString( record, triggeredOption.triggerChar );\n\t\t\t}\n\t\t}\n\t}\n\n\tsuggestionOptions() {\n\t\tconst { areMentionsSupported, areXPostsSupported } = this.props;\n\t\tconst allOptions = [\n\t\t\t{\n\t\t\t\tsupported: areMentionsSupported,\n\t\t\t\ttitle: __( 'Insert mention' ),\n\t\t\t\tonClick: this.handleUserSuggestion,\n\t\t\t\ttriggerChar: '@',\n\t\t\t\tvalue: 'mention',\n\t\t\t\tlabel: __( 'Mention' ),\n\t\t\t\ticon: atSymbol,\n\t\t\t},\n\t\t\t{\n\t\t\t\tsupported: areXPostsSupported,\n\t\t\t\ttitle: __( 'Insert crosspost' ),\n\t\t\t\tonClick: this.handleXpostSuggestion,\n\t\t\t\ttriggerChar: '+',\n\t\t\t\tvalue: 'crosspost',\n\t\t\t\tlabel: __( 'Crosspost' ),\n\t\t\t\ticon: plus,\n\t\t\t},\n\t\t];\n\t\treturn allOptions.filter( ( op ) => op.supported );\n\t}\n\n\thandleSuggestionFunc( suggestionFunction, prefix ) {\n\t\treturn () => {\n\t\t\tconst record = this.getRecord();\n\t\t\tsuggestionFunction()\n\t\t\t\t.then( ( suggestion ) => {\n\t\t\t\t\tthis.insertString( record, `${ prefix }${ suggestion } ` );\n\t\t\t\t} )\n\t\t\t\t.catch( () => {} );\n\t\t};\n\t}\n\n\t/**\n\t * Handles a paste event from the native Aztec Wrapper.\n\t *\n\t * @param {Object} event The paste event which wraps `nativeEvent`.\n\t */\n\tonPaste( event ) {\n\t\tconst { onPaste, onChange } = this.props;\n\t\tconst { activeFormats = [] } = this.state;\n\n\t\tconst { pastedText, pastedHtml, files } = event.nativeEvent;\n\t\tconst currentRecord = this.createRecord();\n\n\t\tevent.preventDefault();\n\n\t\t// There is a selection, check if a URL is pasted.\n\t\tif ( ! isCollapsed( currentRecord ) ) {\n\t\t\tconst trimmedText = ( pastedHtml || pastedText )\n\t\t\t\t.replace( /<[^>]+>/g, '' )\n\t\t\t\t.trim();\n\n\t\t\t// A URL was pasted, turn the selection into a link.\n\t\t\tif ( isURL( trimmedText ) ) {\n\t\t\t\tconst linkedRecord = applyFormat( currentRecord, {\n\t\t\t\t\ttype: 'a',\n\t\t\t\t\tattributes: {\n\t\t\t\t\t\thref: decodeEntities( trimmedText ),\n\t\t\t\t\t},\n\t\t\t\t} );\n\t\t\t\tthis.value = this.valueToFormat( linkedRecord );\n\t\t\t\tonChange( this.value );\n\n\t\t\t\t// Allows us to ask for this information when we get a report.\n\t\t\t\twindow.console.log( 'Created link:\\n\\n', trimmedText );\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif ( onPaste ) {\n\t\t\tonPaste( {\n\t\t\t\tvalue: currentRecord,\n\t\t\t\tonChange: this.onFormatChange,\n\t\t\t\thtml: pastedHtml,\n\t\t\t\tplainText: pastedText,\n\t\t\t\tfiles,\n\t\t\t\tactiveFormats,\n\t\t\t} );\n\t\t}\n\t}\n\n\tonFocus() {\n\t\tthis.isTouched = true;\n\n\t\tconst { unstableOnFocus, onSelectionChange } = this.props;\n\n\t\tif ( unstableOnFocus ) {\n\t\t\tunstableOnFocus();\n\t\t}\n\n\t\t// We know for certain that on focus, the old selection is invalid. It\n\t\t// will be recalculated on `selectionchange`.\n\n\t\tonSelectionChange( this.selectionStart, this.selectionEnd );\n\n\t\tthis.lastAztecEventType = 'focus';\n\t}\n\n\tonBlur( event ) {\n\t\tthis.isTouched = false;\n\n\t\t// Check if value is up to date with latest state of native AztecView.\n\t\tif (\n\t\t\tevent.nativeEvent.text &&\n\t\t\tevent.nativeEvent.text !== this.props.value\n\t\t) {\n\t\t\tthis.onTextUpdate( event );\n\t\t}\n\n\t\tif ( this.props.onBlur ) {\n\t\t\tthis.props.onBlur( event );\n\t\t}\n\n\t\tthis.lastAztecEventType = 'blur';\n\t}\n\n\tonSelectionChange( start, end ) {\n\t\tconst hasChanged =\n\t\t\tthis.selectionStart !== start || this.selectionEnd !== end;\n\n\t\tthis.selectionStart = start;\n\t\tthis.selectionEnd = end;\n\n\t\t// This is a manual selection change event if onChange was not triggered just before\n\t\t// and we did not just trigger a text update\n\t\t// `onChange` could be the last event and could have been triggered a long time ago so\n\t\t// this approach is not perfectly reliable.\n\t\tconst isManual =\n\t\t\tthis.lastAztecEventType !== 'input' &&\n\t\t\tthis.props.value === this.value;\n\t\tif ( hasChanged && isManual ) {\n\t\t\tconst value = this.createRecord();\n\t\t\tconst activeFormats = getActiveFormats( value );\n\t\t\tthis.setState( { activeFormats } );\n\t\t}\n\n\t\tthis.props.onSelectionChange( start, end );\n\t}\n\n\tshouldDropEventFromAztec( event, logText ) {\n\t\tconst shouldDrop =\n\t\t\t! this.isIOS && event.nativeEvent.eventCount <= this.lastEventCount;\n\t\tif ( shouldDrop ) {\n\t\t\twindow.console.log(\n\t\t\t\t`Dropping ${ logText } from Aztec as its event counter is older than latest sent to the native side. Got ${ event.nativeEvent.eventCount } but lastEventCount is ${ this.lastEventCount }.`\n\t\t\t);\n\t\t}\n\t\treturn shouldDrop;\n\t}\n\n\tonSelectionChangeFromAztec( start, end, text, event ) {\n\t\tif ( this.shouldDropEventFromAztec( event, 'onSelectionChange' ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// `end` can be less than `start` on iOS\n\t\t// Let's fix that here so `rich-text/slice` can work properly.\n\t\tconst realStart = Math.min( start, end );\n\t\tconst realEnd = Math.max( start, end );\n\n\t\t// Check and dicsard stray event, where the text and selection is equal to the ones already cached.\n\t\tconst contentWithoutRootTag = this.removeRootTagsProducedByAztec(\n\t\t\tunescapeSpaces( event.nativeEvent.text )\n\t\t);\n\t\tif (\n\t\t\tcontentWithoutRootTag === this.value &&\n\t\t\trealStart === this.selectionStart &&\n\t\t\trealEnd === this.selectionEnd\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.comesFromAztec = true;\n\t\tthis.firedAfterTextChanged = true; // Selection change event always fires after the fact.\n\n\t\t// Update text before updating selection\n\t\t// Make sure there are changes made to the content before upgrading it upward.\n\t\tthis.onTextUpdate( event );\n\n\t\t// Aztec can send us selection change events after it has lost focus.\n\t\t// For instance the autocorrect feature will complete a partially written\n\t\t// word when resigning focus, causing a selection change event.\n\t\t// Forwarding this selection change could cause this RichText to regain\n\t\t// focus and start a focus loop.\n\t\t//\n\t\t// See https://github.com/wordpress-mobile/gutenberg-mobile/issues/1696\n\t\tif ( this.props.__unstableIsSelected ) {\n\t\t\tthis.onSelectionChange( realStart, realEnd );\n\t\t}\n\t\t// Update lastEventCount to prevent Aztec from re-rendering the content it just sent.\n\t\tthis.lastEventCount = event.nativeEvent.eventCount;\n\n\t\tthis.lastAztecEventType = 'selection change';\n\t}\n\n\tisEmpty() {\n\t\treturn isEmpty( this.formatToValue( this.props.value ) );\n\t}\n\n\tformatToValue( value ) {\n\t\tconst { preserveWhiteSpace } = this.props;\n\t\t// Handle deprecated `children` and `node` sources.\n\t\tif ( Array.isArray( value ) ) {\n\t\t\treturn create( {\n\t\t\t\thtml: childrenBlock.toHTML( value ),\n\t\t\t\tmultilineTag: this.multilineTag,\n\t\t\t\tmultilineWrapperTags: this.multilineWrapperTags,\n\t\t\t\tpreserveWhiteSpace,\n\t\t\t} );\n\t\t}\n\n\t\tif ( this.props.format === 'string' ) {\n\t\t\treturn create( {\n\t\t\t\thtml: value,\n\t\t\t\tmultilineTag: this.multilineTag,\n\t\t\t\tmultilineWrapperTags: this.multilineWrapperTags,\n\t\t\t\tpreserveWhiteSpace,\n\t\t\t} );\n\t\t}\n\n\t\t// Guard for blocks passing `null` in onSplit callbacks. May be removed\n\t\t// if onSplit is revised to not pass a `null` value.\n\t\tif ( value === null ) {\n\t\t\treturn create();\n\t\t}\n\n\t\treturn value;\n\t}\n\n\tmanipulateEventCounterToForceNativeToRefresh() {\n\t\tif ( this.isIOS ) {\n\t\t\tthis.lastEventCount = undefined;\n\t\t\treturn;\n\t\t}\n\n\t\tif ( typeof this.lastEventCount !== 'undefined' ) {\n\t\t\tthis.lastEventCount += 100; // bump by a hundred, hopefully native hasn't bombarded the JS side in the meantime.\n\t\t} // no need to bump when 'undefined' as native side won't receive the key when the value is undefined, and that will cause force updating anyway,\n\t\t//   see https://github.com/WordPress/gutenberg/blob/82e578dcc75e67891c750a41a04c1e31994192fc/packages/react-native-aztec/android/src/main/java/org/wordpress/mobile/ReactNativeAztec/ReactAztecManager.java#L213-L215\n\t}\n\n\tshouldComponentUpdate( nextProps, nextState ) {\n\t\tif (\n\t\t\tnextProps.tagName !== this.props.tagName ||\n\t\t\tnextProps.reversed !== this.props.reversed ||\n\t\t\tnextProps.start !== this.props.start\n\t\t) {\n\t\t\tthis.manipulateEventCounterToForceNativeToRefresh(); // force a refresh on the native side\n\t\t\tthis.value = undefined;\n\t\t\treturn true;\n\t\t}\n\n\t\t// TODO: Please re-introduce the check to avoid updating the content right after an `onChange` call.\n\t\t// It was removed in https://github.com/WordPress/gutenberg/pull/12417 to fix undo/redo problem.\n\n\t\t// If the component is changed React side (undo/redo/merging/splitting/custom text actions)\n\t\t// we need to make sure the native is updated as well.\n\n\t\t// Also, don't trust the \"this.lastContent\" as on Android, incomplete text events arrive\n\t\t//  with only some of the text, while the virtual keyboard's suggestion system does its magic.\n\t\t// ** compare with this.lastContent for optimizing performance by not forcing Aztec with text it already has\n\t\t// , but compare with props.value to not lose \"half word\" text because of Android virtual keyb autosuggestion behavior\n\t\tif (\n\t\t\ttypeof nextProps.value !== 'undefined' &&\n\t\t\ttypeof this.props.value !== 'undefined' &&\n\t\t\t( ! this.comesFromAztec || ! this.firedAfterTextChanged ) &&\n\t\t\tnextProps.value !== this.props.value\n\t\t) {\n\t\t\t// Gutenberg seems to try to mirror the caret state even on events that only change the content so,\n\t\t\t//  let's force caret update if state has selection set.\n\t\t\tif (\n\t\t\t\ttypeof nextProps.selectionStart !== 'undefined' &&\n\t\t\t\ttypeof nextProps.selectionEnd !== 'undefined'\n\t\t\t) {\n\t\t\t\tthis.needsSelectionUpdate = true;\n\t\t\t}\n\n\t\t\tthis.manipulateEventCounterToForceNativeToRefresh(); // force a refresh on the native side\n\t\t}\n\n\t\tif ( ! this.comesFromAztec ) {\n\t\t\tif (\n\t\t\t\ttypeof nextProps.selectionStart !== 'undefined' &&\n\t\t\t\ttypeof nextProps.selectionEnd !== 'undefined' &&\n\t\t\t\tnextProps.selectionStart !== this.props.selectionStart &&\n\t\t\t\tnextProps.selectionStart !== this.selectionStart &&\n\t\t\t\tnextProps.__unstableIsSelected\n\t\t\t) {\n\t\t\t\tthis.needsSelectionUpdate = true;\n\t\t\t\tthis.manipulateEventCounterToForceNativeToRefresh(); // force a refresh on the native side\n\t\t\t}\n\n\t\t\t// For font size changes from a prop value a force refresh\n\t\t\t// is needed without the selection update.\n\t\t\tif ( nextProps?.fontSize !== this.props?.fontSize ) {\n\t\t\t\tthis.manipulateEventCounterToForceNativeToRefresh(); // force a refresh on the native side\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t( nextProps?.style?.fontSize !== this.props?.style?.fontSize &&\n\t\t\t\t\tnextState.currentFontSize !==\n\t\t\t\t\t\tthis.state.currentFontSize ) ||\n\t\t\t\tnextState.currentFontSize !== this.state.currentFontSize ||\n\t\t\t\tnextProps?.style?.lineHeight !== this.props?.style?.lineHeight\n\t\t\t) {\n\t\t\t\tthis.needsSelectionUpdate = true;\n\t\t\t\tthis.manipulateEventCounterToForceNativeToRefresh(); // force a refresh on the native side\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tcomponentDidMount() {\n\t\t// Request focus if wrapping block is selected and parent hasn't inhibited the focus request. This method of focusing\n\t\t//  is trying to implement the web-side counterpart of BlockList's `focusTabbable` where the BlockList is focusing an\n\t\t//  inputbox by searching the DOM. We don't have the DOM in RN so, using the combination of blockIsSelected and __unstableMobileNoFocusOnMount\n\t\t//  to determine if we should focus the RichText.\n\t\tif (\n\t\t\tthis.props.blockIsSelected &&\n\t\t\t! this.props.__unstableMobileNoFocusOnMount\n\t\t) {\n\t\t\tthis._editor.focus();\n\t\t\tthis.onSelectionChange(\n\t\t\t\tthis.props.selectionStart || 0,\n\t\t\t\tthis.props.selectionEnd || 0\n\t\t\t);\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\tif ( this._editor.isFocused() ) {\n\t\t\tthis._editor.blur();\n\t\t}\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\tconst { style, tagName } = this.props;\n\t\tconst { currentFontSize } = this.state;\n\n\t\tif ( this.props.value !== this.value ) {\n\t\t\tthis.value = this.props.value;\n\t\t}\n\t\tconst { __unstableIsSelected: isSelected } = this.props;\n\n\t\tconst { __unstableIsSelected: prevIsSelected } = prevProps;\n\n\t\tif ( isSelected && ! prevIsSelected ) {\n\t\t\tthis._editor.focus();\n\t\t\t// Update selection props explicitly when component is selected as Aztec won't call onSelectionChange\n\t\t\t// if its internal value hasn't change. When created, default value is 0, 0.\n\t\t\tthis.onSelectionChange(\n\t\t\t\tthis.props.selectionStart || 0,\n\t\t\t\tthis.props.selectionEnd || 0\n\t\t\t);\n\t\t} else if ( ! isSelected && prevIsSelected ) {\n\t\t\tthis._editor.blur();\n\t\t}\n\n\t\t// For font size values changes from the font size picker\n\t\t// we compare previous values to refresh the selected font size,\n\t\t// this is also used when the tag name changes\n\t\t// e.g Heading block and a level change like h1->h2.\n\t\tconst currentFontSizeStyle = this.getParsedFontSize( style?.fontSize );\n\t\tconst prevFontSizeStyle = this.getParsedFontSize(\n\t\t\tprevProps?.style?.fontSize\n\t\t);\n\t\tconst isDifferentTag = prevProps.tagName !== tagName;\n\t\tif (\n\t\t\t( currentFontSize &&\n\t\t\t\t( currentFontSizeStyle || prevFontSizeStyle ) &&\n\t\t\t\tcurrentFontSizeStyle !== currentFontSize ) ||\n\t\t\tisDifferentTag\n\t\t) {\n\t\t\tthis.setState( {\n\t\t\t\tcurrentFontSize: this.getFontSize( this.props ),\n\t\t\t} );\n\t\t}\n\t}\n\n\tgetHtmlToRender( record, tagName ) {\n\t\t// Save back to HTML from React tree.\n\t\tlet value = this.valueToFormat( record );\n\n\t\tif ( value === undefined ) {\n\t\t\tthis.manipulateEventCounterToForceNativeToRefresh(); // force a refresh on the native side\n\t\t\tvalue = '';\n\t\t}\n\t\t// On android if content is empty we need to send no content or else the placeholder will not show.\n\t\tif (\n\t\t\t! this.isIOS &&\n\t\t\t( value === '' || value === EMPTY_PARAGRAPH_TAGS )\n\t\t) {\n\t\t\treturn '';\n\t\t}\n\n\t\tif ( tagName ) {\n\t\t\tlet extraAttributes = ``;\n\t\t\tif ( tagName === `ol` ) {\n\t\t\t\tif ( this.props.reversed ) {\n\t\t\t\t\textraAttributes += ` reversed`;\n\t\t\t\t}\n\t\t\t\tif ( this.props.start ) {\n\t\t\t\t\textraAttributes += ` start=${ this.props.start }`;\n\t\t\t\t}\n\t\t\t}\n\t\t\tvalue = `<${ tagName }${ extraAttributes }>${ value }</${ tagName }>`;\n\t\t}\n\t\treturn value;\n\t}\n\n\tgetEditableProps() {\n\t\treturn {\n\t\t\t// Overridable props.\n\t\t\tstyle: {},\n\t\t\tclassName: 'rich-text',\n\t\t\tonKeyDown: () => null,\n\t\t};\n\t}\n\n\tgetParsedFontSize( fontSize ) {\n\t\tconst { height, width } = Dimensions.get( 'window' );\n\t\tconst cssUnitOptions = { height, width, fontSize: DEFAULT_FONT_SIZE };\n\n\t\tif ( ! fontSize ) {\n\t\t\treturn fontSize;\n\t\t}\n\n\t\tconst selectedPxValue =\n\t\t\tgetPxFromCssUnit( fontSize, cssUnitOptions ) ?? DEFAULT_FONT_SIZE;\n\n\t\treturn parseFloat( selectedPxValue );\n\t}\n\n\tgetFontSize( props ) {\n\t\tconst { baseGlobalStyles, tagName, fontSize, style } = props;\n\t\tconst tagNameFontSize =\n\t\t\tbaseGlobalStyles?.elements?.[ tagName ]?.typography?.fontSize;\n\n\t\tlet newFontSize = DEFAULT_FONT_SIZE;\n\n\t\t// Disables line-height rendering for pre elements until we fix some issues with AztecAndroid.\n\t\tif ( tagName === 'pre' && ! this.isIOS ) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\t// For block-based themes, get the default editor font size.\n\t\tif ( baseGlobalStyles?.typography?.fontSize && tagName === 'p' ) {\n\t\t\tnewFontSize = baseGlobalStyles?.typography?.fontSize;\n\t\t}\n\n\t\t// For block-based themes, get the default element font size\n\t\t// e.g h1, h2.\n\t\tif ( tagNameFontSize ) {\n\t\t\tnewFontSize = tagNameFontSize;\n\t\t}\n\n\t\t// For font size values provided from the styles,\n\t\t// usually from values set from the font size picker.\n\t\tif ( style?.fontSize ) {\n\t\t\tnewFontSize = style.fontSize;\n\t\t}\n\n\t\t// Fall-back to a font size provided from its props (if there's any)\n\t\t// and there are no other default values to use.\n\t\tif ( fontSize && ! tagNameFontSize && ! style?.fontSize ) {\n\t\t\tnewFontSize = fontSize;\n\t\t}\n\n\t\t// We need to always convert to px units because the selected value\n\t\t// could be coming from the web where it could be stored as a different unit.\n\t\tconst selectedPxValue = this.getParsedFontSize( newFontSize );\n\n\t\treturn selectedPxValue;\n\t}\n\n\tgetLineHeight() {\n\t\tconst { baseGlobalStyles, tagName, lineHeight, style } = this.props;\n\t\tconst tagNameLineHeight =\n\t\t\tbaseGlobalStyles?.elements?.[ tagName ]?.typography?.lineHeight;\n\t\tlet newLineHeight;\n\n\t\t// Disables line-height rendering for pre elements until we fix some issues with AztecAndroid.\n\t\tif ( tagName === 'pre' && ! this.isIOS ) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif ( ! this.getIsBlockBasedTheme() ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// For block-based themes, get the default editor line height.\n\t\tif ( baseGlobalStyles?.typography?.lineHeight && tagName === 'p' ) {\n\t\t\tnewLineHeight = parseFloat(\n\t\t\t\tbaseGlobalStyles?.typography?.lineHeight\n\t\t\t);\n\t\t}\n\n\t\t// For block-based themes, get the default element line height\n\t\t// e.g h1, h2.\n\t\tif ( tagNameLineHeight ) {\n\t\t\tnewLineHeight = parseFloat( tagNameLineHeight );\n\t\t}\n\n\t\t// For line height values provided from the styles,\n\t\t// usually from values set from the line height picker.\n\t\tif ( style?.lineHeight ) {\n\t\t\tnewLineHeight = parseFloat( style.lineHeight );\n\t\t}\n\n\t\t// Fall-back to a line height provided from its props (if there's any)\n\t\t// and there are no other default values to use.\n\t\tif ( lineHeight && ! tagNameLineHeight && ! style?.lineHeight ) {\n\t\t\tnewLineHeight = lineHeight;\n\t\t}\n\n\t\t// Check the final value is not over the minimum supported value.\n\t\tif ( newLineHeight && newLineHeight < MIN_LINE_HEIGHT ) {\n\t\t\tnewLineHeight = MIN_LINE_HEIGHT;\n\t\t}\n\n\t\t// Until we parse CSS values correctly, avoid passing NaN values to Aztec\n\t\tif ( isNaN( newLineHeight ) ) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn newLineHeight;\n\t}\n\n\tgetIsBlockBasedTheme() {\n\t\tconst { baseGlobalStyles } = this.props;\n\n\t\treturn (\n\t\t\tbaseGlobalStyles && Object.entries( baseGlobalStyles ).length !== 0\n\t\t);\n\t}\n\n\tgetBlockUseDefaultFont() {\n\t\t// For block-based themes it enables using the defaultFont\n\t\t// in Aztec for iOS so it allows customizing the font size\n\t\t// for the Preformatted/Code and Heading blocks.\n\t\tif ( ! this.isIOS ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { tagName } = this.props;\n\t\tconst isBlockBasedTheme = this.getIsBlockBasedTheme();\n\t\tconst tagsToMatch = /pre|h([1-6])$/gm;\n\n\t\treturn isBlockBasedTheme && tagsToMatch.test( tagName );\n\t}\n\n\tgetLinkTextColor( defaultColor ) {\n\t\tconst { style } = this.props;\n\t\tconst customColor = style?.linkColor && colord( style.linkColor );\n\n\t\treturn customColor && customColor.isValid()\n\t\t\t? customColor.toHex()\n\t\t\t: defaultColor;\n\t}\n\n\tgetPlaceholderTextColor() {\n\t\tconst {\n\t\t\tbaseGlobalStyles,\n\t\t\tgetStylesFromColorScheme,\n\t\t\tplaceholderTextColor,\n\t\t\tstyle,\n\t\t} = this.props;\n\n\t\t// Default placeholder text color.\n\t\tconst placeholderStyle = getStylesFromColorScheme(\n\t\t\tstyles.richTextPlaceholder,\n\t\t\tstyles.richTextPlaceholderDark\n\t\t);\n\t\tconst { color: defaultPlaceholderTextColor } = placeholderStyle;\n\t\t// Custom 63% opacity for theme and inherited colors.\n\t\tconst placeholderOpacity = 'A1';\n\n\t\t// Determine inherited placeholder color if available.\n\t\tconst inheritPlaceholderColor = style?.placeholderColor\n\t\t\t? `${ style.placeholderColor }${ placeholderOpacity }`\n\t\t\t: undefined;\n\n\t\t// If using block-based themes, derive the placeholder color from global styles.\n\t\tconst globalStylesPlaceholderColor = baseGlobalStyles?.color?.text\n\t\t\t? `${ baseGlobalStyles.color.text }${ placeholderOpacity }`\n\t\t\t: undefined;\n\n\t\treturn (\n\t\t\tinheritPlaceholderColor ??\n\t\t\tplaceholderTextColor ??\n\t\t\tglobalStylesPlaceholderColor ??\n\t\t\tdefaultPlaceholderTextColor\n\t\t);\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\ttagName,\n\t\t\tstyle,\n\t\t\t__unstableIsSelected: isSelected,\n\t\t\tchildren,\n\t\t\tgetStylesFromColorScheme,\n\t\t\tminWidth,\n\t\t\tmaxWidth,\n\t\t\tformatTypes,\n\t\t\tparentBlockStyles,\n\t\t\taccessibilityLabel,\n\t\t\tdisableEditingMenu = false,\n\t\t\tbaseGlobalStyles,\n\t\t\tselectionStart,\n\t\t\tselectionEnd,\n\t\t\tdisableSuggestions,\n\t\t\tcontainerWidth,\n\t\t} = this.props;\n\t\tconst { currentFontSize } = this.state;\n\n\t\tconst record = this.getRecord();\n\t\tconst html = this.getHtmlToRender( record, tagName );\n\t\tconst editableProps = this.getEditableProps();\n\t\tconst blockUseDefaultFont = this.getBlockUseDefaultFont();\n\n\t\tconst fontSize = currentFontSize;\n\t\tconst lineHeight = this.getLineHeight();\n\n\t\tconst {\n\t\t\tcolor: defaultColor,\n\t\t\ttextDecorationColor: defaultTextDecorationColor,\n\t\t\tfontFamily: defaultFontFamily,\n\t\t} = getStylesFromColorScheme( styles.richText, styles.richTextDark );\n\t\tconst linkTextColor = this.getLinkTextColor(\n\t\t\tdefaultTextDecorationColor\n\t\t);\n\n\t\tconst currentSelectionStart = selectionStart ?? 0;\n\t\tconst currentSelectionEnd = selectionEnd ?? 0;\n\t\tlet selection = null;\n\t\tif ( this.needsSelectionUpdate ) {\n\t\t\tthis.needsSelectionUpdate = false;\n\t\t\tselection = {\n\t\t\t\tstart: currentSelectionStart,\n\t\t\t\tend: currentSelectionEnd,\n\t\t\t};\n\n\t\t\t// On AztecAndroid, setting the caret to an out-of-bounds position will crash the editor so, let's check for some cases.\n\t\t\tif ( ! this.isIOS ) {\n\t\t\t\t// The following regular expression is used in Aztec here:\n\t\t\t\t// https://github.com/wordpress-mobile/AztecEditor-Android/blob/b1fad439d56fa6d4aa0b78526fef355c59d00dd3/aztec/src/main/kotlin/org/wordpress/aztec/AztecParser.kt#L656\n\t\t\t\tconst brBeforeParaMatches = html.match( /(<br>)+<\\/p>$/g );\n\t\t\t\tif ( brBeforeParaMatches ) {\n\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t'Oops, BR tag(s) at the end of content. Aztec will remove them, adapting the selection...'\n\t\t\t\t\t);\n\t\t\t\t\tconst count = (\n\t\t\t\t\t\tbrBeforeParaMatches[ 0 ].match( /br/g ) || []\n\t\t\t\t\t).length;\n\t\t\t\t\tif ( count > 0 ) {\n\t\t\t\t\t\tlet newSelectionStart = currentSelectionStart - count;\n\t\t\t\t\t\tif ( newSelectionStart < 0 ) {\n\t\t\t\t\t\t\tnewSelectionStart = 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlet newSelectionEnd = currentSelectionEnd - count;\n\t\t\t\t\t\tif ( newSelectionEnd < 0 ) {\n\t\t\t\t\t\t\tnewSelectionEnd = 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tselection = {\n\t\t\t\t\t\t\tstart: newSelectionStart,\n\t\t\t\t\t\t\tend: newSelectionEnd,\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ( this.comesFromAztec ) {\n\t\t\tthis.comesFromAztec = false;\n\t\t\tthis.firedAfterTextChanged = false;\n\t\t}\n\n\t\t// Logic below assures that `RichText` width will always have equal value when container is almost fully filled.\n\t\tconst width =\n\t\t\tmaxWidth && this.state.width && maxWidth - this.state.width < 10\n\t\t\t\t? maxWidth\n\t\t\t\t: this.state.width;\n\t\tconst containerStyles = [\n\t\t\tstyle?.padding &&\n\t\t\t\tstyle?.backgroundColor && {\n\t\t\t\t\tpadding: style.padding,\n\t\t\t\t\tbackgroundColor: style.backgroundColor,\n\t\t\t\t},\n\t\t\tcontainerWidth && {\n\t\t\t\twidth: containerWidth,\n\t\t\t},\n\t\t];\n\n\t\tconst defaultSelectionColor = getStylesFromColorScheme(\n\t\t\tstyles[ 'rich-text-selection' ],\n\t\t\tstyles[ 'rich-text-selection--dark' ]\n\t\t).color;\n\t\tconst selectionColor = getSelectionColor(\n\t\t\tthis.props.selectionColor,\n\t\t\tdefaultSelectionColor,\n\t\t\tbaseGlobalStyles,\n\t\t\tthis.getIsBlockBasedTheme()\n\t\t);\n\n\t\tconst EditableView = ( props ) => {\n\t\t\tthis.customEditableOnKeyDown = props?.onKeyDown;\n\n\t\t\treturn <></>;\n\t\t};\n\n\t\treturn (\n\t\t\t<View style={ containerStyles }>\n\t\t\t\t{ children &&\n\t\t\t\t\tchildren( {\n\t\t\t\t\t\tisSelected,\n\t\t\t\t\t\tvalue: record,\n\t\t\t\t\t\tonChange: this.onFormatChange,\n\t\t\t\t\t\tonFocus: () => {},\n\t\t\t\t\t\teditableProps,\n\t\t\t\t\t\teditableTagName: EditableView,\n\t\t\t\t\t} ) }\n\t\t\t\t<RCTAztecView\n\t\t\t\t\taccessibilityLabel={ accessibilityLabel }\n\t\t\t\t\tref={ ( ref ) => {\n\t\t\t\t\t\tthis._editor = ref;\n\n\t\t\t\t\t\tif ( this.props.setRef ) {\n\t\t\t\t\t\t\tthis.props.setRef( ref );\n\t\t\t\t\t\t}\n\t\t\t\t\t} }\n\t\t\t\t\tstyle={ {\n\t\t\t\t\t\tbackgroundColor: styles.richText.backgroundColor,\n\t\t\t\t\t\t...style,\n\t\t\t\t\t\t...( this.isIOS && minWidth && maxWidth\n\t\t\t\t\t\t\t? { width }\n\t\t\t\t\t\t\t: { maxWidth } ),\n\t\t\t\t\t\tminHeight: this.state.height,\n\t\t\t\t\t} }\n\t\t\t\t\tblockUseDefaultFont={ blockUseDefaultFont }\n\t\t\t\t\ttext={ {\n\t\t\t\t\t\ttext: html,\n\t\t\t\t\t\teventCount: this.lastEventCount,\n\t\t\t\t\t\tselection,\n\t\t\t\t\t\tlinkTextColor,\n\t\t\t\t\t\ttag: tagName,\n\t\t\t\t\t} }\n\t\t\t\t\tplaceholder={ this.props.placeholder }\n\t\t\t\t\tplaceholderTextColor={ this.getPlaceholderTextColor() }\n\t\t\t\t\tdeleteEnter={ this.props.deleteEnter }\n\t\t\t\t\tonChange={ this.onChangeFromAztec }\n\t\t\t\t\tonFocus={ this.onFocus }\n\t\t\t\t\tonBlur={ this.onBlur }\n\t\t\t\t\tonKeyDown={ this.onKeyDown }\n\t\t\t\t\ttriggerKeyCodes={\n\t\t\t\t\t\tdisableEditingMenu\n\t\t\t\t\t\t\t? []\n\t\t\t\t\t\t\t: this.suggestionOptions().map(\n\t\t\t\t\t\t\t\t\t( op ) => op.triggerChar\n\t\t\t\t\t\t\t  )\n\t\t\t\t\t}\n\t\t\t\t\tonPaste={ this.onPaste }\n\t\t\t\t\tactiveFormats={ this.getActiveFormatNames( record ) }\n\t\t\t\t\tonContentSizeChange={ this.onContentSizeChange }\n\t\t\t\t\tonSelectionChange={ this.onSelectionChangeFromAztec }\n\t\t\t\t\tblockType={ { tag: tagName } }\n\t\t\t\t\tcolor={\n\t\t\t\t\t\t( style && style.color ) ||\n\t\t\t\t\t\t( parentBlockStyles && parentBlockStyles.color ) ||\n\t\t\t\t\t\t( baseGlobalStyles && baseGlobalStyles?.color?.text ) ||\n\t\t\t\t\t\tdefaultColor\n\t\t\t\t\t}\n\t\t\t\t\tmaxImagesWidth={ 200 }\n\t\t\t\t\tfontFamily={ this.props.fontFamily || defaultFontFamily }\n\t\t\t\t\tfontSize={ fontSize }\n\t\t\t\t\tlineHeight={ lineHeight }\n\t\t\t\t\tfontWeight={ this.props.fontWeight }\n\t\t\t\t\tfontStyle={ this.props.fontStyle }\n\t\t\t\t\tdisableEditingMenu={ disableEditingMenu }\n\t\t\t\t\tisMultiline={ this.isMultiline }\n\t\t\t\t\ttextAlign={ this.props.textAlign }\n\t\t\t\t\t{ ...( this.isIOS ? { maxWidth } : {} ) }\n\t\t\t\t\tminWidth={ minWidth }\n\t\t\t\t\tid={ this.props.id }\n\t\t\t\t\tselectionColor={ selectionColor }\n\t\t\t\t\tdisableAutocorrection={ this.props.disableAutocorrection }\n\t\t\t\t/>\n\t\t\t\t{ isSelected && (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<FormatEdit\n\t\t\t\t\t\t\tforwardedRef={ this._editor }\n\t\t\t\t\t\t\tformatTypes={ formatTypes }\n\t\t\t\t\t\t\tvalue={ record }\n\t\t\t\t\t\t\tonChange={ this.onFormatChange }\n\t\t\t\t\t\t\tonFocus={ () => {} }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t{ ! disableSuggestions && (\n\t\t\t\t\t\t\t<BlockFormatControls>\n\t\t\t\t\t\t\t\t<ToolbarButtonWithOptions\n\t\t\t\t\t\t\t\t\toptions={ this.suggestionOptions() }\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</BlockFormatControls>\n\t\t\t\t\t\t) }\n\t\t\t\t\t</>\n\t\t\t\t) }\n\t\t\t</View>\n\t\t);\n\t}\n}\n\nRichText.defaultProps = {\n\tformat: 'string',\n\tvalue: '',\n\ttagName: 'div',\n};\n\nconst withFormatTypes = ( WrappedComponent ) => ( props ) => {\n\tconst {\n\t\tclientId,\n\t\tidentifier,\n\t\twithoutInteractiveFormatting,\n\t\tallowedFormats,\n\t} = props;\n\tconst { formatTypes } = useFormatTypes( {\n\t\tclientId,\n\t\tidentifier,\n\t\twithoutInteractiveFormatting,\n\t\tallowedFormats,\n\t} );\n\n\treturn <WrappedComponent { ...props } formatTypes={ formatTypes } />;\n};\n\nexport default compose( [\n\twithSelect( ( select, { clientId } ) => {\n\t\tconst { getBlockParents, getBlock, getSettings } =\n\t\t\tselect( 'core/block-editor' );\n\t\tconst parents = getBlockParents( clientId, true );\n\t\tconst parentBlock = parents ? getBlock( parents[ 0 ] ) : undefined;\n\t\tconst parentBlockStyles = parentBlock?.attributes?.childrenStyles;\n\n\t\tconst settings = getSettings();\n\t\tconst baseGlobalStyles = settings?.__experimentalGlobalStylesBaseStyles;\n\n\t\tconst colorPalettes = settings?.__experimentalFeatures?.color?.palette;\n\t\tconst colorPalette = colorPalettes\n\t\t\t? flatColorPalettes( colorPalettes )\n\t\t\t: settings?.colors;\n\n\t\treturn {\n\t\t\tareMentionsSupported: settings?.capabilities?.mentions === true,\n\t\t\tareXPostsSupported: settings?.capabilities?.xposts === true,\n\t\t\tparentBlockStyles,\n\t\t\tbaseGlobalStyles,\n\t\t\tcolorPalette,\n\t\t};\n\t} ),\n\twithPreferredColorScheme,\n\twithFormatTypes,\n] )( RichText );\n"],"mappings":"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"}