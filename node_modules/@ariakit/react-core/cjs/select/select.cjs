"use strict";Object.defineProperty(exports, "__esModule", {value: true});

var _UVTMAR7Ncjs = require('../__chunks/UVTMAR7N.cjs');
require('../__chunks/YMZPP75I.cjs');
require('../__chunks/PHGHRT2Q.cjs');
require('../__chunks/NXDHPYNQ.cjs');
require('../__chunks/6MKUVCEN.cjs');


var _ZECYRUVHcjs = require('../__chunks/ZECYRUVH.cjs');
require('../__chunks/BNTTY6EA.cjs');


var _Q5EWS32Zcjs = require('../__chunks/Q5EWS32Z.cjs');


var _RCGSDYWJcjs = require('../__chunks/RCGSDYWJ.cjs');
require('../__chunks/OSQTQ6OF.cjs');
require('../__chunks/KLZID3QO.cjs');
require('../__chunks/5VOPA6D3.cjs');
require('../__chunks/W5PBA4D6.cjs');
require('../__chunks/I4JDDV3V.cjs');
require('../__chunks/LHHW5ZQP.cjs');




var _CWY2PHPRcjs = require('../__chunks/CWY2PHPR.cjs');





var _5WLTMVVQcjs = require('../__chunks/5WLTMVVQ.cjs');
require('../__chunks/7WUTS26Y.cjs');




var _72I2GWXFcjs = require('../__chunks/72I2GWXF.cjs');

// src/select/select.tsx
var _react = require('react');
var _dom = require('@ariakit/core/utils/dom');
var _events = require('@ariakit/core/utils/events');
var _jsxruntime = require('react/jsx-runtime');
function getSelectedValues(select) {
  return Array.from(select.selectedOptions).map((option) => option.value);
}
function nextWithValue(store, next) {
  return () => {
    const nextId = next();
    if (!nextId)
      return;
    let i = 0;
    let nextItem = store.item(nextId);
    const firstItem = nextItem;
    while (nextItem && nextItem.value == null) {
      const nextId2 = next(++i);
      if (!nextId2)
        return;
      nextItem = store.item(nextId2);
      if (nextItem === firstItem)
        break;
    }
    return nextItem == null ? void 0 : nextItem.id;
  };
}
var useSelect = _CWY2PHPRcjs.createHook.call(void 0, 
  (_a) => {
    var _b = _a, {
      store,
      name,
      form,
      required,
      showOnKeyDown = true,
      moveOnKeyDown = true,
      toggleOnClick = false,
      toggleOnPress = !toggleOnClick
    } = _b, props = _72I2GWXFcjs.__objRest.call(void 0, _b, [
      "store",
      "name",
      "form",
      "required",
      "showOnKeyDown",
      "moveOnKeyDown",
      "toggleOnClick",
      "toggleOnPress"
    ]);
    toggleOnPress = toggleOnClick ? false : toggleOnPress;
    const onKeyDownProp = props.onKeyDown;
    const showOnKeyDownProp = _5WLTMVVQcjs.useBooleanEvent.call(void 0, showOnKeyDown);
    const moveOnKeyDownProp = _5WLTMVVQcjs.useBooleanEvent.call(void 0, moveOnKeyDown);
    const toggleOnPressProp = _5WLTMVVQcjs.useBooleanEvent.call(void 0, toggleOnPress);
    const placement = store.useState("placement");
    const dir = placement.split("-")[0];
    const value = store.useState("value");
    const multiSelectable = Array.isArray(value);
    const onKeyDown = _5WLTMVVQcjs.useEvent.call(void 0, (event) => {
      var _a2;
      onKeyDownProp == null ? void 0 : onKeyDownProp(event);
      if (event.defaultPrevented)
        return;
      const { orientation, items: items2, activeId } = store.getState();
      if (event.key === " " || event.key === "Enter") {
        if (toggleOnPressProp(event)) {
          event.preventDefault();
          store.toggle();
        }
      }
      const isVertical = orientation !== "horizontal";
      const isHorizontal = orientation !== "vertical";
      const isGrid = !!((_a2 = items2.find(
        (item) => !item.disabled && item.value != null
      )) == null ? void 0 : _a2.rowId);
      const moveKeyMap = {
        ArrowUp: (isGrid || isVertical) && nextWithValue(store, store.up),
        ArrowRight: (isGrid || isHorizontal) && nextWithValue(store, store.next),
        ArrowDown: (isGrid || isVertical) && nextWithValue(store, store.down),
        ArrowLeft: (isGrid || isHorizontal) && nextWithValue(store, store.previous)
      };
      const getId = moveKeyMap[event.key];
      if (getId && moveOnKeyDownProp(event)) {
        event.preventDefault();
        store.move(getId());
      }
      const isTopOrBottom = dir === "top" || dir === "bottom";
      const isLeft = dir === "left";
      const isRight = dir === "right";
      const canShowKeyMap = {
        ArrowDown: isTopOrBottom,
        ArrowUp: isTopOrBottom,
        ArrowLeft: isLeft,
        ArrowRight: isRight
      };
      const canShow = canShowKeyMap[event.key];
      if (canShow && showOnKeyDownProp(event)) {
        event.preventDefault();
        store.show();
        store.move(activeId);
      }
    });
    const onMouseDownProp = props.onMouseDown;
    const onMouseDown = _5WLTMVVQcjs.useEvent.call(void 0, (event) => {
      onMouseDownProp == null ? void 0 : onMouseDownProp(event);
      if (event.defaultPrevented)
        return;
      if (event.button)
        return;
      if (event.ctrlKey)
        return;
      if (!toggleOnPressProp(event))
        return;
      const element = event.currentTarget;
      _events.queueBeforeEvent.call(void 0, element, "focusin", () => {
        store.setDisclosureElement(element);
        store.toggle();
      });
    });
    props = _5WLTMVVQcjs.useWrapElement.call(void 0, 
      props,
      (element) => /* @__PURE__ */ _jsxruntime.jsx.call(void 0, _RCGSDYWJcjs.SelectContext.Provider, { value: store, children: element }),
      [store]
    );
    const [autofill, setAutofill] = _react.useState.call(void 0, false);
    const nativeSelectChangedRef = _react.useRef.call(void 0, false);
    _react.useEffect.call(void 0, () => {
      const nativeSelectChanged = nativeSelectChangedRef.current;
      nativeSelectChangedRef.current = false;
      if (nativeSelectChanged)
        return;
      setAutofill(false);
    }, [value]);
    const labelId = store.useState((state) => {
      var _a2;
      return (_a2 = state.labelElement) == null ? void 0 : _a2.id;
    });
    const label = props["aria-label"];
    const labelledBy = props["aria-labelledby"] || labelId;
    const items = store.useState("items");
    const values = _react.useMemo.call(void 0, 
      // Filter out items without value and duplicate values.
      () => [...new Set(items.map((i) => i.value).filter((v) => v != null))],
      [items]
    );
    props = _5WLTMVVQcjs.useWrapElement.call(void 0, 
      props,
      (element) => {
        if (!name)
          return element;
        return /* @__PURE__ */ _jsxruntime.jsxs.call(void 0, _jsxruntime.Fragment, { children: [
          /* @__PURE__ */ _jsxruntime.jsx.call(void 0, 
            "select",
            {
              style: {
                border: 0,
                clip: "rect(0 0 0 0)",
                height: "1px",
                margin: "-1px",
                overflow: "hidden",
                padding: 0,
                position: "absolute",
                whiteSpace: "nowrap",
                width: "1px"
              },
              tabIndex: -1,
              "aria-hidden": true,
              "aria-label": label,
              "aria-labelledby": labelledBy,
              name,
              form,
              required,
              value,
              multiple: multiSelectable,
              onFocus: () => {
                var _a2;
                return (_a2 = store.getState().selectElement) == null ? void 0 : _a2.focus();
              },
              onChange: (event) => {
                nativeSelectChangedRef.current = true;
                setAutofill(true);
                store.setValue(
                  multiSelectable ? getSelectedValues(event.target) : event.target.value
                );
              },
              children: values.map((value2) => /* @__PURE__ */ _jsxruntime.jsx.call(void 0, "option", { value: value2, children: value2 }, value2))
            }
          ),
          element
        ] });
      },
      [
        store,
        label,
        labelledBy,
        name,
        form,
        required,
        value,
        multiSelectable,
        values
      ]
    );
    const children = /* @__PURE__ */ _jsxruntime.jsxs.call(void 0, _jsxruntime.Fragment, { children: [
      value,
      /* @__PURE__ */ _jsxruntime.jsx.call(void 0, _ZECYRUVHcjs.SelectArrow, {})
    ] });
    const contentElement = store.useState("contentElement");
    props = _72I2GWXFcjs.__spreadProps.call(void 0, _72I2GWXFcjs.__spreadValues.call(void 0, {
      role: "combobox",
      "aria-autocomplete": "none",
      "aria-labelledby": labelId,
      "aria-haspopup": _dom.getPopupRole.call(void 0, contentElement, "listbox"),
      "data-autofill": autofill ? "" : void 0,
      "data-name": name,
      children
    }, props), {
      ref: _5WLTMVVQcjs.useMergeRefs.call(void 0, store.setSelectElement, props.ref),
      onKeyDown,
      onMouseDown
    });
    props = _UVTMAR7Ncjs.usePopoverDisclosure.call(void 0, _72I2GWXFcjs.__spreadValues.call(void 0, { store, toggleOnClick }, props));
    props = _Q5EWS32Zcjs.useCompositeTypeahead.call(void 0, _72I2GWXFcjs.__spreadValues.call(void 0, { store }, props));
    return props;
  }
);
var Select = _CWY2PHPRcjs.createComponent.call(void 0, (props) => {
  const htmlProps = useSelect(props);
  return _CWY2PHPRcjs.createElement.call(void 0, "button", htmlProps);
});
if (process.env.NODE_ENV !== "production") {
  Select.displayName = "Select";
}



exports.Select = Select; exports.useSelect = useSelect;
