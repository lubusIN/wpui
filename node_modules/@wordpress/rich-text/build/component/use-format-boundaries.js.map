{"version":3,"names":["_element","require","_compose","_keycodes","_isCollapsed","EMPTY_ACTIVE_FORMATS","useFormatBoundaries","props","forceRender","useReducer","propsRef","useRef","current","useRefEffect","element","onKeyDown","event","keyCode","shiftKey","altKey","metaKey","ctrlKey","LEFT","RIGHT","record","applyRecord","text","formats","start","end","activeFormats","currentActiveFormats","collapsed","isCollapsed","ownerDocument","defaultView","direction","getComputedStyle","reverseKey","isReverse","length","formatsBefore","formatsAfter","destination","isIncreasing","every","format","index","newActiveFormatsLength","_newActiveFormats","preventDefault","origin","source","newActiveFormats","slice","newValue","addEventListener","removeEventListener"],"sources":["@wordpress/rich-text/src/component/use-format-boundaries.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useRef, useReducer } from '@wordpress/element';\nimport { useRefEffect } from '@wordpress/compose';\nimport { LEFT, RIGHT } from '@wordpress/keycodes';\n\n/**\n * Internal dependencies\n */\nimport { isCollapsed } from '../is-collapsed';\n\nconst EMPTY_ACTIVE_FORMATS = [];\n\nexport function useFormatBoundaries( props ) {\n\tconst [ , forceRender ] = useReducer( () => ( {} ) );\n\tconst propsRef = useRef( props );\n\tpropsRef.current = props;\n\treturn useRefEffect( ( element ) => {\n\t\tfunction onKeyDown( event ) {\n\t\t\tconst { keyCode, shiftKey, altKey, metaKey, ctrlKey } = event;\n\n\t\t\tif (\n\t\t\t\t// Only override left and right keys without modifiers pressed.\n\t\t\t\tshiftKey ||\n\t\t\t\taltKey ||\n\t\t\t\tmetaKey ||\n\t\t\t\tctrlKey ||\n\t\t\t\t( keyCode !== LEFT && keyCode !== RIGHT )\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { record, applyRecord } = propsRef.current;\n\t\t\tconst {\n\t\t\t\ttext,\n\t\t\t\tformats,\n\t\t\t\tstart,\n\t\t\t\tend,\n\t\t\t\tactiveFormats: currentActiveFormats = [],\n\t\t\t} = record.current;\n\t\t\tconst collapsed = isCollapsed( record.current );\n\t\t\tconst { ownerDocument } = element;\n\t\t\tconst { defaultView } = ownerDocument;\n\t\t\t// To do: ideally, we should look at visual position instead.\n\t\t\tconst { direction } = defaultView.getComputedStyle( element );\n\t\t\tconst reverseKey = direction === 'rtl' ? RIGHT : LEFT;\n\t\t\tconst isReverse = event.keyCode === reverseKey;\n\n\t\t\t// If the selection is collapsed and at the very start, do nothing if\n\t\t\t// navigating backward.\n\t\t\t// If the selection is collapsed and at the very end, do nothing if\n\t\t\t// navigating forward.\n\t\t\tif ( collapsed && currentActiveFormats.length === 0 ) {\n\t\t\t\tif ( start === 0 && isReverse ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif ( end === text.length && ! isReverse ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// If the selection is not collapsed, let the browser handle collapsing\n\t\t\t// the selection for now. Later we could expand this logic to set\n\t\t\t// boundary positions if needed.\n\t\t\tif ( ! collapsed ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst formatsBefore = formats[ start - 1 ] || EMPTY_ACTIVE_FORMATS;\n\t\t\tconst formatsAfter = formats[ start ] || EMPTY_ACTIVE_FORMATS;\n\t\t\tconst destination = isReverse ? formatsBefore : formatsAfter;\n\t\t\tconst isIncreasing = currentActiveFormats.every(\n\t\t\t\t( format, index ) => format === destination[ index ]\n\t\t\t);\n\n\t\t\tlet newActiveFormatsLength = currentActiveFormats.length;\n\n\t\t\tif ( ! isIncreasing ) {\n\t\t\t\tnewActiveFormatsLength--;\n\t\t\t} else if ( newActiveFormatsLength < destination.length ) {\n\t\t\t\tnewActiveFormatsLength++;\n\t\t\t}\n\n\t\t\tif ( newActiveFormatsLength === currentActiveFormats.length ) {\n\t\t\t\trecord.current._newActiveFormats = destination;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tevent.preventDefault();\n\n\t\t\tconst origin = isReverse ? formatsAfter : formatsBefore;\n\t\t\tconst source = isIncreasing ? destination : origin;\n\t\t\tconst newActiveFormats = source.slice( 0, newActiveFormatsLength );\n\t\t\tconst newValue = {\n\t\t\t\t...record.current,\n\t\t\t\tactiveFormats: newActiveFormats,\n\t\t\t};\n\t\t\trecord.current = newValue;\n\t\t\tapplyRecord( newValue );\n\t\t\tforceRender();\n\t\t}\n\n\t\telement.addEventListener( 'keydown', onKeyDown );\n\t\treturn () => {\n\t\t\telement.removeEventListener( 'keydown', onKeyDown );\n\t\t};\n\t}, [] );\n}\n"],"mappings":"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"}