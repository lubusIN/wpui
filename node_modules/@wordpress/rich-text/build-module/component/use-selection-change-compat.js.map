{"version":3,"names":["useRefEffect","isRangeEqual","useSelectionChangeCompat","element","ownerDocument","defaultView","selection","getSelection","range","getRange","rangeCount","getRangeAt","onDown","event","type","onCancel","removeEventListener","onUp","dispatchEvent","Event","addEventListener"],"sources":["@wordpress/rich-text/src/component/use-selection-change-compat.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useRefEffect } from '@wordpress/compose';\n\n/**\n * Internal dependencies\n */\nimport { isRangeEqual } from '../is-range-equal';\n\n/**\n * Sometimes some browsers are not firing a `selectionchange` event when\n * changing the selection by mouse or keyboard. This hook makes sure that, if we\n * detect no `selectionchange` or `input` event between the up and down events,\n * we fire a `selectionchange` event.\n *\n * @return {import('@wordpress/compose').RefEffect} A ref effect attaching the\n *                                                  listeners.\n */\nexport function useSelectionChangeCompat() {\n\treturn useRefEffect( ( element ) => {\n\t\tconst { ownerDocument } = element;\n\t\tconst { defaultView } = ownerDocument;\n\t\tconst selection = defaultView?.getSelection();\n\n\t\tlet range;\n\n\t\tfunction getRange() {\n\t\t\treturn selection.rangeCount ? selection.getRangeAt( 0 ) : null;\n\t\t}\n\n\t\tfunction onDown( event ) {\n\t\t\tconst type = event.type === 'keydown' ? 'keyup' : 'pointerup';\n\n\t\t\tfunction onCancel() {\n\t\t\t\townerDocument.removeEventListener( type, onUp );\n\t\t\t\townerDocument.removeEventListener(\n\t\t\t\t\t'selectionchange',\n\t\t\t\t\tonCancel\n\t\t\t\t);\n\t\t\t\townerDocument.removeEventListener( 'input', onCancel );\n\t\t\t}\n\n\t\t\tfunction onUp() {\n\t\t\t\tonCancel();\n\t\t\t\tif ( isRangeEqual( range, getRange() ) ) return;\n\t\t\t\townerDocument.dispatchEvent( new Event( 'selectionchange' ) );\n\t\t\t}\n\n\t\t\townerDocument.addEventListener( type, onUp );\n\t\t\townerDocument.addEventListener( 'selectionchange', onCancel );\n\t\t\townerDocument.addEventListener( 'input', onCancel );\n\n\t\t\trange = getRange();\n\t\t}\n\n\t\telement.addEventListener( 'pointerdown', onDown );\n\t\telement.addEventListener( 'keydown', onDown );\n\t\treturn () => {\n\t\t\telement.removeEventListener( 'pointerdown', onDown );\n\t\t\telement.removeEventListener( 'keydown', onDown );\n\t\t};\n\t}, [] );\n}\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,YAAY,QAAQ,oBAAoB;;AAEjD;AACA;AACA;AACA,SAASC,YAAY,QAAQ,mBAAmB;;AAEhD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASC,wBAAwBA,CAAA,EAAG;EAC1C,OAAOF,YAAY,CAAIG,OAAO,IAAM;IACnC,MAAM;MAAEC;IAAc,CAAC,GAAGD,OAAO;IACjC,MAAM;MAAEE;IAAY,CAAC,GAAGD,aAAa;IACrC,MAAME,SAAS,GAAGD,WAAW,EAAEE,YAAY,CAAC,CAAC;IAE7C,IAAIC,KAAK;IAET,SAASC,QAAQA,CAAA,EAAG;MACnB,OAAOH,SAAS,CAACI,UAAU,GAAGJ,SAAS,CAACK,UAAU,CAAE,CAAE,CAAC,GAAG,IAAI;IAC/D;IAEA,SAASC,MAAMA,CAAEC,KAAK,EAAG;MACxB,MAAMC,IAAI,GAAGD,KAAK,CAACC,IAAI,KAAK,SAAS,GAAG,OAAO,GAAG,WAAW;MAE7D,SAASC,QAAQA,CAAA,EAAG;QACnBX,aAAa,CAACY,mBAAmB,CAAEF,IAAI,EAAEG,IAAK,CAAC;QAC/Cb,aAAa,CAACY,mBAAmB,CAChC,iBAAiB,EACjBD,QACD,CAAC;QACDX,aAAa,CAACY,mBAAmB,CAAE,OAAO,EAAED,QAAS,CAAC;MACvD;MAEA,SAASE,IAAIA,CAAA,EAAG;QACfF,QAAQ,CAAC,CAAC;QACV,IAAKd,YAAY,CAAEO,KAAK,EAAEC,QAAQ,CAAC,CAAE,CAAC,EAAG;QACzCL,aAAa,CAACc,aAAa,CAAE,IAAIC,KAAK,CAAE,iBAAkB,CAAE,CAAC;MAC9D;MAEAf,aAAa,CAACgB,gBAAgB,CAAEN,IAAI,EAAEG,IAAK,CAAC;MAC5Cb,aAAa,CAACgB,gBAAgB,CAAE,iBAAiB,EAAEL,QAAS,CAAC;MAC7DX,aAAa,CAACgB,gBAAgB,CAAE,OAAO,EAAEL,QAAS,CAAC;MAEnDP,KAAK,GAAGC,QAAQ,CAAC,CAAC;IACnB;IAEAN,OAAO,CAACiB,gBAAgB,CAAE,aAAa,EAAER,MAAO,CAAC;IACjDT,OAAO,CAACiB,gBAAgB,CAAE,SAAS,EAAER,MAAO,CAAC;IAC7C,OAAO,MAAM;MACZT,OAAO,CAACa,mBAAmB,CAAE,aAAa,EAAEJ,MAAO,CAAC;MACpDT,OAAO,CAACa,mBAAmB,CAAE,SAAS,EAAEJ,MAAO,CAAC;IACjD,CAAC;EACF,CAAC,EAAE,EAAG,CAAC;AACR"}