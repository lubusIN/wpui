import{r as D,a as g,j as T,F as ue,L as fe,u as he,d as pe,_ as ge,e as me,f as we,R as v,g as ve,S as ke,h as I,T as C,t as be,E as Se,s as ne,m as Te,W as xe,M as _e,b as Me,c as ye}from"./assets/workbench-a5983eba.js";const Ee=fe;function Ce({rootItem:o,render:t,icon:e,isError:s,selectedItem:i,onAccepted:n,onSelected:r,onHighlighted:c,treeState:l,setTreeState:p,noItemsMessage:d,dataTestId:h,autoExpandDeep:w}){const u=D.useMemo(()=>{for(let a=i==null?void 0:i.parent;a;a=a.parent)l.expandedItems.set(a.id,!0);return Re(o,l.expandedItems,w)},[o,i,l,w]);return g(Ee,{items:[...u.keys()],id:a=>a.id,dataTestId:h,render:a=>{const m=t(a);return T(ue,{children:[e&&g("div",{className:"codicon "+(e(a)||"blank"),style:{minWidth:16,marginRight:4}}),typeof m=="string"?g("div",{style:{textOverflow:"ellipsis",overflow:"hidden"},children:m}):m]})},icon:a=>{const m=u.get(a).expanded;if(typeof m=="boolean")return m?"codicon-chevron-down":"codicon-chevron-right"},isError:a=>(s==null?void 0:s(a))||!1,indent:a=>u.get(a).depth,selectedItem:i,onAccepted:a=>n==null?void 0:n(a),onSelected:a=>r==null?void 0:r(a),onHighlighted:a=>c==null?void 0:c(a),onLeftArrow:a=>{const{expanded:m,parent:b}=u.get(a);m?(l.expandedItems.set(a.id,!1),p({...l})):b&&(r==null||r(b))},onRightArrow:a=>{a.children.length&&(l.expandedItems.set(a.id,!0),p({...l}))},onIconClicked:a=>{const{expanded:m}=u.get(a);if(m){for(let b=i;b;b=b.parent)if(b===a){r==null||r(a);break}l.expandedItems.set(a.id,!1)}else l.expandedItems.set(a.id,!0);p({...l})},noItemsMessage:d})}function Re(o,t,e){const s=new Map,i=(n,r)=>{for(const c of n.children){const l=t.get(c.id),p=(e||r===0)&&s.size<25&&l!==!1,d=c.children.length?l||p:void 0;s.set(c,{depth:r,expanded:d,parent:o===n?null:n}),d&&i(c,r+1)}};return i(o,0),s}class Ne{constructor(t){this._tests=new Map,this._rootSuite=new j("","root"),this._reporter=t}dispatch(t){const{method:e,params:s}=t;if(e==="onBegin"){this._onBegin(s.config,s.projects);return}if(e==="onTestBegin"){this._onTestBegin(s.testId,s.result);return}if(e==="onTestEnd"){this._onTestEnd(s.testId,s.result);return}if(e==="onStepBegin"){this._onStepBegin(s.testId,s.resultId,s.step);return}if(e==="onStepEnd"){this._onStepEnd(s.testId,s.resultId,s.step);return}if(e==="onError"){this._onError(s.error);return}if(e==="onStdIO"){this._onStdIO(s.type,s.testId,s.resultId,s.data,s.isBase64);return}if(e==="onEnd"){this._onEnd(s.result);return}}_onBegin(t,e){var i,n;const s=t.listOnly;for(const r of e){let c=this._rootSuite.suites.find(p=>p.project().id===r.id);c||(c=new j(r.name,"project"),this._rootSuite.suites.push(c),c.parent=this._rootSuite);const l=this._parseProject(r);c.project=()=>l,this._mergeSuitesInto(r.suites,c,s)}(n=(i=this._reporter).onBegin)==null||n.call(i,this._parseConfig(t),this._rootSuite)}_onTestBegin(t,e){var n,r;const s=this._tests.get(t),i=s._createTestResult(e.id);i.retry=e.retry,i.workerIndex=e.workerIndex,i.parallelIndex=e.parallelIndex,i.startTime=new Date(e.startTime),(r=(n=this._reporter).onTestBegin)==null||r.call(n,s,i)}_onTestEnd(t,e){var n,r;const s=this._tests.get(t),i=s.resultsMap.get(e.id);i.duration=e.duration,i.status=e.status,i.errors=e.errors,i.attachments=e.attachments,(r=(n=this._reporter).onTestEnd)==null||r.call(n,s,i)}_onStepBegin(t,e,s){var c,l;const i=this._tests.get(t),n=i.resultsMap.get(e),r={titlePath:()=>[],title:s.title,category:s.category,location:s.location,startTime:new Date(s.startTime),duration:0,steps:[]};n.stepMap.set(s.id,r),n.stepStack[n.stepStack.length-1].steps.push(r),n.stepStack.push(r),(l=(c=this._reporter).onStepBegin)==null||l.call(c,i,n,r)}_onStepEnd(t,e,s){var l,p;const i=this._tests.get(t),n=i.resultsMap.get(e),r=n.stepMap.get(s.id),c=n.stepStack.indexOf(r);c!==-1&&n.stepStack.splice(c,1),r.duration=s.duration,r.error=s.error,(p=(l=this._reporter).onStepEnd)==null||p.call(l,i,n,r)}_onError(t){var e,s;(s=(e=this._reporter).onError)==null||s.call(e,t)}_onStdIO(t,e,s,i,n){var p,d,h,w;const r=n?Buffer.from(i,"base64"):i,c=e?this._tests.get(e):void 0,l=c&&s?c.resultsMap.get(s):void 0;t==="stdout"?(d=(p=this._reporter).onStdOut)==null||d.call(p,r,c,l):(w=(h=this._reporter).onStdErr)==null||w.call(h,r,c,l)}_onEnd(t){var e,s;(s=(e=this._reporter).onEnd)==null||s.call(e,t)}_parseConfig(t){const e=oe;return e.rootDir=t.rootDir,e.configFile=t.configFile,e}_parseProject(t){return{id:t.id,metadata:t.metadata,name:t.name,outputDir:t.outputDir,repeatEach:t.repeatEach,retries:t.retries,testDir:t.testDir,testIgnore:$(t.testIgnore),testMatch:$(t.testMatch),timeout:t.timeout,grep:$(t.grep),grepInvert:$(t.grepInvert),dependencies:t.dependencies,snapshotDir:t.snapshotDir,use:{}}}_mergeSuitesInto(t,e,s){for(const i of t){let n=e.suites.find(r=>r.title===i.title);n||(n=new j(i.title,i.type),n.parent=e,e.suites.push(n)),n.location=i.location,n._fileId=i.fileId,n._parallelMode=i.parallelMode,this._mergeSuitesInto(i.suites,n,s),this._mergeTestsInto(i.tests,n,s)}if(s){const i=new Map(e.suites.map(n=>[n.title,n]));e.suites=t.map(n=>i.get(n.title)).filter(Boolean)}}_mergeTestsInto(t,e,s){for(const i of t){let n=e.tests.find(r=>r.title===i.title);n||(n=new Be(i.testId,i.title,i.location),n.parent=e,e.tests.push(n),this._tests.set(n.id,n)),this._updateTest(i,n)}if(s){const i=new Map(e.tests.map(n=>[n.title,n]));e.tests=t.map(n=>i.get(n.title)).filter(Boolean)}}_updateTest(t,e){return e.id=t.testId,e.expectedStatus=t.expectedStatus,e.timeout=t.timeout,e.location=t.location,e.annotations=t.annotations,e.retries=t.retries,e}}class j{constructor(t,e){this._requireFile="",this.suites=[],this.tests=[],this._parallelMode="default",this.title=t,this._type=e}allTests(){const t=[],e=s=>{for(const i of[...s.suites,...s.tests])i instanceof j?e(i):t.push(i)};return e(this),t}titlePath(){const t=this.parent?this.parent.titlePath():[];return(this.title||this._type!=="describe")&&t.push(this.title),t}project(){}}class Be{constructor(t,e,s){this.fn=()=>{},this.results=[],this.expectedStatus="passed",this.timeout=0,this.annotations=[],this.retries=0,this.repeatEachIndex=0,this.resultsMap=new Map,this.id=t,this.title=e,this.location=s}titlePath(){const t=this.parent?this.parent.titlePath():[];return t.push(this.title),t}outcome(){const t=this.results.filter(e=>e.status!=="skipped"&&e.status!=="interrupted");return t.length?t.every(e=>e.status===this.expectedStatus)?"expected":t.some(e=>e.status===this.expectedStatus)?"flaky":"unexpected":"skipped"}ok(){const t=this.outcome();return t==="expected"||t==="flaky"||t==="skipped"}_clearResults(){this.results=[],this.resultsMap.clear()}_createTestResult(t){this._clearResults();const e={retry:this.results.length,parallelIndex:-1,workerIndex:-1,duration:-1,startTime:new Date,stdout:[],stderr:[],attachments:[],status:"skipped",steps:[],errors:[],stepMap:new Map,stepStack:[]};return e.stepStack.push(e),this.results.push(e),this.resultsMap.set(t,e),e}}const oe={forbidOnly:!1,fullyParallel:!1,globalSetup:null,globalTeardown:null,globalTimeout:0,grep:/.*/,grepInvert:null,maxFailures:0,metadata:{},preserveOutput:"always",projects:[],reporter:[[{}.CI?"dot":"list"]],reportSlowTests:{max:5,threshold:15e3},configFile:"",rootDir:"",quiet:!1,shard:null,updateSnapshots:"missing",version:"",workers:0,webServer:null};function $(o){return o.map(t=>t.s?t.s:new RegExp(t.r.source,t.r.flags))}const Fe=({source:o})=>{const[t,e]=he(),[s,i]=D.useState(pe()),[n]=D.useState(ge(()=>import("./assets/xtermModule-0fb1e5c9.js"),["./assets/xtermModule-0fb1e5c9.js","./xtermModule.6428296b.css"],import.meta.url).then(c=>c.default)),r=D.useRef(null);return D.useEffect(()=>(me(i),()=>we(i)),[]),D.useEffect(()=>{const c=o.write,l=o.clear;return(async()=>{const{Terminal:p,FitAddon:d}=await n,h=e.current;if(!h)return;const w=s==="dark-mode"?Pe:De;if(r.current&&r.current.terminal.options.theme===w)return;r.current&&(h.textContent="");const u=new p({convertEol:!0,fontSize:13,scrollback:1e4,fontFamily:"var(--vscode-editor-font-family)",theme:w}),a=new d;u.loadAddon(a);for(const m of o.pending)u.write(m);o.write=m=>{o.pending.push(m),u.write(m)},o.clear=()=>{o.pending=[],u.clear()},u.open(h),a.fit(),r.current={terminal:u,fitAddon:a}})(),()=>{o.clear=l,o.write=c}},[n,r,e,o,s]),D.useEffect(()=>{setTimeout(()=>{r.current&&(r.current.fitAddon.fit(),o.resize(r.current.terminal.cols,r.current.terminal.rows))},250)},[t,o]),g("div",{"data-testid":"output",className:"xterm-wrapper",style:{flex:"auto"},ref:e})},De={foreground:"#383a42",background:"#fafafa",cursor:"#383a42",black:"#000000",red:"#e45649",green:"#50a14f",yellow:"#c18401",blue:"#4078f2",magenta:"#a626a4",cyan:"#0184bc",white:"#a0a0a0",brightBlack:"#000000",brightRed:"#e06c75",brightGreen:"#98c379",brightYellow:"#d19a66",brightBlue:"#4078f2",brightMagenta:"#a626a4",brightCyan:"#0184bc",brightWhite:"#383a42",selectionBackground:"#d7d7d7",selectionForeground:"#383a42"},Pe={foreground:"#f8f8f2",background:"#1e1e1e",cursor:"#f8f8f0",black:"#000000",red:"#ff5555",green:"#50fa7b",yellow:"#f1fa8c",blue:"#bd93f9",magenta:"#ff79c6",cyan:"#8be9fd",white:"#bfbfbf",brightBlack:"#4d4d4d",brightRed:"#ff6e6e",brightGreen:"#69ff94",brightYellow:"#ffffa5",brightBlue:"#d6acff",brightMagenta:"#ff92df",brightCyan:"#a4ffff",brightWhite:"#e6e6e6",selectionBackground:"#44475a",selectionForeground:"#f8f8f2"};function Le(o){return`.playwright-artifacts-${o}`}let G=()=>{},re=o=>{},le={cols:80,rows:24};const P={pending:[],clear:()=>{},write:o=>P.pending.push(o),resize:(o,t)=>{le={cols:o,rows:t},A("resizeTerminal",{cols:o,rows:t})}},Oe=({})=>{var ee;const[o,t]=v.useState(""),[e,s]=v.useState(!1),[i,n]=v.useState(new Map([["passed",!1],["failed",!1],["skipped",!1]])),[r,c]=v.useState(new Map),[l,p]=v.useState({config:void 0,rootSuite:void 0}),[d,h]=v.useState(),[w,u]=v.useState({}),[a,m]=v.useState(new Set),[b,E]=v.useState(!1),[y,L]=v.useState(),[O,f]=ve("watch-all",!1),[M,k]=v.useState({value:new Set}),x=v.useRef(Promise.resolve()),S=v.useRef(new Set),_=v.useRef(null),K=()=>{E(!0),k({value:new Set}),G(oe,new j("","root"),void 0),ae(!0).then(()=>{E(!1)})};v.useEffect(()=>{var B;(B=_.current)==null||B.focus(),K()},[]),G=(B,z,R)=>{const F=B.configFile?ne.getObject(B.configFile+":projects",void 0):void 0;for(const N of r.keys())z.suites.find(U=>U.title===N)||r.delete(N);for(const N of z.suites)r.has(N.title)||r.set(N.title,!!(F!=null&&F.includes(N.title)));!F&&r.size&&![...r.values()].includes(!0)&&r.set(r.entries().next().value[0],!0),p({config:B,rootSuite:z}),c(new Map(r)),y&&R?h({...R,total:y.testIds.size}):R||h(void 0)};const Q=v.useCallback((B,z)=>{B==="bounce-if-busy"&&y||(S.current=new Set([...S.current,...z]),x.current=x.current.then(async()=>{var N,U,te;const R=S.current;if(S.current=new Set,!R.size)return;{for(const V of((N=l.rootSuite)==null?void 0:N.allTests())||[])R.has(V.id)&&V._createTestResult("pending");p({...l})}const F="  ["+new Date().toLocaleTimeString()+"]";P.write("\x1B[2m—".repeat(Math.max(0,le.cols-F.length))+F+"\x1B[22m"),h({total:R.size,passed:0,failed:0,skipped:0}),L({testIds:R}),await J("run",{testIds:[...R]});for(const V of((U=l.rootSuite)==null?void 0:U.allTests())||[])((te=V.results[0])==null?void 0:te.duration)===-1&&V._clearResults();p({...l}),L(void 0)}))},[y,l]),W=!!y;return g("div",{className:"vbox watch-mode",children:T(ke,{sidebarSize:250,orientation:"horizontal",sidebarIsFirst:!0,children:[T("div",{className:"vbox",children:[T("div",{className:"vbox"+(e?"":" hidden"),children:[T(I,{children:[g("div",{className:"section-title",style:{flex:"none"},children:"Output"}),g(C,{icon:"circle-slash",title:"Clear output",onClick:()=>P.clear()}),g("div",{className:"spacer"}),g(C,{icon:"close",title:"Close",onClick:()=>s(!1)})]}),g(Fe,{source:P})]}),g("div",{className:"vbox"+(e?" hidden":""),children:g(Ve,{item:w,rootDir:(ee=l.config)==null?void 0:ee.rootDir})})]}),T("div",{className:"vbox watch-mode-sidebar",children:[T(I,{noShadow:!0,noMinHeight:!0,children:[g("img",{src:"icon-32x32.png"}),g("div",{className:"section-title",children:"Playwright"}),g(C,{icon:"color-mode",title:"Toggle color mode",onClick:()=>be()}),g(C,{icon:"refresh",title:"Reload",onClick:()=>K(),disabled:W||b}),g(C,{icon:"terminal",title:"Toggle output",toggled:e,onClick:()=>{s(!e)}})]}),g(We,{filterText:o,setFilterText:t,statusFilters:i,setStatusFilters:n,projectFilters:r,setProjectFilters:c,testModel:l,runTests:()=>Q("bounce-if-busy",a)}),T(I,{noMinHeight:!0,children:[!W&&!d&&g("div",{className:"section-title",children:"Tests"}),!W&&d&&g("div",{"data-testid":"status-line",className:"status-line",children:T("div",{children:[d.passed,"/",d.total," passed (",d.passed/d.total*100|0,"%)"]})}),W&&d&&g("div",{"data-testid":"status-line",className:"status-line",children:T("div",{children:["Running ",d.passed,"/",y.testIds.size," passed (",d.passed/y.testIds.size*100|0,"%)"]})}),g(C,{icon:"play",title:"Run all",onClick:()=>Q("bounce-if-busy",a),disabled:W||b}),g(C,{icon:"debug-stop",title:"Stop",onClick:()=>A("stop"),disabled:!W||b}),g(C,{icon:"eye",title:"Watch all",toggled:O,onClick:()=>f(!O)})]}),g(ze,{statusFilters:i,projectFilters:r,filterText:o,testModel:l,runningState:y,runTests:Q,onItemSelected:u,setVisibleTestIds:m,watchAll:O,watchedTreeIds:M,setWatchedTreeIds:k,isLoading:b})]})]})})},We=({filterText:o,setFilterText:t,statusFilters:e,setStatusFilters:s,projectFilters:i,setProjectFilters:n,testModel:r,runTests:c})=>{const[l,p]=v.useState(!1),d=v.useRef(null);v.useEffect(()=>{var u;(u=d.current)==null||u.focus()},[]);const h=[...e.entries()].filter(([u,a])=>a).map(([u])=>u).join(" ")||"all",w=[...i.entries()].filter(([u,a])=>a).map(([u])=>u).join(" ")||"all";return T("div",{className:"filters",children:[g(Se,{expanded:l,setExpanded:p,title:g("input",{ref:d,type:"search",placeholder:"Filter (e.g. text, @tag)",spellCheck:!1,value:o,onChange:u=>{t(u.target.value)},onKeyDown:u=>{u.key==="Enter"&&c()}})}),T("div",{className:"filter-summary",title:"Status: "+h+`
Projects: `+w,onClick:()=>p(!l),children:[g("span",{className:"filter-label",children:"Status:"})," ",h,g("span",{className:"filter-label",children:"Projects:"})," ",w]}),l&&T("div",{className:"hbox",style:{marginLeft:14},children:[g("div",{className:"filter-list",children:[...e.entries()].map(([u,a])=>g("div",{className:"filter-entry",children:T("label",{children:[g("input",{type:"checkbox",checked:a,onClick:()=>{const m=new Map(e);m.set(u,!m.get(u)),s(m)}}),g("div",{children:u})]})}))}),g("div",{className:"filter-list",children:[...i.entries()].map(([u,a])=>g("div",{className:"filter-entry",children:T("label",{children:[g("input",{type:"checkbox",checked:a,onClick:()=>{var E;const m=new Map(i);m.set(u,!m.get(u)),n(m);const b=(E=r==null?void 0:r.config)==null?void 0:E.configFile;b&&ne.setObject(b+":projects",[...m.entries()].filter(([y,L])=>L).map(([y])=>y))}}),g("div",{children:u})]})}))})]})]})},je=Ce,ze=({statusFilters:o,projectFilters:t,filterText:e,testModel:s,runTests:i,runningState:n,watchAll:r,watchedTreeIds:c,setWatchedTreeIds:l,isLoading:p,onItemSelected:d,setVisibleTestIds:h})=>{const[w,u]=v.useState({expandedItems:new Map}),[a,m]=v.useState(),{rootItem:b,treeItemMap:E,fileNames:y}=v.useMemo(()=>{const f=Ue(s.rootSuite,t);$e(f,e,o,n==null?void 0:n.testIds),qe(f);const M=new Map,k=new Set,x=new Set,S=_=>{_.kind==="group"&&_.location.file&&x.add(_.location.file),_.kind==="case"&&_.tests.forEach(K=>k.add(K.id)),_.children.forEach(S),M.set(_.id,_)};return S(f),h(k),{rootItem:f,treeItemMap:M,fileNames:x}},[e,s,o,t,h,n]);v.useEffect(()=>{if(!n||n.itemSelectedByUser)return;let f;const M=k=>{var x;k.children.forEach(M),!f&&k.status==="failed"&&(k.kind==="test"&&n.testIds.has(k.test.id)||k.kind==="case"&&n.testIds.has((x=k.tests[0])==null?void 0:x.id))&&(f=k)};M(b),f&&m(f.id)},[n,m,b]);const{selectedTreeItem:L}=v.useMemo(()=>{const f=a?E.get(a):void 0,M=f==null?void 0:f.location;let k;return(f==null?void 0:f.kind)==="test"?k=f.test:(f==null?void 0:f.kind)==="case"&&f.tests.length===1&&(k=f.tests[0]),d({testCase:k,location:M}),{selectedTreeItem:f}},[d,a,E]);v.useEffect(()=>{if(r)A("watch",{fileNames:[...y]});else{const f=new Set;for(const M of c.value){const k=E.get(M),x=k==null?void 0:k.location.file;x&&f.add(x)}A("watch",{fileNames:[...f]})}},[b,y,r,c,E]);const O=f=>{m(f.id),i("bounce-if-busy",Z(f))};return re=f=>{const M=[],k=new Set(f);if(r){const x=S=>{const _=S.location.file;_&&k.has(_)&&M.push(...Z(S)),S.kind==="group"&&S.subKind==="folder"&&S.children.forEach(x)};x(b)}else for(const x of c.value){const S=E.get(x),_=S==null?void 0:S.location.file;_&&k.has(_)&&M.push(...Z(S))}i("queue-if-busy",new Set(M))},g(je,{treeState:w,setTreeState:u,rootItem:b,dataTestId:"test-tree",render:f=>T("div",{className:"hbox watch-mode-list-item",children:[g("div",{className:"watch-mode-list-item-title",children:f.title}),!!f.duration&&f.status!=="skipped"&&g("div",{className:"watch-mode-list-item-time",children:Te(f.duration)}),T(I,{noMinHeight:!0,noShadow:!0,children:[g(C,{icon:"play",title:"Run",onClick:()=>O(f),disabled:!!n}),g(C,{icon:"go-to-file",title:"Open in VS Code",onClick:()=>A("open",{location:Ke(f)})}),!r&&g(C,{icon:"eye",title:"Watch",onClick:()=>{c.value.has(f.id)?c.value.delete(f.id):c.value.add(f.id),l({...c})},toggled:c.value.has(f.id)})]})]}),icon:f=>f.status==="scheduled"?"codicon-clock":f.status==="running"?"codicon-loading":f.status==="failed"?"codicon-error":f.status==="passed"?"codicon-check":f.status==="skipped"?"codicon-circle-slash":"codicon-circle-outline",selectedItem:L,onAccepted:O,onSelected:f=>{n&&(n.itemSelectedByUser=!0),m(f.id)},autoExpandDeep:!!e,noItemsMessage:p?"Loading…":"No tests"})},Ve=({item:o,rootDir:t})=>{const[e,s]=v.useState(),[i,n]=v.useState(0),r=v.useRef(null),{outputDir:c,result:l}=v.useMemo(()=>{var h;const p=o.testCase?Ae(o.testCase):void 0,d=(h=o.testCase)==null?void 0:h.results[0];return{outputDir:p,result:d}},[o]);return v.useEffect(()=>{var h;if(r.current&&clearTimeout(r.current),!l){s(void 0);return}const p=l&&l.duration>=0&&l.attachments.find(w=>w.name==="trace");if(p&&p.path){ie(p.path).then(w=>s(w));return}if(!c){s(void 0);return}const d=`${c}/${Le(l.workerIndex)}/traces/${(h=o.testCase)==null?void 0:h.id}.json`;return r.current=setTimeout(async()=>{try{const w=await ie(d);s(w)}catch{s(void 0)}finally{n(i+1)}},250),()=>{r.current&&clearTimeout(r.current)}},[l,c,o,s,i,n]),g(xe,{model:e,hideTimelineBars:!0,hideStackFrames:!0,showSourcesFirst:!0,rootDir:t,defaultSourceLocation:o.location},"workbench")};let Y,H,X;const se=()=>{clearTimeout(H),H=void 0,G(X.config,X.rootSuite,X.progress)},q=(o,t,e,s=!1)=>{X={config:o,rootSuite:t,progress:e},s?se():H||(H=setTimeout(se,250))},ae=o=>{if(!o)return J("list",{});let t;const e={passed:0,failed:0,skipped:0};let s;return Y=new Ne({onBegin:(i,n)=>{t||(t=n),s=i,e.passed=0,e.failed=0,e.skipped=0,q(s,t,e,!0)},onEnd:()=>{q(s,t,e,!0)},onTestBegin:()=>{q(s,t,e)},onTestEnd:i=>{i.outcome()==="skipped"?++e.skipped:i.outcome()==="unexpected"?++e.failed:++e.passed,q(s,t,e)},onError:i=>{P.write((i.stack||i.value||"")+`
`)}}),J("list",{})};window.dispatch=o=>{if(o.method==="listChanged"){ae(!1).catch(()=>{});return}if(o.method==="filesChanged"){re(o.params.fileNames);return}if(o.method==="stdio"){if(o.params.buffer){const t=atob(o.params.buffer);P.write(t)}else P.write(o.params.text);return}Y==null||Y.dispatch(o)};const J=async(o,t)=>{await window.sendMessage({method:o,params:t})},A=(o,t)=>{if(window._overrideProtocolForTest){window._overrideProtocolForTest({method:o,params:t}).catch(()=>{});return}J(o,t).catch(e=>{console.error(e)})},Ae=o=>{var t;for(let e=o.parent;e;e=e.parent)if(e.project())return(t=e.project())==null?void 0:t.outputDir},Ke=o=>{if(o)return o.location.file+":"+o.location.line},Z=o=>{const t=new Set;if(!o)return t;const e=s=>{var i;s.kind==="case"?s.tests.map(n=>n.id).forEach(n=>t.add(n)):s.kind==="test"?t.add(s.id):(i=s.children)==null||i.forEach(e)};return e(o),t};function ce(o,t,e,s){if(t.length===0)return o;const i=t.join(de),n=s.get(i);if(n)return n;const r=ce(o,t.slice(0,t.length-1),!1,s),c={kind:"group",subKind:e?"file":"folder",id:i,title:t[t.length-1],location:{file:i,line:0,column:0},duration:0,parent:r,children:[],status:"none"};return r.children.push(c),s.set(i,c),c}function Ue(o,t){const e=[...t.values()].some(Boolean),s={kind:"group",subKind:"folder",id:"root",title:"",location:{file:"",line:0,column:0},duration:0,parent:void 0,children:[],status:"none"},i=(l,p,d)=>{for(const h of p.suites){const w=h.title;let u=d.children.find(a=>a.title===w);u||(u={kind:"group",subKind:"describe",id:d.id+""+w,title:w,location:h.location,duration:0,parent:d,children:[],status:"none"},d.children.push(u)),i(l,h,u)}for(const h of p.tests){const w=h.title;let u=d.children.find(m=>m.title===w);u||(u={kind:"case",id:d.id+""+w,title:w,parent:d,children:[],tests:[],location:h.location,duration:0,status:"none"},d.children.push(u));let a="none";h.results.some(m=>m.workerIndex===-1)?a="scheduled":h.results.some(m=>m.duration===-1)?a="running":h.results.length&&h.results[0].status==="skipped"?a="skipped":h.results.length&&h.results[0].status==="interrupted"?a="none":h.results.length&&h.outcome()!=="expected"?a="failed":h.results.length&&h.outcome()==="expected"&&(a="passed"),u.tests.push(h),u.children.push({kind:"test",id:h.id,title:l,location:h.location,test:h,parent:u,children:[],status:a,duration:h.results.length?Math.max(0,h.results[0].duration):0,project:l}),u.duration=u.children.reduce((m,b)=>m+b.duration,0)}},n=new Map;for(const l of(o==null?void 0:o.suites)||[])if(!(e&&!t.get(l.title)))for(const p of l.suites){const d=ce(s,p.location.file.split(de),!0,n);i(l.title,p,d)}const r=l=>{for(const a of l.children)r(a);l.kind==="group"&&l.children.sort((a,m)=>a.location.file.localeCompare(m.location.file)||a.location.line-m.location.line);let p=l.children.length>0,d=l.children.length>0,h=!1,w=!1,u=!1;for(const a of l.children)d=d&&a.status==="skipped",p=p&&(a.status==="passed"||a.status==="skipped"),h=h||a.status==="failed",w=w||a.status==="running",u=u||a.status==="scheduled";w?l.status="running":u?l.status="scheduled":h?l.status="failed":d?l.status="skipped":p&&(l.status="passed")};r(s);let c=s;for(;c.children.length===1&&c.children[0].kind==="group"&&c.children[0].subKind==="folder";)c=c.children[0];return c.location=s.location,c}function $e(o,t,e,s){const i=t.trim().toLowerCase().split(" "),n=[...e.values()].some(Boolean),r=l=>{const p=l.tests[0].titlePath().join(" ").toLowerCase();return!i.every(d=>p.includes(d))&&!l.tests.some(d=>s==null?void 0:s.has(d.id))?!1:(l.children=l.children.filter(d=>!n||(s==null?void 0:s.has(d.id))||e.get(d.status)),l.tests=l.children.map(d=>d.test),!!l.children.length)},c=l=>{const p=[];for(const d of l.children)d.kind==="case"?r(d)&&p.push(d):(c(d),d.children.length&&p.push(d));l.children=p};c(o)}function qe(o){const t=e=>{e.kind==="case"&&e.children.length===1?e.children=[]:e.children.forEach(t)};t(o)}async function ie(o){const t=new URLSearchParams;t.set("trace",o);const s=await(await fetch(`contexts?${t.toString()}`)).json();return new _e(s)}const de=navigator.userAgent.toLowerCase().includes("windows")?"\\":"/";(async()=>(Me(),window.location.protocol!=="file:"&&(window.location.href.includes("isUnderTest=true")&&await new Promise(o=>setTimeout(o,1e3)),navigator.serviceWorker.register("sw.bundle.js"),navigator.serviceWorker.controller||await new Promise(o=>{navigator.serviceWorker.oncontrollerchange=()=>o()}),setInterval(function(){fetch("ping")},1e4)),ye.render(g(Oe,{}),document.querySelector("#root"))))();
