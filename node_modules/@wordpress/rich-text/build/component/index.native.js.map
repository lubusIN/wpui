{"version":3,"names":["_element","require","_reactNative","_memize","_interopRequireDefault","_colord","_reactNativeAztec","_reactNativeBridge","_blockEditor","_compose","_data","_blocks","_htmlEntities","_keycodes","_url","_icons","_i18n","_useFormatTypes","_formatEdit","_applyFormat","_getActiveFormat","_getActiveFormats","_insert","_getTextContent","_isEmpty","_create","_toHtmlString","_isCollapsed","_remove","_getFormatColors","_style","_toolbarButtonWithOptions","unescapeSpaces","text","replace","flatColorPalettes","memize","colorsPalettes","theme","custom","default","getSelectionColor","currentSelectionColor","defaultSelectionColor","baseGlobalStyles","isBlockBasedTheme","selectionColor","colordTextColor","colord","colordBackgroundColor","color","background","isColordTextReadable","isReadable","gutenbergFormatNamesToAztec","EMPTY_PARAGRAPH_TAGS","DEFAULT_FONT_SIZE","MIN_LINE_HEIGHT","RichText","Component","constructor","value","selectionStart","selectionEnd","__unstableMultilineTag","multiline","arguments","isMultiline","multilineTag","multilineWrapperTags","isIOS","Platform","OS","createRecord","bind","restoreParagraphTags","onChangeFromAztec","onKeyDown","handleEnter","handleDelete","onPaste","onFocus","onBlur","onTextUpdate","onContentSizeChange","onFormatChange","formatToValue","maxSize","debounceCreateUndoLevel","debounce","onCreateUndoLevel","onSelectionChange","onSelectionChangeFromAztec","valueToFormat","getHtmlToRender","handleSuggestionFunc","handleUserSuggestion","showUserSuggestions","handleXpostSuggestion","showXpostSuggestions","suggestionOptions","insertString","manipulateEventCounterToForceNativeToRefresh","shouldDropEventFromAztec","state","activeFormats","selectedFormat","height","currentFontSize","getFontSize","needsSelectionUpdate","savedContent","isTouched","lastAztecEventType","lastHistoryValue","getRecord","start","end","colorPalette","props","currentValue","formats","replacements","newFormats","getFormatColors","preserveWhiteSpace","create","html","range","Math","min","length","removeRootTagsProducedByAztec","toHTMLString","getActiveFormatNames","record","formatTypes","map","name","filter","getActiveFormat","undefined","Boolean","changeHandlers","Object","fromEntries","entries","key","startsWith","values","forEach","changeHandler","onChange","setState","string","toInsert","insert","__unstableOnCreateUndoLevel","result","removeRootTag","tagName","tagsToEliminate","element","removeTag","tag","openingTagRegexp","RegExp","closingTagRegexp","event","contentWithoutRootTag","nativeEvent","lastEventCount","eventCount","comesFromAztec","firedAfterTextChanged","formattedContent","refresh","contentSize","defaultPrevented","customEditableOnKeyDown","preventDefault","RCTAztecView","KeyCodes","keyCode","handleTriggerKeyCodes","ENTER","onEnter","shiftKey","DELETE","BACKSPACE","isReverse","onDelete","newValue","remove","isCollapsed","triggeredOption","find","option","triggeredKeyCode","triggerChar","charCodeAt","getTextContent","useTrigger","charAt","onClick","areMentionsSupported","areXPostsSupported","allOptions","supported","title","__","label","icon","atSymbol","plus","op","suggestionFunction","prefix","then","suggestion","catch","pastedText","pastedHtml","files","currentRecord","trimmedText","trim","isURL","linkedRecord","applyFormat","type","attributes","href","decodeEntities","window","console","log","plainText","unstableOnFocus","hasChanged","isManual","getActiveFormats","logText","shouldDrop","realStart","realEnd","max","__unstableIsSelected","isEmpty","Array","isArray","childrenBlock","toHTML","format","shouldComponentUpdate","nextProps","nextState","reversed","fontSize","style","lineHeight","componentDidMount","blockIsSelected","__unstableMobileNoFocusOnMount","_editor","focus","componentWillUnmount","isFocused","blur","componentDidUpdate","prevProps","isSelected","prevIsSelected","currentFontSizeStyle","getParsedFontSize","prevFontSizeStyle","isDifferentTag","extraAttributes","getEditableProps","className","_getPxFromCssUnit","width","Dimensions","get","cssUnitOptions","selectedPxValue","getPxFromCssUnit","parseFloat","tagNameFontSize","elements","typography","newFontSize","getLineHeight","tagNameLineHeight","newLineHeight","getIsBlockBasedTheme","isNaN","getBlockUseDefaultFont","tagsToMatch","test","getLinkTextColor","defaultColor","customColor","linkColor","isValid","toHex","getPlaceholderTextColor","_ref","_ref2","getStylesFromColorScheme","placeholderTextColor","placeholderStyle","styles","richTextPlaceholder","richTextPlaceholderDark","defaultPlaceholderTextColor","placeholderOpacity","inheritPlaceholderColor","placeholderColor","globalStylesPlaceholderColor","render","children","minWidth","maxWidth","parentBlockStyles","accessibilityLabel","disableEditingMenu","disableSuggestions","containerWidth","editableProps","blockUseDefaultFont","textDecorationColor","defaultTextDecorationColor","fontFamily","defaultFontFamily","richText","richTextDark","linkTextColor","currentSelectionStart","currentSelectionEnd","selection","brBeforeParaMatches","match","warn","count","newSelectionStart","newSelectionEnd","containerStyles","padding","backgroundColor","EditableView","createElement","Fragment","View","editableTagName","ref","setRef","minHeight","placeholder","deleteEnter","triggerKeyCodes","blockType","maxImagesWidth","fontWeight","fontStyle","textAlign","id","disableAutocorrection","forwardedRef","BlockFormatControls","options","exports","defaultProps","withFormatTypes","WrappedComponent","clientId","identifier","withoutInteractiveFormatting","allowedFormats","useFormatTypes","_default","compose","withSelect","select","getBlockParents","getBlock","getSettings","parents","parentBlock","childrenStyles","settings","__experimentalGlobalStylesBaseStyles","colorPalettes","__experimentalFeatures","palette","colors","capabilities","mentions","xposts","withPreferredColorScheme"],"sources":["@wordpress/rich-text/src/component/index.native.js"],"sourcesContent":["/* eslint no-console: [\"error\", { allow: [\"warn\"] }] */\n\n/**\n * External dependencies\n */\nimport { View, Platform, Dimensions } from 'react-native';\nimport memize from 'memize';\nimport { colord } from 'colord';\n\n/**\n * WordPress dependencies\n */\nimport RCTAztecView from '@wordpress/react-native-aztec';\nimport {\n\tshowUserSuggestions,\n\tshowXpostSuggestions,\n} from '@wordpress/react-native-bridge';\nimport { BlockFormatControls, getPxFromCssUnit } from '@wordpress/block-editor';\nimport { Component } from '@wordpress/element';\nimport {\n\tcompose,\n\tdebounce,\n\twithPreferredColorScheme,\n} from '@wordpress/compose';\nimport { withSelect } from '@wordpress/data';\nimport { childrenBlock } from '@wordpress/blocks';\nimport { decodeEntities } from '@wordpress/html-entities';\nimport { BACKSPACE, DELETE, ENTER } from '@wordpress/keycodes';\nimport { isURL } from '@wordpress/url';\nimport { atSymbol, plus } from '@wordpress/icons';\nimport { __ } from '@wordpress/i18n';\n\n/**\n * Internal dependencies\n */\nimport { useFormatTypes } from './use-format-types';\nimport FormatEdit from './format-edit';\nimport { applyFormat } from '../apply-format';\nimport { getActiveFormat } from '../get-active-format';\nimport { getActiveFormats } from '../get-active-formats';\nimport { insert } from '../insert';\nimport { getTextContent } from '../get-text-content';\nimport { isEmpty } from '../is-empty';\nimport { create } from '../create';\nimport { toHTMLString } from '../to-html-string';\nimport { isCollapsed } from '../is-collapsed';\nimport { remove } from '../remove';\nimport { getFormatColors } from '../get-format-colors';\nimport styles from './style.scss';\nimport ToolbarButtonWithOptions from './toolbar-button-with-options';\n\nconst unescapeSpaces = ( text ) => {\n\treturn text.replace( /&nbsp;|&#160;/gi, ' ' );\n};\n\n// The flattened color palettes array is memoized to ensure that the same array instance is\n// returned for the colors palettes. This value might be used as a prop, so having the same\n// instance will prevent unnecessary re-renders of the RichText component.\nconst flatColorPalettes = memize( ( colorsPalettes ) => [\n\t...( colorsPalettes?.theme || [] ),\n\t...( colorsPalettes?.custom || [] ),\n\t...( colorsPalettes?.default || [] ),\n] );\n\nconst getSelectionColor = memize(\n\t(\n\t\tcurrentSelectionColor,\n\t\tdefaultSelectionColor,\n\t\tbaseGlobalStyles,\n\t\tisBlockBasedTheme\n\t) => {\n\t\tlet selectionColor = defaultSelectionColor;\n\t\tif ( currentSelectionColor ) {\n\t\t\tselectionColor = currentSelectionColor;\n\t\t}\n\n\t\tif ( isBlockBasedTheme ) {\n\t\t\tconst colordTextColor = colord( selectionColor );\n\t\t\tconst colordBackgroundColor = colord(\n\t\t\t\tbaseGlobalStyles?.color?.background\n\t\t\t);\n\t\t\tconst isColordTextReadable = colordTextColor.isReadable(\n\t\t\t\tcolordBackgroundColor\n\t\t\t);\n\t\t\tif ( ! isColordTextReadable ) {\n\t\t\t\tselectionColor = baseGlobalStyles?.color?.text;\n\t\t\t}\n\t\t}\n\n\t\treturn selectionColor;\n\t}\n);\n\nconst gutenbergFormatNamesToAztec = {\n\t'core/bold': 'bold',\n\t'core/italic': 'italic',\n\t'core/strikethrough': 'strikethrough',\n\t'core/text-color': 'mark',\n};\n\nconst EMPTY_PARAGRAPH_TAGS = '<p></p>';\nconst DEFAULT_FONT_SIZE = 16;\nconst MIN_LINE_HEIGHT = 1;\n\nexport class RichText extends Component {\n\tconstructor( {\n\t\tvalue,\n\t\tselectionStart,\n\t\tselectionEnd,\n\t\t__unstableMultilineTag: multiline,\n\t} ) {\n\t\tsuper( ...arguments );\n\n\t\tthis.isMultiline = false;\n\t\tif ( multiline === true || multiline === 'p' || multiline === 'li' ) {\n\t\t\tthis.multilineTag = multiline === true ? 'p' : multiline;\n\t\t\tthis.isMultiline = true;\n\t\t}\n\n\t\tif ( this.multilineTag === 'li' ) {\n\t\t\tthis.multilineWrapperTags = [ 'ul', 'ol' ];\n\t\t}\n\n\t\tthis.isIOS = Platform.OS === 'ios';\n\t\tthis.createRecord = this.createRecord.bind( this );\n\t\tthis.restoreParagraphTags = this.restoreParagraphTags.bind( this );\n\t\tthis.onChangeFromAztec = this.onChangeFromAztec.bind( this );\n\t\tthis.onKeyDown = this.onKeyDown.bind( this );\n\t\tthis.handleEnter = this.handleEnter.bind( this );\n\t\tthis.handleDelete = this.handleDelete.bind( this );\n\t\tthis.onPaste = this.onPaste.bind( this );\n\t\tthis.onFocus = this.onFocus.bind( this );\n\t\tthis.onBlur = this.onBlur.bind( this );\n\t\tthis.onTextUpdate = this.onTextUpdate.bind( this );\n\t\tthis.onContentSizeChange = this.onContentSizeChange.bind( this );\n\t\tthis.onFormatChange = this.onFormatChange.bind( this );\n\t\tthis.formatToValue = memize( this.formatToValue.bind( this ), {\n\t\t\tmaxSize: 1,\n\t\t} );\n\t\tthis.debounceCreateUndoLevel = debounce( this.onCreateUndoLevel, 1000 );\n\t\t// This prevents a bug in Aztec which triggers onSelectionChange twice on format change.\n\t\tthis.onSelectionChange = this.onSelectionChange.bind( this );\n\t\tthis.onSelectionChangeFromAztec =\n\t\t\tthis.onSelectionChangeFromAztec.bind( this );\n\t\tthis.valueToFormat = this.valueToFormat.bind( this );\n\t\tthis.getHtmlToRender = this.getHtmlToRender.bind( this );\n\t\tthis.handleSuggestionFunc = this.handleSuggestionFunc.bind( this );\n\t\tthis.handleUserSuggestion = this.handleSuggestionFunc(\n\t\t\tshowUserSuggestions,\n\t\t\t'@'\n\t\t).bind( this );\n\t\tthis.handleXpostSuggestion = this.handleSuggestionFunc(\n\t\t\tshowXpostSuggestions,\n\t\t\t'+'\n\t\t).bind( this );\n\t\tthis.suggestionOptions = this.suggestionOptions.bind( this );\n\t\tthis.insertString = this.insertString.bind( this );\n\t\tthis.manipulateEventCounterToForceNativeToRefresh =\n\t\t\tthis.manipulateEventCounterToForceNativeToRefresh.bind( this );\n\t\tthis.shouldDropEventFromAztec =\n\t\t\tthis.shouldDropEventFromAztec.bind( this );\n\t\tthis.state = {\n\t\t\tactiveFormats: [],\n\t\t\tselectedFormat: null,\n\t\t\theight: 0,\n\t\t\tcurrentFontSize: this.getFontSize( arguments[ 0 ] ),\n\t\t};\n\t\tthis.needsSelectionUpdate = false;\n\t\tthis.savedContent = '';\n\t\tthis.isTouched = false;\n\t\tthis.lastAztecEventType = null;\n\n\t\tthis.lastHistoryValue = value;\n\n\t\t// Internal values that are update synchronously, unlike props.\n\t\tthis.value = value;\n\t\tthis.selectionStart = selectionStart;\n\t\tthis.selectionEnd = selectionEnd;\n\t}\n\n\t/**\n\t * Get the current record (value and selection) from props and state.\n\t *\n\t * @return {Object} The current record (value and selection).\n\t */\n\tgetRecord() {\n\t\tconst {\n\t\t\tselectionStart: start,\n\t\t\tselectionEnd: end,\n\t\t\tcolorPalette,\n\t\t} = this.props;\n\t\tconst { value } = this.props;\n\t\tconst currentValue = this.formatToValue( value );\n\n\t\tconst { formats, replacements, text } = currentValue;\n\t\tconst { activeFormats } = this.state;\n\t\tconst newFormats = getFormatColors( value, formats, colorPalette );\n\n\t\treturn {\n\t\t\tformats: newFormats,\n\t\t\treplacements,\n\t\t\ttext,\n\t\t\tstart,\n\t\t\tend,\n\t\t\tactiveFormats,\n\t\t};\n\t}\n\n\t/**\n\t * Creates a RichText value \"record\" from the current content and selection\n\t * information\n\t *\n\t *\n\t * @return {Object} A RichText value with formats and selection.\n\t */\n\tcreateRecord() {\n\t\tconst { preserveWhiteSpace } = this.props;\n\t\tconst value = {\n\t\t\tstart: this.selectionStart,\n\t\t\tend: this.selectionEnd,\n\t\t\t...create( {\n\t\t\t\thtml: this.value,\n\t\t\t\trange: null,\n\t\t\t\tmultilineTag: this.multilineTag,\n\t\t\t\tmultilineWrapperTags: this.multilineWrapperTags,\n\t\t\t\tpreserveWhiteSpace,\n\t\t\t} ),\n\t\t};\n\t\tconst start = Math.min( this.selectionStart, value.text.length );\n\t\tconst end = Math.min( this.selectionEnd, value.text.length );\n\t\treturn { ...value, start, end };\n\t}\n\n\tvalueToFormat( value ) {\n\t\t// Remove the outer root tags.\n\t\treturn this.removeRootTagsProducedByAztec(\n\t\t\ttoHTMLString( {\n\t\t\t\tvalue,\n\t\t\t\tmultilineTag: this.multilineTag,\n\t\t\t} )\n\t\t);\n\t}\n\n\tgetActiveFormatNames( record ) {\n\t\tconst { formatTypes } = this.props;\n\n\t\treturn formatTypes\n\t\t\t.map( ( { name } ) => name )\n\t\t\t.filter( ( name ) => {\n\t\t\t\treturn getActiveFormat( record, name ) !== undefined;\n\t\t\t} )\n\t\t\t.map( ( name ) => gutenbergFormatNamesToAztec[ name ] )\n\t\t\t.filter( Boolean );\n\t}\n\n\tonFormatChange( record ) {\n\t\tconst { start = 0, end = 0, activeFormats = [] } = record;\n\t\tconst changeHandlers = Object.fromEntries(\n\t\t\tObject.entries( this.props ).filter( ( [ key ] ) =>\n\t\t\t\tkey.startsWith( 'format_on_change_functions_' )\n\t\t\t)\n\t\t);\n\n\t\tObject.values( changeHandlers ).forEach( ( changeHandler ) => {\n\t\t\tchangeHandler( record.formats, record.text );\n\t\t} );\n\n\t\tthis.value = this.valueToFormat( record );\n\t\tthis.props.onChange( this.value );\n\t\tthis.setState( { activeFormats } );\n\t\tthis.props.onSelectionChange( start, end );\n\t\tthis.selectionStart = start;\n\t\tthis.selectionEnd = end;\n\n\t\tthis.onCreateUndoLevel();\n\n\t\tthis.lastAztecEventType = 'format change';\n\t}\n\n\tinsertString( record, string ) {\n\t\tif ( record && string ) {\n\t\t\tthis.manipulateEventCounterToForceNativeToRefresh(); // force a refresh on the native side\n\t\t\tconst toInsert = insert( record, string );\n\t\t\tthis.onFormatChange( toInsert );\n\t\t}\n\t}\n\n\tonCreateUndoLevel() {\n\t\tconst { __unstableOnCreateUndoLevel: onCreateUndoLevel } = this.props;\n\t\t// If the content is the same, no level needs to be created.\n\t\tif ( this.lastHistoryValue === this.value ) {\n\t\t\treturn;\n\t\t}\n\n\t\tonCreateUndoLevel();\n\t\tthis.lastHistoryValue = this.value;\n\t}\n\n\t/*\n\t * Cleans up any root tags produced by aztec.\n\t * TODO: This should be removed on a later version when aztec doesn't return the top tag of the text being edited\n\t */\n\tremoveRootTagsProducedByAztec( html ) {\n\t\tlet result = this.removeRootTag( this.props.tagName, html );\n\n\t\tif ( this.props.tagsToEliminate ) {\n\t\t\tthis.props.tagsToEliminate.forEach( ( element ) => {\n\t\t\t\tresult = this.removeTag( element, result );\n\t\t\t} );\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tremoveRootTag( tag, html ) {\n\t\tconst openingTagRegexp = RegExp( '^<' + tag + '[^>]*>', 'gim' );\n\t\tconst closingTagRegexp = RegExp( '</' + tag + '>$', 'gim' );\n\n\t\treturn html\n\t\t\t.replace( openingTagRegexp, '' )\n\t\t\t.replace( closingTagRegexp, '' );\n\t}\n\n\tremoveTag( tag, html ) {\n\t\tconst openingTagRegexp = RegExp( '<' + tag + '>', 'gim' );\n\t\tconst closingTagRegexp = RegExp( '</' + tag + '>', 'gim' );\n\t\treturn html\n\t\t\t.replace( openingTagRegexp, '' )\n\t\t\t.replace( closingTagRegexp, '' );\n\t}\n\n\t/*\n\t * Handles any case where the content of the AztecRN instance has changed\n\t */\n\tonChangeFromAztec( event ) {\n\t\tif ( this.shouldDropEventFromAztec( event, 'onChange' ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst contentWithoutRootTag = this.removeRootTagsProducedByAztec(\n\t\t\tunescapeSpaces( event.nativeEvent.text )\n\t\t);\n\t\t// On iOS, onChange can be triggered after selection changes, even though there are no content changes.\n\t\tif ( contentWithoutRootTag === this.value ) {\n\t\t\treturn;\n\t\t}\n\t\tthis.lastEventCount = event.nativeEvent.eventCount;\n\t\tthis.comesFromAztec = true;\n\t\tthis.firedAfterTextChanged = true; // The onChange event always fires after the fact.\n\t\tthis.onTextUpdate( event );\n\t\tthis.lastAztecEventType = 'input';\n\t}\n\n\tonTextUpdate( event ) {\n\t\tconst contentWithoutRootTag = this.removeRootTagsProducedByAztec(\n\t\t\tunescapeSpaces( event.nativeEvent.text )\n\t\t);\n\t\tlet formattedContent = contentWithoutRootTag;\n\t\tif ( ! this.isIOS ) {\n\t\t\tformattedContent = this.restoreParagraphTags(\n\t\t\t\tcontentWithoutRootTag,\n\t\t\t\tthis.multilineTag\n\t\t\t);\n\t\t}\n\n\t\tthis.debounceCreateUndoLevel();\n\t\tconst refresh = this.value !== formattedContent;\n\t\tthis.value = formattedContent;\n\n\t\t// We don't want to refresh if our goal is just to create a record.\n\t\tif ( refresh ) {\n\t\t\tthis.props.onChange( formattedContent );\n\t\t}\n\t}\n\n\trestoreParagraphTags( value, tag ) {\n\t\tif ( tag === 'p' && ( ! value || ! value.startsWith( '<p>' ) ) ) {\n\t\t\treturn '<p>' + value + '</p>';\n\t\t}\n\t\treturn value;\n\t}\n\n\t/*\n\t * Handles any case where the content of the AztecRN instance has changed in size\n\t */\n\tonContentSizeChange( contentSize ) {\n\t\tthis.setState( contentSize );\n\t\tthis.lastAztecEventType = 'content size change';\n\t}\n\n\tonKeyDown( event ) {\n\t\tif ( event.defaultPrevented ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Add stubs for conformance in downstream autocompleters logic.\n\t\tthis.customEditableOnKeyDown?.( {\n\t\t\tpreventDefault: () => undefined,\n\t\t\t...event,\n\t\t\tkey: RCTAztecView.KeyCodes[ event?.keyCode ],\n\t\t} );\n\n\t\tthis.handleDelete( event );\n\t\tthis.handleEnter( event );\n\t\tthis.handleTriggerKeyCodes( event );\n\t}\n\n\thandleEnter( event ) {\n\t\tif ( event.keyCode !== ENTER ) {\n\t\t\treturn;\n\t\t}\n\t\tconst { onEnter } = this.props;\n\n\t\tif ( ! onEnter ) {\n\t\t\treturn;\n\t\t}\n\n\t\tonEnter( {\n\t\t\tvalue: this.createRecord(),\n\t\t\tonChange: this.onFormatChange,\n\t\t\tshiftKey: event.shiftKey,\n\t\t} );\n\t\tthis.lastAztecEventType = 'input';\n\t}\n\n\thandleDelete( event ) {\n\t\tif ( this.shouldDropEventFromAztec( event, 'handleDelete' ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { keyCode } = event;\n\n\t\tif ( keyCode !== DELETE && keyCode !== BACKSPACE ) {\n\t\t\treturn;\n\t\t}\n\t\tconst isReverse = keyCode === BACKSPACE;\n\n\t\tconst { onDelete } = this.props;\n\t\tthis.lastEventCount = event.nativeEvent.eventCount;\n\t\tthis.comesFromAztec = true;\n\t\tthis.firedAfterTextChanged = event.nativeEvent.firedAfterTextChanged;\n\t\tconst value = this.createRecord();\n\t\tconst { start, end, text } = value;\n\t\tlet newValue;\n\n\t\t// Always handle full content deletion ourselves.\n\t\tif ( start === 0 && end !== 0 && end >= text.length ) {\n\t\t\tnewValue = remove( value );\n\t\t\tthis.onFormatChange( newValue );\n\t\t\tevent.preventDefault();\n\t\t\treturn;\n\t\t}\n\n\t\t// Only process delete if the key press occurs at an uncollapsed edge.\n\t\tif (\n\t\t\t! onDelete ||\n\t\t\t! isCollapsed( value ) ||\n\t\t\t( isReverse && start !== 0 ) ||\n\t\t\t( ! isReverse && end !== text.length )\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tonDelete( { isReverse, value } );\n\n\t\tevent.preventDefault();\n\t\tthis.lastAztecEventType = 'input';\n\t}\n\n\thandleTriggerKeyCodes( event ) {\n\t\tconst { keyCode } = event;\n\t\tconst triggeredOption = this.suggestionOptions().find( ( option ) => {\n\t\t\tconst triggeredKeyCode = option.triggerChar.charCodeAt( 0 );\n\t\t\treturn triggeredKeyCode === keyCode;\n\t\t} );\n\n\t\tif ( triggeredOption ) {\n\t\t\tconst record = this.getRecord();\n\t\t\tconst text = getTextContent( record );\n\t\t\t// Only respond to the trigger if the selection is on the start of text or line\n\t\t\t// or if the character before is a space.\n\t\t\tconst useTrigger =\n\t\t\t\ttext.length === 0 ||\n\t\t\t\trecord.start === 0 ||\n\t\t\t\ttext.charAt( record.start - 1 ) === '\\n' ||\n\t\t\t\ttext.charAt( record.start - 1 ) === ' ';\n\n\t\t\tif ( useTrigger && triggeredOption.onClick ) {\n\t\t\t\ttriggeredOption.onClick();\n\t\t\t} else {\n\t\t\t\tthis.insertString( record, triggeredOption.triggerChar );\n\t\t\t}\n\t\t}\n\t}\n\n\tsuggestionOptions() {\n\t\tconst { areMentionsSupported, areXPostsSupported } = this.props;\n\t\tconst allOptions = [\n\t\t\t{\n\t\t\t\tsupported: areMentionsSupported,\n\t\t\t\ttitle: __( 'Insert mention' ),\n\t\t\t\tonClick: this.handleUserSuggestion,\n\t\t\t\ttriggerChar: '@',\n\t\t\t\tvalue: 'mention',\n\t\t\t\tlabel: __( 'Mention' ),\n\t\t\t\ticon: atSymbol,\n\t\t\t},\n\t\t\t{\n\t\t\t\tsupported: areXPostsSupported,\n\t\t\t\ttitle: __( 'Insert crosspost' ),\n\t\t\t\tonClick: this.handleXpostSuggestion,\n\t\t\t\ttriggerChar: '+',\n\t\t\t\tvalue: 'crosspost',\n\t\t\t\tlabel: __( 'Crosspost' ),\n\t\t\t\ticon: plus,\n\t\t\t},\n\t\t];\n\t\treturn allOptions.filter( ( op ) => op.supported );\n\t}\n\n\thandleSuggestionFunc( suggestionFunction, prefix ) {\n\t\treturn () => {\n\t\t\tconst record = this.getRecord();\n\t\t\tsuggestionFunction()\n\t\t\t\t.then( ( suggestion ) => {\n\t\t\t\t\tthis.insertString( record, `${ prefix }${ suggestion } ` );\n\t\t\t\t} )\n\t\t\t\t.catch( () => {} );\n\t\t};\n\t}\n\n\t/**\n\t * Handles a paste event from the native Aztec Wrapper.\n\t *\n\t * @param {Object} event The paste event which wraps `nativeEvent`.\n\t */\n\tonPaste( event ) {\n\t\tconst { onPaste, onChange } = this.props;\n\t\tconst { activeFormats = [] } = this.state;\n\n\t\tconst { pastedText, pastedHtml, files } = event.nativeEvent;\n\t\tconst currentRecord = this.createRecord();\n\n\t\tevent.preventDefault();\n\n\t\t// There is a selection, check if a URL is pasted.\n\t\tif ( ! isCollapsed( currentRecord ) ) {\n\t\t\tconst trimmedText = ( pastedHtml || pastedText )\n\t\t\t\t.replace( /<[^>]+>/g, '' )\n\t\t\t\t.trim();\n\n\t\t\t// A URL was pasted, turn the selection into a link.\n\t\t\tif ( isURL( trimmedText ) ) {\n\t\t\t\tconst linkedRecord = applyFormat( currentRecord, {\n\t\t\t\t\ttype: 'a',\n\t\t\t\t\tattributes: {\n\t\t\t\t\t\thref: decodeEntities( trimmedText ),\n\t\t\t\t\t},\n\t\t\t\t} );\n\t\t\t\tthis.value = this.valueToFormat( linkedRecord );\n\t\t\t\tonChange( this.value );\n\n\t\t\t\t// Allows us to ask for this information when we get a report.\n\t\t\t\twindow.console.log( 'Created link:\\n\\n', trimmedText );\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif ( onPaste ) {\n\t\t\tonPaste( {\n\t\t\t\tvalue: currentRecord,\n\t\t\t\tonChange: this.onFormatChange,\n\t\t\t\thtml: pastedHtml,\n\t\t\t\tplainText: pastedText,\n\t\t\t\tfiles,\n\t\t\t\tactiveFormats,\n\t\t\t} );\n\t\t}\n\t}\n\n\tonFocus() {\n\t\tthis.isTouched = true;\n\n\t\tconst { unstableOnFocus, onSelectionChange } = this.props;\n\n\t\tif ( unstableOnFocus ) {\n\t\t\tunstableOnFocus();\n\t\t}\n\n\t\t// We know for certain that on focus, the old selection is invalid. It\n\t\t// will be recalculated on `selectionchange`.\n\n\t\tonSelectionChange( this.selectionStart, this.selectionEnd );\n\n\t\tthis.lastAztecEventType = 'focus';\n\t}\n\n\tonBlur( event ) {\n\t\tthis.isTouched = false;\n\n\t\t// Check if value is up to date with latest state of native AztecView.\n\t\tif (\n\t\t\tevent.nativeEvent.text &&\n\t\t\tevent.nativeEvent.text !== this.props.value\n\t\t) {\n\t\t\tthis.onTextUpdate( event );\n\t\t}\n\n\t\tif ( this.props.onBlur ) {\n\t\t\tthis.props.onBlur( event );\n\t\t}\n\n\t\tthis.lastAztecEventType = 'blur';\n\t}\n\n\tonSelectionChange( start, end ) {\n\t\tconst hasChanged =\n\t\t\tthis.selectionStart !== start || this.selectionEnd !== end;\n\n\t\tthis.selectionStart = start;\n\t\tthis.selectionEnd = end;\n\n\t\t// This is a manual selection change event if onChange was not triggered just before\n\t\t// and we did not just trigger a text update\n\t\t// `onChange` could be the last event and could have been triggered a long time ago so\n\t\t// this approach is not perfectly reliable.\n\t\tconst isManual =\n\t\t\tthis.lastAztecEventType !== 'input' &&\n\t\t\tthis.props.value === this.value;\n\t\tif ( hasChanged && isManual ) {\n\t\t\tconst value = this.createRecord();\n\t\t\tconst activeFormats = getActiveFormats( value );\n\t\t\tthis.setState( { activeFormats } );\n\t\t}\n\n\t\tthis.props.onSelectionChange( start, end );\n\t}\n\n\tshouldDropEventFromAztec( event, logText ) {\n\t\tconst shouldDrop =\n\t\t\t! this.isIOS && event.nativeEvent.eventCount <= this.lastEventCount;\n\t\tif ( shouldDrop ) {\n\t\t\twindow.console.log(\n\t\t\t\t`Dropping ${ logText } from Aztec as its event counter is older than latest sent to the native side. Got ${ event.nativeEvent.eventCount } but lastEventCount is ${ this.lastEventCount }.`\n\t\t\t);\n\t\t}\n\t\treturn shouldDrop;\n\t}\n\n\tonSelectionChangeFromAztec( start, end, text, event ) {\n\t\tif ( this.shouldDropEventFromAztec( event, 'onSelectionChange' ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// `end` can be less than `start` on iOS\n\t\t// Let's fix that here so `rich-text/slice` can work properly.\n\t\tconst realStart = Math.min( start, end );\n\t\tconst realEnd = Math.max( start, end );\n\n\t\t// Check and dicsard stray event, where the text and selection is equal to the ones already cached.\n\t\tconst contentWithoutRootTag = this.removeRootTagsProducedByAztec(\n\t\t\tunescapeSpaces( event.nativeEvent.text )\n\t\t);\n\t\tif (\n\t\t\tcontentWithoutRootTag === this.value &&\n\t\t\trealStart === this.selectionStart &&\n\t\t\trealEnd === this.selectionEnd\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.comesFromAztec = true;\n\t\tthis.firedAfterTextChanged = true; // Selection change event always fires after the fact.\n\n\t\t// Update text before updating selection\n\t\t// Make sure there are changes made to the content before upgrading it upward.\n\t\tthis.onTextUpdate( event );\n\n\t\t// Aztec can send us selection change events after it has lost focus.\n\t\t// For instance the autocorrect feature will complete a partially written\n\t\t// word when resigning focus, causing a selection change event.\n\t\t// Forwarding this selection change could cause this RichText to regain\n\t\t// focus and start a focus loop.\n\t\t//\n\t\t// See https://github.com/wordpress-mobile/gutenberg-mobile/issues/1696\n\t\tif ( this.props.__unstableIsSelected ) {\n\t\t\tthis.onSelectionChange( realStart, realEnd );\n\t\t}\n\t\t// Update lastEventCount to prevent Aztec from re-rendering the content it just sent.\n\t\tthis.lastEventCount = event.nativeEvent.eventCount;\n\n\t\tthis.lastAztecEventType = 'selection change';\n\t}\n\n\tisEmpty() {\n\t\treturn isEmpty( this.formatToValue( this.props.value ) );\n\t}\n\n\tformatToValue( value ) {\n\t\tconst { preserveWhiteSpace } = this.props;\n\t\t// Handle deprecated `children` and `node` sources.\n\t\tif ( Array.isArray( value ) ) {\n\t\t\treturn create( {\n\t\t\t\thtml: childrenBlock.toHTML( value ),\n\t\t\t\tmultilineTag: this.multilineTag,\n\t\t\t\tmultilineWrapperTags: this.multilineWrapperTags,\n\t\t\t\tpreserveWhiteSpace,\n\t\t\t} );\n\t\t}\n\n\t\tif ( this.props.format === 'string' ) {\n\t\t\treturn create( {\n\t\t\t\thtml: value,\n\t\t\t\tmultilineTag: this.multilineTag,\n\t\t\t\tmultilineWrapperTags: this.multilineWrapperTags,\n\t\t\t\tpreserveWhiteSpace,\n\t\t\t} );\n\t\t}\n\n\t\t// Guard for blocks passing `null` in onSplit callbacks. May be removed\n\t\t// if onSplit is revised to not pass a `null` value.\n\t\tif ( value === null ) {\n\t\t\treturn create();\n\t\t}\n\n\t\treturn value;\n\t}\n\n\tmanipulateEventCounterToForceNativeToRefresh() {\n\t\tif ( this.isIOS ) {\n\t\t\tthis.lastEventCount = undefined;\n\t\t\treturn;\n\t\t}\n\n\t\tif ( typeof this.lastEventCount !== 'undefined' ) {\n\t\t\tthis.lastEventCount += 100; // bump by a hundred, hopefully native hasn't bombarded the JS side in the meantime.\n\t\t} // no need to bump when 'undefined' as native side won't receive the key when the value is undefined, and that will cause force updating anyway,\n\t\t//   see https://github.com/WordPress/gutenberg/blob/82e578dcc75e67891c750a41a04c1e31994192fc/packages/react-native-aztec/android/src/main/java/org/wordpress/mobile/ReactNativeAztec/ReactAztecManager.java#L213-L215\n\t}\n\n\tshouldComponentUpdate( nextProps, nextState ) {\n\t\tif (\n\t\t\tnextProps.tagName !== this.props.tagName ||\n\t\t\tnextProps.reversed !== this.props.reversed ||\n\t\t\tnextProps.start !== this.props.start\n\t\t) {\n\t\t\tthis.manipulateEventCounterToForceNativeToRefresh(); // force a refresh on the native side\n\t\t\tthis.value = undefined;\n\t\t\treturn true;\n\t\t}\n\n\t\t// TODO: Please re-introduce the check to avoid updating the content right after an `onChange` call.\n\t\t// It was removed in https://github.com/WordPress/gutenberg/pull/12417 to fix undo/redo problem.\n\n\t\t// If the component is changed React side (undo/redo/merging/splitting/custom text actions)\n\t\t// we need to make sure the native is updated as well.\n\n\t\t// Also, don't trust the \"this.lastContent\" as on Android, incomplete text events arrive\n\t\t//  with only some of the text, while the virtual keyboard's suggestion system does its magic.\n\t\t// ** compare with this.lastContent for optimizing performance by not forcing Aztec with text it already has\n\t\t// , but compare with props.value to not lose \"half word\" text because of Android virtual keyb autosuggestion behavior\n\t\tif (\n\t\t\ttypeof nextProps.value !== 'undefined' &&\n\t\t\ttypeof this.props.value !== 'undefined' &&\n\t\t\t( ! this.comesFromAztec || ! this.firedAfterTextChanged ) &&\n\t\t\tnextProps.value !== this.props.value\n\t\t) {\n\t\t\t// Gutenberg seems to try to mirror the caret state even on events that only change the content so,\n\t\t\t//  let's force caret update if state has selection set.\n\t\t\tif (\n\t\t\t\ttypeof nextProps.selectionStart !== 'undefined' &&\n\t\t\t\ttypeof nextProps.selectionEnd !== 'undefined'\n\t\t\t) {\n\t\t\t\tthis.needsSelectionUpdate = true;\n\t\t\t}\n\n\t\t\tthis.manipulateEventCounterToForceNativeToRefresh(); // force a refresh on the native side\n\t\t}\n\n\t\tif ( ! this.comesFromAztec ) {\n\t\t\tif (\n\t\t\t\ttypeof nextProps.selectionStart !== 'undefined' &&\n\t\t\t\ttypeof nextProps.selectionEnd !== 'undefined' &&\n\t\t\t\tnextProps.selectionStart !== this.props.selectionStart &&\n\t\t\t\tnextProps.selectionStart !== this.selectionStart &&\n\t\t\t\tnextProps.__unstableIsSelected\n\t\t\t) {\n\t\t\t\tthis.needsSelectionUpdate = true;\n\t\t\t\tthis.manipulateEventCounterToForceNativeToRefresh(); // force a refresh on the native side\n\t\t\t}\n\n\t\t\t// For font size changes from a prop value a force refresh\n\t\t\t// is needed without the selection update.\n\t\t\tif ( nextProps?.fontSize !== this.props?.fontSize ) {\n\t\t\t\tthis.manipulateEventCounterToForceNativeToRefresh(); // force a refresh on the native side\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t( nextProps?.style?.fontSize !== this.props?.style?.fontSize &&\n\t\t\t\t\tnextState.currentFontSize !==\n\t\t\t\t\t\tthis.state.currentFontSize ) ||\n\t\t\t\tnextState.currentFontSize !== this.state.currentFontSize ||\n\t\t\t\tnextProps?.style?.lineHeight !== this.props?.style?.lineHeight\n\t\t\t) {\n\t\t\t\tthis.needsSelectionUpdate = true;\n\t\t\t\tthis.manipulateEventCounterToForceNativeToRefresh(); // force a refresh on the native side\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tcomponentDidMount() {\n\t\t// Request focus if wrapping block is selected and parent hasn't inhibited the focus request. This method of focusing\n\t\t//  is trying to implement the web-side counterpart of BlockList's `focusTabbable` where the BlockList is focusing an\n\t\t//  inputbox by searching the DOM. We don't have the DOM in RN so, using the combination of blockIsSelected and __unstableMobileNoFocusOnMount\n\t\t//  to determine if we should focus the RichText.\n\t\tif (\n\t\t\tthis.props.blockIsSelected &&\n\t\t\t! this.props.__unstableMobileNoFocusOnMount\n\t\t) {\n\t\t\tthis._editor.focus();\n\t\t\tthis.onSelectionChange(\n\t\t\t\tthis.props.selectionStart || 0,\n\t\t\t\tthis.props.selectionEnd || 0\n\t\t\t);\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\tif ( this._editor.isFocused() ) {\n\t\t\tthis._editor.blur();\n\t\t}\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\tconst { style, tagName } = this.props;\n\t\tconst { currentFontSize } = this.state;\n\n\t\tif ( this.props.value !== this.value ) {\n\t\t\tthis.value = this.props.value;\n\t\t}\n\t\tconst { __unstableIsSelected: isSelected } = this.props;\n\n\t\tconst { __unstableIsSelected: prevIsSelected } = prevProps;\n\n\t\tif ( isSelected && ! prevIsSelected ) {\n\t\t\tthis._editor.focus();\n\t\t\t// Update selection props explicitly when component is selected as Aztec won't call onSelectionChange\n\t\t\t// if its internal value hasn't change. When created, default value is 0, 0.\n\t\t\tthis.onSelectionChange(\n\t\t\t\tthis.props.selectionStart || 0,\n\t\t\t\tthis.props.selectionEnd || 0\n\t\t\t);\n\t\t} else if ( ! isSelected && prevIsSelected ) {\n\t\t\tthis._editor.blur();\n\t\t}\n\n\t\t// For font size values changes from the font size picker\n\t\t// we compare previous values to refresh the selected font size,\n\t\t// this is also used when the tag name changes\n\t\t// e.g Heading block and a level change like h1->h2.\n\t\tconst currentFontSizeStyle = this.getParsedFontSize( style?.fontSize );\n\t\tconst prevFontSizeStyle = this.getParsedFontSize(\n\t\t\tprevProps?.style?.fontSize\n\t\t);\n\t\tconst isDifferentTag = prevProps.tagName !== tagName;\n\t\tif (\n\t\t\t( currentFontSize &&\n\t\t\t\t( currentFontSizeStyle || prevFontSizeStyle ) &&\n\t\t\t\tcurrentFontSizeStyle !== currentFontSize ) ||\n\t\t\tisDifferentTag\n\t\t) {\n\t\t\tthis.setState( {\n\t\t\t\tcurrentFontSize: this.getFontSize( this.props ),\n\t\t\t} );\n\t\t}\n\t}\n\n\tgetHtmlToRender( record, tagName ) {\n\t\t// Save back to HTML from React tree.\n\t\tlet value = this.valueToFormat( record );\n\n\t\tif ( value === undefined ) {\n\t\t\tthis.manipulateEventCounterToForceNativeToRefresh(); // force a refresh on the native side\n\t\t\tvalue = '';\n\t\t}\n\t\t// On android if content is empty we need to send no content or else the placeholder will not show.\n\t\tif (\n\t\t\t! this.isIOS &&\n\t\t\t( value === '' || value === EMPTY_PARAGRAPH_TAGS )\n\t\t) {\n\t\t\treturn '';\n\t\t}\n\n\t\tif ( tagName ) {\n\t\t\tlet extraAttributes = ``;\n\t\t\tif ( tagName === `ol` ) {\n\t\t\t\tif ( this.props.reversed ) {\n\t\t\t\t\textraAttributes += ` reversed`;\n\t\t\t\t}\n\t\t\t\tif ( this.props.start ) {\n\t\t\t\t\textraAttributes += ` start=${ this.props.start }`;\n\t\t\t\t}\n\t\t\t}\n\t\t\tvalue = `<${ tagName }${ extraAttributes }>${ value }</${ tagName }>`;\n\t\t}\n\t\treturn value;\n\t}\n\n\tgetEditableProps() {\n\t\treturn {\n\t\t\t// Overridable props.\n\t\t\tstyle: {},\n\t\t\tclassName: 'rich-text',\n\t\t\tonKeyDown: () => null,\n\t\t};\n\t}\n\n\tgetParsedFontSize( fontSize ) {\n\t\tconst { height, width } = Dimensions.get( 'window' );\n\t\tconst cssUnitOptions = { height, width, fontSize: DEFAULT_FONT_SIZE };\n\n\t\tif ( ! fontSize ) {\n\t\t\treturn fontSize;\n\t\t}\n\n\t\tconst selectedPxValue =\n\t\t\tgetPxFromCssUnit( fontSize, cssUnitOptions ) ?? DEFAULT_FONT_SIZE;\n\n\t\treturn parseFloat( selectedPxValue );\n\t}\n\n\tgetFontSize( props ) {\n\t\tconst { baseGlobalStyles, tagName, fontSize, style } = props;\n\t\tconst tagNameFontSize =\n\t\t\tbaseGlobalStyles?.elements?.[ tagName ]?.typography?.fontSize;\n\n\t\tlet newFontSize = DEFAULT_FONT_SIZE;\n\n\t\t// Disables line-height rendering for pre elements until we fix some issues with AztecAndroid.\n\t\tif ( tagName === 'pre' && ! this.isIOS ) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\t// For block-based themes, get the default editor font size.\n\t\tif ( baseGlobalStyles?.typography?.fontSize && tagName === 'p' ) {\n\t\t\tnewFontSize = baseGlobalStyles?.typography?.fontSize;\n\t\t}\n\n\t\t// For block-based themes, get the default element font size\n\t\t// e.g h1, h2.\n\t\tif ( tagNameFontSize ) {\n\t\t\tnewFontSize = tagNameFontSize;\n\t\t}\n\n\t\t// For font size values provided from the styles,\n\t\t// usually from values set from the font size picker.\n\t\tif ( style?.fontSize ) {\n\t\t\tnewFontSize = style.fontSize;\n\t\t}\n\n\t\t// Fall-back to a font size provided from its props (if there's any)\n\t\t// and there are no other default values to use.\n\t\tif ( fontSize && ! tagNameFontSize && ! style?.fontSize ) {\n\t\t\tnewFontSize = fontSize;\n\t\t}\n\n\t\t// We need to always convert to px units because the selected value\n\t\t// could be coming from the web where it could be stored as a different unit.\n\t\tconst selectedPxValue = this.getParsedFontSize( newFontSize );\n\n\t\treturn selectedPxValue;\n\t}\n\n\tgetLineHeight() {\n\t\tconst { baseGlobalStyles, tagName, lineHeight, style } = this.props;\n\t\tconst tagNameLineHeight =\n\t\t\tbaseGlobalStyles?.elements?.[ tagName ]?.typography?.lineHeight;\n\t\tlet newLineHeight;\n\n\t\t// Disables line-height rendering for pre elements until we fix some issues with AztecAndroid.\n\t\tif ( tagName === 'pre' && ! this.isIOS ) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif ( ! this.getIsBlockBasedTheme() ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// For block-based themes, get the default editor line height.\n\t\tif ( baseGlobalStyles?.typography?.lineHeight && tagName === 'p' ) {\n\t\t\tnewLineHeight = parseFloat(\n\t\t\t\tbaseGlobalStyles?.typography?.lineHeight\n\t\t\t);\n\t\t}\n\n\t\t// For block-based themes, get the default element line height\n\t\t// e.g h1, h2.\n\t\tif ( tagNameLineHeight ) {\n\t\t\tnewLineHeight = parseFloat( tagNameLineHeight );\n\t\t}\n\n\t\t// For line height values provided from the styles,\n\t\t// usually from values set from the line height picker.\n\t\tif ( style?.lineHeight ) {\n\t\t\tnewLineHeight = parseFloat( style.lineHeight );\n\t\t}\n\n\t\t// Fall-back to a line height provided from its props (if there's any)\n\t\t// and there are no other default values to use.\n\t\tif ( lineHeight && ! tagNameLineHeight && ! style?.lineHeight ) {\n\t\t\tnewLineHeight = lineHeight;\n\t\t}\n\n\t\t// Check the final value is not over the minimum supported value.\n\t\tif ( newLineHeight && newLineHeight < MIN_LINE_HEIGHT ) {\n\t\t\tnewLineHeight = MIN_LINE_HEIGHT;\n\t\t}\n\n\t\t// Until we parse CSS values correctly, avoid passing NaN values to Aztec\n\t\tif ( isNaN( newLineHeight ) ) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn newLineHeight;\n\t}\n\n\tgetIsBlockBasedTheme() {\n\t\tconst { baseGlobalStyles } = this.props;\n\n\t\treturn (\n\t\t\tbaseGlobalStyles && Object.entries( baseGlobalStyles ).length !== 0\n\t\t);\n\t}\n\n\tgetBlockUseDefaultFont() {\n\t\t// For block-based themes it enables using the defaultFont\n\t\t// in Aztec for iOS so it allows customizing the font size\n\t\t// for the Preformatted/Code and Heading blocks.\n\t\tif ( ! this.isIOS ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { tagName } = this.props;\n\t\tconst isBlockBasedTheme = this.getIsBlockBasedTheme();\n\t\tconst tagsToMatch = /pre|h([1-6])$/gm;\n\n\t\treturn isBlockBasedTheme && tagsToMatch.test( tagName );\n\t}\n\n\tgetLinkTextColor( defaultColor ) {\n\t\tconst { style } = this.props;\n\t\tconst customColor = style?.linkColor && colord( style.linkColor );\n\n\t\treturn customColor && customColor.isValid()\n\t\t\t? customColor.toHex()\n\t\t\t: defaultColor;\n\t}\n\n\tgetPlaceholderTextColor() {\n\t\tconst {\n\t\t\tbaseGlobalStyles,\n\t\t\tgetStylesFromColorScheme,\n\t\t\tplaceholderTextColor,\n\t\t\tstyle,\n\t\t} = this.props;\n\n\t\t// Default placeholder text color.\n\t\tconst placeholderStyle = getStylesFromColorScheme(\n\t\t\tstyles.richTextPlaceholder,\n\t\t\tstyles.richTextPlaceholderDark\n\t\t);\n\t\tconst { color: defaultPlaceholderTextColor } = placeholderStyle;\n\t\t// Custom 63% opacity for theme and inherited colors.\n\t\tconst placeholderOpacity = 'A1';\n\n\t\t// Determine inherited placeholder color if available.\n\t\tconst inheritPlaceholderColor = style?.placeholderColor\n\t\t\t? `${ style.placeholderColor }${ placeholderOpacity }`\n\t\t\t: undefined;\n\n\t\t// If using block-based themes, derive the placeholder color from global styles.\n\t\tconst globalStylesPlaceholderColor = baseGlobalStyles?.color?.text\n\t\t\t? `${ baseGlobalStyles.color.text }${ placeholderOpacity }`\n\t\t\t: undefined;\n\n\t\treturn (\n\t\t\tinheritPlaceholderColor ??\n\t\t\tplaceholderTextColor ??\n\t\t\tglobalStylesPlaceholderColor ??\n\t\t\tdefaultPlaceholderTextColor\n\t\t);\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\ttagName,\n\t\t\tstyle,\n\t\t\t__unstableIsSelected: isSelected,\n\t\t\tchildren,\n\t\t\tgetStylesFromColorScheme,\n\t\t\tminWidth,\n\t\t\tmaxWidth,\n\t\t\tformatTypes,\n\t\t\tparentBlockStyles,\n\t\t\taccessibilityLabel,\n\t\t\tdisableEditingMenu = false,\n\t\t\tbaseGlobalStyles,\n\t\t\tselectionStart,\n\t\t\tselectionEnd,\n\t\t\tdisableSuggestions,\n\t\t\tcontainerWidth,\n\t\t} = this.props;\n\t\tconst { currentFontSize } = this.state;\n\n\t\tconst record = this.getRecord();\n\t\tconst html = this.getHtmlToRender( record, tagName );\n\t\tconst editableProps = this.getEditableProps();\n\t\tconst blockUseDefaultFont = this.getBlockUseDefaultFont();\n\n\t\tconst fontSize = currentFontSize;\n\t\tconst lineHeight = this.getLineHeight();\n\n\t\tconst {\n\t\t\tcolor: defaultColor,\n\t\t\ttextDecorationColor: defaultTextDecorationColor,\n\t\t\tfontFamily: defaultFontFamily,\n\t\t} = getStylesFromColorScheme( styles.richText, styles.richTextDark );\n\t\tconst linkTextColor = this.getLinkTextColor(\n\t\t\tdefaultTextDecorationColor\n\t\t);\n\n\t\tconst currentSelectionStart = selectionStart ?? 0;\n\t\tconst currentSelectionEnd = selectionEnd ?? 0;\n\t\tlet selection = null;\n\t\tif ( this.needsSelectionUpdate ) {\n\t\t\tthis.needsSelectionUpdate = false;\n\t\t\tselection = {\n\t\t\t\tstart: currentSelectionStart,\n\t\t\t\tend: currentSelectionEnd,\n\t\t\t};\n\n\t\t\t// On AztecAndroid, setting the caret to an out-of-bounds position will crash the editor so, let's check for some cases.\n\t\t\tif ( ! this.isIOS ) {\n\t\t\t\t// The following regular expression is used in Aztec here:\n\t\t\t\t// https://github.com/wordpress-mobile/AztecEditor-Android/blob/b1fad439d56fa6d4aa0b78526fef355c59d00dd3/aztec/src/main/kotlin/org/wordpress/aztec/AztecParser.kt#L656\n\t\t\t\tconst brBeforeParaMatches = html.match( /(<br>)+<\\/p>$/g );\n\t\t\t\tif ( brBeforeParaMatches ) {\n\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t'Oops, BR tag(s) at the end of content. Aztec will remove them, adapting the selection...'\n\t\t\t\t\t);\n\t\t\t\t\tconst count = (\n\t\t\t\t\t\tbrBeforeParaMatches[ 0 ].match( /br/g ) || []\n\t\t\t\t\t).length;\n\t\t\t\t\tif ( count > 0 ) {\n\t\t\t\t\t\tlet newSelectionStart = currentSelectionStart - count;\n\t\t\t\t\t\tif ( newSelectionStart < 0 ) {\n\t\t\t\t\t\t\tnewSelectionStart = 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlet newSelectionEnd = currentSelectionEnd - count;\n\t\t\t\t\t\tif ( newSelectionEnd < 0 ) {\n\t\t\t\t\t\t\tnewSelectionEnd = 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tselection = {\n\t\t\t\t\t\t\tstart: newSelectionStart,\n\t\t\t\t\t\t\tend: newSelectionEnd,\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ( this.comesFromAztec ) {\n\t\t\tthis.comesFromAztec = false;\n\t\t\tthis.firedAfterTextChanged = false;\n\t\t}\n\n\t\t// Logic below assures that `RichText` width will always have equal value when container is almost fully filled.\n\t\tconst width =\n\t\t\tmaxWidth && this.state.width && maxWidth - this.state.width < 10\n\t\t\t\t? maxWidth\n\t\t\t\t: this.state.width;\n\t\tconst containerStyles = [\n\t\t\tstyle?.padding &&\n\t\t\t\tstyle?.backgroundColor && {\n\t\t\t\t\tpadding: style.padding,\n\t\t\t\t\tbackgroundColor: style.backgroundColor,\n\t\t\t\t},\n\t\t\tcontainerWidth && {\n\t\t\t\twidth: containerWidth,\n\t\t\t},\n\t\t];\n\n\t\tconst defaultSelectionColor = getStylesFromColorScheme(\n\t\t\tstyles[ 'rich-text-selection' ],\n\t\t\tstyles[ 'rich-text-selection--dark' ]\n\t\t).color;\n\t\tconst selectionColor = getSelectionColor(\n\t\t\tthis.props.selectionColor,\n\t\t\tdefaultSelectionColor,\n\t\t\tbaseGlobalStyles,\n\t\t\tthis.getIsBlockBasedTheme()\n\t\t);\n\n\t\tconst EditableView = ( props ) => {\n\t\t\tthis.customEditableOnKeyDown = props?.onKeyDown;\n\n\t\t\treturn <></>;\n\t\t};\n\n\t\treturn (\n\t\t\t<View style={ containerStyles }>\n\t\t\t\t{ children &&\n\t\t\t\t\tchildren( {\n\t\t\t\t\t\tisSelected,\n\t\t\t\t\t\tvalue: record,\n\t\t\t\t\t\tonChange: this.onFormatChange,\n\t\t\t\t\t\tonFocus: () => {},\n\t\t\t\t\t\teditableProps,\n\t\t\t\t\t\teditableTagName: EditableView,\n\t\t\t\t\t} ) }\n\t\t\t\t<RCTAztecView\n\t\t\t\t\taccessibilityLabel={ accessibilityLabel }\n\t\t\t\t\tref={ ( ref ) => {\n\t\t\t\t\t\tthis._editor = ref;\n\n\t\t\t\t\t\tif ( this.props.setRef ) {\n\t\t\t\t\t\t\tthis.props.setRef( ref );\n\t\t\t\t\t\t}\n\t\t\t\t\t} }\n\t\t\t\t\tstyle={ {\n\t\t\t\t\t\tbackgroundColor: styles.richText.backgroundColor,\n\t\t\t\t\t\t...style,\n\t\t\t\t\t\t...( this.isIOS && minWidth && maxWidth\n\t\t\t\t\t\t\t? { width }\n\t\t\t\t\t\t\t: { maxWidth } ),\n\t\t\t\t\t\tminHeight: this.state.height,\n\t\t\t\t\t} }\n\t\t\t\t\tblockUseDefaultFont={ blockUseDefaultFont }\n\t\t\t\t\ttext={ {\n\t\t\t\t\t\ttext: html,\n\t\t\t\t\t\teventCount: this.lastEventCount,\n\t\t\t\t\t\tselection,\n\t\t\t\t\t\tlinkTextColor,\n\t\t\t\t\t\ttag: tagName,\n\t\t\t\t\t} }\n\t\t\t\t\tplaceholder={ this.props.placeholder }\n\t\t\t\t\tplaceholderTextColor={ this.getPlaceholderTextColor() }\n\t\t\t\t\tdeleteEnter={ this.props.deleteEnter }\n\t\t\t\t\tonChange={ this.onChangeFromAztec }\n\t\t\t\t\tonFocus={ this.onFocus }\n\t\t\t\t\tonBlur={ this.onBlur }\n\t\t\t\t\tonKeyDown={ this.onKeyDown }\n\t\t\t\t\ttriggerKeyCodes={\n\t\t\t\t\t\tdisableEditingMenu\n\t\t\t\t\t\t\t? []\n\t\t\t\t\t\t\t: this.suggestionOptions().map(\n\t\t\t\t\t\t\t\t\t( op ) => op.triggerChar\n\t\t\t\t\t\t\t  )\n\t\t\t\t\t}\n\t\t\t\t\tonPaste={ this.onPaste }\n\t\t\t\t\tactiveFormats={ this.getActiveFormatNames( record ) }\n\t\t\t\t\tonContentSizeChange={ this.onContentSizeChange }\n\t\t\t\t\tonSelectionChange={ this.onSelectionChangeFromAztec }\n\t\t\t\t\tblockType={ { tag: tagName } }\n\t\t\t\t\tcolor={\n\t\t\t\t\t\t( style && style.color ) ||\n\t\t\t\t\t\t( parentBlockStyles && parentBlockStyles.color ) ||\n\t\t\t\t\t\t( baseGlobalStyles && baseGlobalStyles?.color?.text ) ||\n\t\t\t\t\t\tdefaultColor\n\t\t\t\t\t}\n\t\t\t\t\tmaxImagesWidth={ 200 }\n\t\t\t\t\tfontFamily={ this.props.fontFamily || defaultFontFamily }\n\t\t\t\t\tfontSize={ fontSize }\n\t\t\t\t\tlineHeight={ lineHeight }\n\t\t\t\t\tfontWeight={ this.props.fontWeight }\n\t\t\t\t\tfontStyle={ this.props.fontStyle }\n\t\t\t\t\tdisableEditingMenu={ disableEditingMenu }\n\t\t\t\t\tisMultiline={ this.isMultiline }\n\t\t\t\t\ttextAlign={ this.props.textAlign }\n\t\t\t\t\t{ ...( this.isIOS ? { maxWidth } : {} ) }\n\t\t\t\t\tminWidth={ minWidth }\n\t\t\t\t\tid={ this.props.id }\n\t\t\t\t\tselectionColor={ selectionColor }\n\t\t\t\t\tdisableAutocorrection={ this.props.disableAutocorrection }\n\t\t\t\t/>\n\t\t\t\t{ isSelected && (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<FormatEdit\n\t\t\t\t\t\t\tforwardedRef={ this._editor }\n\t\t\t\t\t\t\tformatTypes={ formatTypes }\n\t\t\t\t\t\t\tvalue={ record }\n\t\t\t\t\t\t\tonChange={ this.onFormatChange }\n\t\t\t\t\t\t\tonFocus={ () => {} }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t{ ! disableSuggestions && (\n\t\t\t\t\t\t\t<BlockFormatControls>\n\t\t\t\t\t\t\t\t<ToolbarButtonWithOptions\n\t\t\t\t\t\t\t\t\toptions={ this.suggestionOptions() }\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</BlockFormatControls>\n\t\t\t\t\t\t) }\n\t\t\t\t\t</>\n\t\t\t\t) }\n\t\t\t</View>\n\t\t);\n\t}\n}\n\nRichText.defaultProps = {\n\tformat: 'string',\n\tvalue: '',\n\ttagName: 'div',\n};\n\nconst withFormatTypes = ( WrappedComponent ) => ( props ) => {\n\tconst {\n\t\tclientId,\n\t\tidentifier,\n\t\twithoutInteractiveFormatting,\n\t\tallowedFormats,\n\t} = props;\n\tconst { formatTypes } = useFormatTypes( {\n\t\tclientId,\n\t\tidentifier,\n\t\twithoutInteractiveFormatting,\n\t\tallowedFormats,\n\t} );\n\n\treturn <WrappedComponent { ...props } formatTypes={ formatTypes } />;\n};\n\nexport default compose( [\n\twithSelect( ( select, { clientId } ) => {\n\t\tconst { getBlockParents, getBlock, getSettings } =\n\t\t\tselect( 'core/block-editor' );\n\t\tconst parents = getBlockParents( clientId, true );\n\t\tconst parentBlock = parents ? getBlock( parents[ 0 ] ) : undefined;\n\t\tconst parentBlockStyles = parentBlock?.attributes?.childrenStyles;\n\n\t\tconst settings = getSettings();\n\t\tconst baseGlobalStyles = settings?.__experimentalGlobalStylesBaseStyles;\n\n\t\tconst colorPalettes = settings?.__experimentalFeatures?.color?.palette;\n\t\tconst colorPalette = colorPalettes\n\t\t\t? flatColorPalettes( colorPalettes )\n\t\t\t: settings?.colors;\n\n\t\treturn {\n\t\t\tareMentionsSupported: settings?.capabilities?.mentions === true,\n\t\t\tareXPostsSupported: settings?.capabilities?.xposts === true,\n\t\t\tparentBlockStyles,\n\t\t\tbaseGlobalStyles,\n\t\t\tcolorPalette,\n\t\t};\n\t} ),\n\twithPreferredColorScheme,\n\twithFormatTypes,\n] )( RichText );\n"],"mappings":"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"}