{"version":3,"names":["_rungen","require","_isPromise","_interopRequireDefault","_isAction","createRuntime","controls","dispatch","rungenControls","Object","entries","map","actionType","control","value","next","iterate","yieldNext","yieldError","isActionOfType","routine","isPromise","then","unhandledActionControl","isAction","push","rungenRuntime","create","action","Promise","resolve","reject","result"],"sources":["@wordpress/redux-routine/src/runtime.ts"],"sourcesContent":["/**\n * External dependencies\n */\nimport type { Control } from 'rungen';\nimport { create } from 'rungen';\nimport isPromise from 'is-promise';\nimport type { Dispatch, AnyAction } from 'redux';\n\n/**\n * Internal dependencies\n */\nimport { isActionOfType, isAction } from './is-action';\n\n/**\n * Create a co-routine runtime.\n *\n * @param controls Object of control handlers.\n * @param dispatch Unhandled action dispatch.\n */\nexport default function createRuntime(\n\tcontrols: Record<\n\t\tstring,\n\t\t( value: any ) => Promise< boolean > | boolean\n\t> = {},\n\tdispatch: Dispatch\n) {\n\tconst rungenControls = Object.entries( controls ).map(\n\t\t( [ actionType, control ] ): Control =>\n\t\t\t( value, next, iterate, yieldNext, yieldError ) => {\n\t\t\t\tif ( ! isActionOfType( value, actionType ) ) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tconst routine = control( value );\n\t\t\t\tif ( isPromise( routine ) ) {\n\t\t\t\t\t// Async control routine awaits resolution.\n\t\t\t\t\troutine.then( yieldNext, yieldError );\n\t\t\t\t} else {\n\t\t\t\t\tyieldNext( routine );\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}\n\t);\n\n\tconst unhandledActionControl = (\n\t\tvalue: AnyAction | unknown,\n\t\tnext: () => void\n\t) => {\n\t\tif ( ! isAction( value ) ) {\n\t\t\treturn false;\n\t\t}\n\t\tdispatch( value );\n\t\tnext();\n\t\treturn true;\n\t};\n\trungenControls.push( unhandledActionControl );\n\n\tconst rungenRuntime = create( rungenControls );\n\n\treturn ( action: AnyAction | Generator ) =>\n\t\tnew Promise( ( resolve, reject ) =>\n\t\t\trungenRuntime(\n\t\t\t\taction,\n\t\t\t\t( result ) => {\n\t\t\t\t\tif ( isAction( result ) ) {\n\t\t\t\t\t\tdispatch( result );\n\t\t\t\t\t}\n\t\t\t\t\tresolve( result );\n\t\t\t\t},\n\t\t\t\treject\n\t\t\t)\n\t\t);\n}\n"],"mappings":";;;;;;;AAIA,IAAAA,OAAA,GAAAC,OAAA;AACA,IAAAC,UAAA,GAAAC,sBAAA,CAAAF,OAAA;AAMA,IAAAG,SAAA,GAAAH,OAAA;AAXA;AACA;AACA;;AAMA;AACA;AACA;;AAGA;AACA;AACA;AACA;AACA;AACA;AACe,SAASI,aAAaA,CACpCC,QAGC,GAAG,CAAC,CAAC,EACNC,QAAkB,EACjB;EACD,MAAMC,cAAc,GAAGC,MAAM,CAACC,OAAO,CAAEJ,QAAS,CAAC,CAACK,GAAG,CACpD,CAAE,CAAEC,UAAU,EAAEC,OAAO,CAAE,KACxB,CAAEC,KAAK,EAAEC,IAAI,EAAEC,OAAO,EAAEC,SAAS,EAAEC,UAAU,KAAM;IAClD,IAAK,CAAE,IAAAC,wBAAc,EAAEL,KAAK,EAAEF,UAAW,CAAC,EAAG;MAC5C,OAAO,KAAK;IACb;IACA,MAAMQ,OAAO,GAAGP,OAAO,CAAEC,KAAM,CAAC;IAChC,IAAK,IAAAO,kBAAS,EAAED,OAAQ,CAAC,EAAG;MAC3B;MACAA,OAAO,CAACE,IAAI,CAAEL,SAAS,EAAEC,UAAW,CAAC;IACtC,CAAC,MAAM;MACND,SAAS,CAAEG,OAAQ,CAAC;IACrB;IACA,OAAO,IAAI;EACZ,CACF,CAAC;EAED,MAAMG,sBAAsB,GAAGA,CAC9BT,KAA0B,EAC1BC,IAAgB,KACZ;IACJ,IAAK,CAAE,IAAAS,kBAAQ,EAAEV,KAAM,CAAC,EAAG;MAC1B,OAAO,KAAK;IACb;IACAP,QAAQ,CAAEO,KAAM,CAAC;IACjBC,IAAI,CAAC,CAAC;IACN,OAAO,IAAI;EACZ,CAAC;EACDP,cAAc,CAACiB,IAAI,CAAEF,sBAAuB,CAAC;EAE7C,MAAMG,aAAa,GAAG,IAAAC,cAAM,EAAEnB,cAAe,CAAC;EAE9C,OAASoB,MAA6B,IACrC,IAAIC,OAAO,CAAE,CAAEC,OAAO,EAAEC,MAAM,KAC7BL,aAAa,CACZE,MAAM,EACJI,MAAM,IAAM;IACb,IAAK,IAAAR,kBAAQ,EAAEQ,MAAO,CAAC,EAAG;MACzBzB,QAAQ,CAAEyB,MAAO,CAAC;IACnB;IACAF,OAAO,CAAEE,MAAO,CAAC;EAClB,CAAC,EACDD,MACD,CACD,CAAC;AACH"}