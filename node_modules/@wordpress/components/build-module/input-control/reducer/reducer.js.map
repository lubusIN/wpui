{"version":3,"names":["useReducer","useLayoutEffect","useRef","initialInputControlState","initialStateReducer","actions","mergeInitialState","initialState","value","initialValue","inputControlStateReducer","composedStateReducers","state","action","nextState","type","CONTROL","payload","isDirty","_event","undefined","PRESS_UP","PRESS_DOWN","DRAG_START","isDragging","DRAG_END","CHANGE","error","isPressEnterToChange","COMMIT","RESET","INVALIDATE","event","useInputControlStateReducer","stateReducer","onChangeHandler","dispatch","createChangeEvent","nextValue","createKeyEvent","createDragEvent","change","invalidate","reset","commit","dragStart","drag","DRAG","dragEnd","pressUp","pressDown","pressEnter","PRESS_ENTER","currentState","refProps","current","_state$value","_initialState$value"],"sources":["@wordpress/components/src/input-control/reducer/reducer.ts"],"sourcesContent":["/**\n * External dependencies\n */\nimport type { SyntheticEvent, ChangeEvent, PointerEvent } from 'react';\n\n/**\n * WordPress dependencies\n */\nimport { useReducer, useLayoutEffect, useRef } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport type { InputState, StateReducer } from './state';\nimport { initialInputControlState, initialStateReducer } from './state';\nimport * as actions from './actions';\nimport type { InputChangeCallback } from '../types';\n\n/**\n * Prepares initialState for the reducer.\n *\n * @param initialState The initial state.\n * @return Prepared initialState for the reducer\n */\nfunction mergeInitialState(\n\tinitialState: Partial< InputState > = initialInputControlState\n): InputState {\n\tconst { value } = initialState;\n\n\treturn {\n\t\t...initialInputControlState,\n\t\t...initialState,\n\t\tinitialValue: value,\n\t} as InputState;\n}\n\n/**\n * Creates the base reducer which may be coupled to a specializing reducer.\n * As its final step, for all actions other than CONTROL, the base reducer\n * passes the state and action on through the specializing reducer. The\n * exception for CONTROL actions is because they represent controlled updates\n * from props and no case has yet presented for their specialization.\n *\n * @param composedStateReducers A reducer to specialize state changes.\n * @return The reducer.\n */\nfunction inputControlStateReducer(\n\tcomposedStateReducers: StateReducer\n): StateReducer< actions.ControlAction > {\n\treturn ( state, action ) => {\n\t\tconst nextState = { ...state };\n\n\t\tswitch ( action.type ) {\n\t\t\t/*\n\t\t\t * Controlled updates\n\t\t\t */\n\t\t\tcase actions.CONTROL:\n\t\t\t\tnextState.value = action.payload.value;\n\t\t\t\tnextState.isDirty = false;\n\t\t\t\tnextState._event = undefined;\n\t\t\t\t// Returns immediately to avoid invoking additional reducers.\n\t\t\t\treturn nextState;\n\n\t\t\t/**\n\t\t\t * Keyboard events\n\t\t\t */\n\t\t\tcase actions.PRESS_UP:\n\t\t\t\tnextState.isDirty = false;\n\t\t\t\tbreak;\n\n\t\t\tcase actions.PRESS_DOWN:\n\t\t\t\tnextState.isDirty = false;\n\t\t\t\tbreak;\n\n\t\t\t/**\n\t\t\t * Drag events\n\t\t\t */\n\t\t\tcase actions.DRAG_START:\n\t\t\t\tnextState.isDragging = true;\n\t\t\t\tbreak;\n\n\t\t\tcase actions.DRAG_END:\n\t\t\t\tnextState.isDragging = false;\n\t\t\t\tbreak;\n\n\t\t\t/**\n\t\t\t * Input events\n\t\t\t */\n\t\t\tcase actions.CHANGE:\n\t\t\t\tnextState.error = null;\n\t\t\t\tnextState.value = action.payload.value;\n\n\t\t\t\tif ( state.isPressEnterToChange ) {\n\t\t\t\t\tnextState.isDirty = true;\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase actions.COMMIT:\n\t\t\t\tnextState.value = action.payload.value;\n\t\t\t\tnextState.isDirty = false;\n\t\t\t\tbreak;\n\n\t\t\tcase actions.RESET:\n\t\t\t\tnextState.error = null;\n\t\t\t\tnextState.isDirty = false;\n\t\t\t\tnextState.value = action.payload.value || state.initialValue;\n\t\t\t\tbreak;\n\n\t\t\t/**\n\t\t\t * Validation\n\t\t\t */\n\t\t\tcase actions.INVALIDATE:\n\t\t\t\tnextState.error = action.payload.error;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tnextState._event = action.payload.event;\n\n\t\t/**\n\t\t * Send the nextState + action to the composedReducers via\n\t\t * this \"bridge\" mechanism. This allows external stateReducers\n\t\t * to hook into actions, and modify state if needed.\n\t\t */\n\t\treturn composedStateReducers( nextState, action );\n\t};\n}\n\n/**\n * A custom hook that connects and external stateReducer with an internal\n * reducer. This hook manages the internal state of InputControl.\n * However, by connecting an external stateReducer function, other\n * components can react to actions as well as modify state before it is\n * applied.\n *\n * This technique uses the \"stateReducer\" design pattern:\n * https://kentcdodds.com/blog/the-state-reducer-pattern/\n *\n * @param stateReducer    An external state reducer.\n * @param initialState    The initial state for the reducer.\n * @param onChangeHandler A handler for the onChange event.\n * @return State, dispatch, and a collection of actions.\n */\nexport function useInputControlStateReducer(\n\tstateReducer: StateReducer = initialStateReducer,\n\tinitialState: Partial< InputState > = initialInputControlState,\n\tonChangeHandler: InputChangeCallback\n) {\n\tconst [ state, dispatch ] = useReducer(\n\t\tinputControlStateReducer( stateReducer ),\n\t\tmergeInitialState( initialState )\n\t);\n\n\tconst createChangeEvent =\n\t\t( type: actions.ChangeEventAction[ 'type' ] ) =>\n\t\t(\n\t\t\tnextValue: actions.ChangeEventAction[ 'payload' ][ 'value' ],\n\t\t\tevent: actions.ChangeEventAction[ 'payload' ][ 'event' ]\n\t\t) => {\n\t\t\tdispatch( {\n\t\t\t\ttype,\n\t\t\t\tpayload: { value: nextValue, event },\n\t\t\t} as actions.InputAction );\n\t\t};\n\n\tconst createKeyEvent =\n\t\t( type: actions.KeyEventAction[ 'type' ] ) =>\n\t\t( event: actions.KeyEventAction[ 'payload' ][ 'event' ] ) => {\n\t\t\tdispatch( { type, payload: { event } } );\n\t\t};\n\n\tconst createDragEvent =\n\t\t( type: actions.DragEventAction[ 'type' ] ) =>\n\t\t( payload: actions.DragEventAction[ 'payload' ] ) => {\n\t\t\tdispatch( { type, payload } );\n\t\t};\n\n\t/**\n\t * Actions for the reducer\n\t */\n\tconst change = createChangeEvent( actions.CHANGE );\n\tconst invalidate = ( error: unknown, event: SyntheticEvent ) =>\n\t\tdispatch( { type: actions.INVALIDATE, payload: { error, event } } );\n\tconst reset = createChangeEvent( actions.RESET );\n\tconst commit = createChangeEvent( actions.COMMIT );\n\n\tconst dragStart = createDragEvent( actions.DRAG_START );\n\tconst drag = createDragEvent( actions.DRAG );\n\tconst dragEnd = createDragEvent( actions.DRAG_END );\n\n\tconst pressUp = createKeyEvent( actions.PRESS_UP );\n\tconst pressDown = createKeyEvent( actions.PRESS_DOWN );\n\tconst pressEnter = createKeyEvent( actions.PRESS_ENTER );\n\n\tconst currentState = useRef( state );\n\tconst refProps = useRef( { value: initialState.value, onChangeHandler } );\n\n\t// Freshens refs to props and state so that subsequent effects have access\n\t// to their latest values without their changes causing effect runs.\n\tuseLayoutEffect( () => {\n\t\tcurrentState.current = state;\n\t\trefProps.current = { value: initialState.value, onChangeHandler };\n\t} );\n\n\t// Propagates the latest state through onChange.\n\tuseLayoutEffect( () => {\n\t\tif (\n\t\t\tcurrentState.current._event !== undefined &&\n\t\t\tstate.value !== refProps.current.value &&\n\t\t\t! state.isDirty\n\t\t) {\n\t\t\trefProps.current.onChangeHandler( state.value ?? '', {\n\t\t\t\tevent: currentState.current._event as\n\t\t\t\t\t| ChangeEvent< HTMLInputElement >\n\t\t\t\t\t| PointerEvent< HTMLInputElement >,\n\t\t\t} );\n\t\t}\n\t}, [ state.value, state.isDirty ] );\n\n\t// Updates the state from props.\n\tuseLayoutEffect( () => {\n\t\tif (\n\t\t\tinitialState.value !== currentState.current.value &&\n\t\t\t! currentState.current.isDirty\n\t\t) {\n\t\t\tdispatch( {\n\t\t\t\ttype: actions.CONTROL,\n\t\t\t\tpayload: { value: initialState.value ?? '' },\n\t\t\t} );\n\t\t}\n\t}, [ initialState.value ] );\n\n\treturn {\n\t\tchange,\n\t\tcommit,\n\t\tdispatch,\n\t\tdrag,\n\t\tdragEnd,\n\t\tdragStart,\n\t\tinvalidate,\n\t\tpressDown,\n\t\tpressEnter,\n\t\tpressUp,\n\t\treset,\n\t\tstate,\n\t} as const;\n}\n"],"mappings":"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"}